Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Building C code module c_helper.so
Start printer at Fri Jul  7 15:15:21 2023 (1688735721.0 757.2)
===== Config file =====
[mcu]
serial = /dev/serial/by-id/<your-mcu-id>

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
MCU error during connect
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/mcu.py", line 798, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 803, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'mcu': Unable to connect
No build file /home/rudis1261/klipper/klippy/../.config
No build file /home/rudis1261/klipper/klippy/../out/klipper.dict
No build file /home/rudis1261/klipper/klippy/../out/klipper.elf
webhooks client 4124116568: New connection
webhooks client 4124116568: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
webhooks client 4124116568: Disconnected
webhooks client 4127838464: New connection
webhooks client 4127838464: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
Attempting MCU 'mcu' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 949, in _firmware_restart
    self._restart_arduino()
  File "/home/rudis1261/klipper/klippy/mcu.py", line 909, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/by-id/<your-mcu-id>: [Errno 2] No such file or directory: '/dev/serial/by-id/<your-mcu-id>'
Restarting printer
Start printer at Fri Jul  7 15:43:09 2023 (1688737389.4 2425.6)
===== Config file =====
[mcu]
serial = /dev/serial/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
webhooks client 4123507416: New connection
webhooks client 4123507416: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
Attempting MCU 'mcu' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 949, in _firmware_restart
    self._restart_arduino()
  File "/home/rudis1261/klipper/klippy/mcu.py", line 909, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
Restarting printer
Start printer at Fri Jul  7 15:43:28 2023 (1688737408.7 2444.9)
===== Config file =====
[mcu]
serial = /dev/serial/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
webhooks client 4127779784: New connection
webhooks client 4127779784: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
                                                                                                                                                                                                                                                                                                          Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 15:37:23 2023 (1688737043.1 33.2)
===== Config file =====
[mcu]
serial = /dev/serial/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
webhooks client 4124316672: New connection
webhooks client 4124316672: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
MCU error during connect
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/mcu.py", line 798, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 803, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'mcu': Unable to connect
No build file /home/rudis1261/klipper/klippy/../.config
No build file /home/rudis1261/klipper/klippy/../out/klipper.dict
No build file /home/rudis1261/klipper/klippy/../out/klipper.elf
webhooks client 4124316672: Disconnected
Restarting printer
Start printer at Fri Jul  7 15:51:07 2023 (1688737867.5 418.6)
===== Config file =====
[mcu]
serial = /dev/serial/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
webhooks client 4127952128: New connection
webhooks client 4127952128: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
Attempting MCU 'mcu' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 949, in _firmware_restart
    self._restart_arduino()
  File "/home/rudis1261/klipper/klippy/mcu.py", line 909, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
Restarting printer
Start printer at Fri Jul  7 15:51:37 2023 (1688737897.1 448.2)
===== Config file =====
[mcu]
serial = /dev/serial/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
webhooks client 4123229272: New connection
webhooks client 4123229272: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
mcu 'mcu': Unable to open serial port: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
MCU error during connect
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/mcu.py", line 798, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 803, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'mcu': Unable to connect
Build file /home/rudis1261/klipper/klippy/../.config(3289): Fri Jul  7 15:49:38 2023
========= Last MCU build config =========
CONFIG_LOW_LEVEL_OPTIONS=y
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
CONFIG_MACH_STM32=y
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="stm32"
CONFIG_MCU="stm32f446xx"
CONFIG_CLOCK_FREQ=180000000
CONFIG_SERIAL=y
CONFIG_FLASH_SIZE=0x80000
CONFIG_FLASH_BOOT_ADDRESS=0x8000000
CONFIG_RAM_START=0x20000000
CONFIG_RAM_SIZE=0x20000
CONFIG_STACK_SIZE=512
CONFIG_FLASH_APPLICATION_ADDRESS=0x8008000
CONFIG_STM32_SELECT=y
# CONFIG_MACH_STM32F103 is not set
# CONFIG_MACH_STM32F207 is not set
# CONFIG_MACH_STM32F401 is not set
# CONFIG_MACH_STM32F405 is not set
# CONFIG_MACH_STM32F407 is not set
# CONFIG_MACH_STM32F429 is not set
CONFIG_MACH_STM32F446=y
# CONFIG_MACH_STM32F765 is not set
# CONFIG_MACH_STM32F031 is not set
# CONFIG_MACH_STM32F042 is not set
# CONFIG_MACH_STM32F070 is not set
# CONFIG_MACH_STM32F072 is not set
# CONFIG_MACH_STM32G070 is not set
# CONFIG_MACH_STM32G071 is not set
# CONFIG_MACH_STM32G0B0 is not set
# CONFIG_MACH_STM32G0B1 is not set
# CONFIG_MACH_STM32G431 is not set
# CONFIG_MACH_STM32H723 is not set
# CONFIG_MACH_STM32H743 is not set
# CONFIG_MACH_STM32H750 is not set
# CONFIG_MACH_STM32L412 is not set
# CONFIG_MACH_N32G452 is not set
# CONFIG_MACH_N32G455 is not set
CONFIG_MACH_STM32F4=y
CONFIG_HAVE_STM32_USBOTG=y
CONFIG_HAVE_STM32_CANBUS=y
CONFIG_HAVE_STM32_USBCANBUS=y
CONFIG_STM32_DFU_ROM_ADDRESS=0
CONFIG_STM32_FLASH_START_8000=y
# CONFIG_STM32_FLASH_START_10000 is not set
# CONFIG_STM32_FLASH_START_0000 is not set
# CONFIG_STM32_CLOCK_REF_8M is not set
CONFIG_STM32_CLOCK_REF_12M=y
# CONFIG_STM32_CLOCK_REF_16M is not set
# CONFIG_STM32_CLOCK_REF_20M is not set
# CONFIG_STM32_CLOCK_REF_24M is not set
# CONFIG_STM32_CLOCK_REF_25M is not set
# CONFIG_STM32_CLOCK_REF_INTERNAL is not set
CONFIG_CLOCK_REF_FREQ=12000000
CONFIG_STM32F0_TRIM=16
# CONFIG_STM32_USB_PA11_PA12 is not set
CONFIG_STM32_SERIAL_USART1=y
# CONFIG_STM32_SERIAL_USART1_ALT_PB7_PB6 is not set
# CONFIG_STM32_SERIAL_USART2 is not set
# CONFIG_STM32_SERIAL_USART2_ALT_PD6_PD5 is not set
# CONFIG_STM32_SERIAL_USART3 is not set
# CONFIG_STM32_SERIAL_USART3_ALT_PD9_PD8 is not set
# CONFIG_STM32_CANBUS_PA11_PA12 is not set
# CONFIG_STM32_CANBUS_PA11_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB8_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PI9_PH13 is not set
# CONFIG_STM32_MMENU_CANBUS_PB5_PB6 is not set
# CONFIG_STM32_MMENU_CANBUS_PB12_PB13 is not set
# CONFIG_STM32_MMENU_CANBUS_PD0_PD1 is not set
# CONFIG_STM32_USBCANBUS_PA11_PA12 is not set
CONFIG_SERIAL_BAUD=250000
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER="12345"
CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_INITIAL_PINS=""
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_SDIO=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_HAVE_BOOTLOADER_REQUEST=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/rudis1261/klipper/klippy/../out/klipper.dict(8562): Fri Jul  7 15:50:40 2023
Last MCU build version: v0.11.0-240-g6d48adf9
Last MCU build tools: gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34
Last MCU build config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Build file /home/rudis1261/klipper/klippy/../out/klipper.elf(1243120): Fri Jul  7 15:51:08 2023
Attempting MCU 'mcu' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 949, in _firmware_restart
    self._restart_arduino()
  File "/home/rudis1261/klipper/klippy/mcu.py", line 909, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/ttyAMA0: [Errno 2] No such file or directory: '/dev/serial/ttyAMA0'
Restarting printer
Start printer at Fri Jul  7 15:53:18 2023 (1688737998.3 549.4)
===== Config file =====
[mcu]
serial = /dev/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 15:57:23 2023 (1688738243.7 794.8)
===== Config file =====
[mcu]
serial = /dev/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
webhooks client 4127692640: New connection
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:03:50 2023 (1688738630.5 1181.6)
===== Config file =====
[mcu]
serial = /dev/serial1

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
webhooks client 4131501056: New connection
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:01:43 2023 (1688738503.8 28.1)
===== Config file =====
[mcu]
serial = /dev/serial1

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:24:08 2023 (1688739848.2 980.8)
===== Config file =====
[mcu]
serial = /dev/serial1

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:25:18 2023 (1688739918.3 28.5)
===== Config file =====
[mcu]
serial = /dev/serial1

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:29:54 2023 (1688740194.7 217.4)
===== Config file =====
[mcu]
serial = /dev/serial/by-path/platform-fd500000.pcie-pci-0000:01:00.0-usb-0:1.3:1.0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
webhooks client 4131275776: New connection
webhooks client 4131275776: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
Loaded MCU 'mcu' 119 commands (v0.11.0-240-g6d48adf9 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
webhooks: registering remote method 'shutdown_machine' for connection id: 4131275776
webhooks: registering remote method 'reboot_machine' for connection id: 4131275776
webhooks: registering remote method 'pause_job_queue' for connection id: 4131275776
webhooks: registering remote method 'start_job_queue' for connection id: 4131275776
b'Got EOF when reading from device'
Timeout with MCU 'mcu' (eventtime=549.472496)
Transition to shutdown state: Lost communication with MCU 'mcu'
Dumping gcode input 0 blocks
Dumping 19 requests for client 4131275776
Received 217.957241: b'{"id": 3907293320, "method": "info", "params": {"client_info": {"program": "Moonraker", "version": "v0.8.0-87-g8eddec8"}}}'
Received 217.964826: b'{"id": 3907294952, "method": "list_endpoints", "params": {}}'
Received 218.221405: b'{"id": 3878510400, "method": "info", "params": {}}'
Received 218.222617: b'{"id": 3878509944, "method": "objects/subscribe", "params": {"objects": {"webhooks": null}, "response_template": {"method": "process_status_update"}}}'
Received 218.223951: b'{"id": 3878510040, "method": "gcode/subscribe_output", "params": {"response_template": {"method": "process_gcode_response"}}}'
Received 218.225503: b'{"id": 3878510040, "method": "list_endpoints", "params": {}}'
Received 218.227163: b'{"id": 3878218936, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null}, "response_template": {"method": "process_status_update"}}}'
Received 218.474974: b'{"id": 3878510040, "method": "objects/list", "params": {}}'
Received 218.476183: b'{"id": 3878509944, "method": "register_remote_method", "params": {"response_template": {"method": "shutdown_machine"}, "remote_method": "shutdown_machine"}}'
Received 218.478233: b'{"id": 3878510304, "method": "register_remote_method", "params": {"response_template": {"method": "reboot_machine"}, "remote_method": "reboot_machine"}}'
Received 218.479945: b'{"id": 3878492144, "method": "register_remote_method", "params": {"response_template": {"method": "pause_job_queue"}, "remote_method": "pause_job_queue"}}'
Received 218.481817: b'{"id": 3878510232, "method": "register_remote_method", "params": {"response_template": {"method": "start_job_queue"}, "remote_method": "start_job_queue"}}'
Received 218.485677: b'{"id": 3878133544, "method": "objects/query", "params": {"objects": {"heaters": null}}}'
Received 218.485971: b'{"id": 3878219440, "method": "objects/query", "params": {"objects": {"heaters": null}}}'
Received 218.490119: b'{"id": 3878216776, "method": "info", "params": {}}'
Received 218.493035: b'{"id": 3876473992, "method": "objects/list", "params": {}}'
Received 218.493640: b'{"id": 3876473392, "method": "gcode/help", "params": {}}'
Received 218.504987: b'{"id": 3907293272, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null, "configfile": null, "mcu": null, "gcode_move": null, "idle_timeout": null, "system_stats": null, "manual_probe": null, "toolhead": null}, "response_template": {"method": "process_status_update"}}}'
Received 218.727599: b'{"id": 3878133544, "method": "objects/subscribe", "params": {"objects": {"webhooks": null, "print_stats": null, "configfile": null, "mcu": null, "gcode_move": null, "idle_timeout": null, "system_stats": null, "manual_probe": null, "toolhead": null}, "response_template": {"method": "process_status_update"}}}'
gcode state: absolute_coord=True absolute_extrude=True base_position=[0.0, 0.0, 0.0, 0.0] last_position=[0.0, 0.0, 0.0, 0.0] homing_position=[0.0, 0.0, 0.0, 0.0] speed_factor=0.016666666666666666 extrude_factor=1.0 speed=25.0
Reactor garbage collection: (217.776624092, 0.0, 0.0)
Unable to issue reset command on MCU 'mcu'
webhooks client 4131275776: Disconnected
Restarting printer
Start printer at Fri Jul  7 16:39:21 2023 (1688740761.1 783.8)
===== Config file =====
[mcu]
serial = /dev/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:35:17 2023 (1688740517.4 29.9)
===== Config file =====
[mcu]
serial = /dev/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:43:57 2023 (1688741037.6 216.3)
===== Config file =====
[mcu]
serial = /dev/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
webhooks client 4131656704: New connection
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:42:59 2023 (1688740979.8 31.0)
===== Config file =====
[mcu]
serial = /dev/ttyAMA0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:47:40 2023 (1688741260.6 119.9)
===== Config file =====
[mcu]
serial = /dev/serial1

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
webhooks client 4125079392: New connection
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 16:48:19 2023 (1688741299.2 158.5)
===== Config file =====
[mcu]
serial = /dev/serial1

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
webhooks client 4127274848: New connection
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 17:00:15 2023 (1688742015.5 26.4)
===== Config file =====
[mcu]
serial = /dev/serial1

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
webhooks client 4126819328: New connection
webhooks client 4126819328: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
mcu 'mcu': Unable to open serial port: Could not configure port: (5, 'Input/output error')
Attempting MCU 'mcu' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 323, in _reconfigure_port
    orig_attr = termios.tcgetattr(self.fd)
termios.error: (5, 'Input/output error')

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 949, in _firmware_restart
    self._restart_arduino()
  File "/home/rudis1261/klipper/klippy/mcu.py", line 909, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 272, in open
    self._reconfigure_port(force_update=True)
  File "/home/rudis1261/klippy-env/lib/python3.9/site-packages/serial/serialposix.py", line 326, in _reconfigure_port
    raise SerialException("Could not configure port: {}".format(msg))
serial.serialutil.SerialException: Could not configure port: (5, 'Input/output error')
Restarting printer
Start printer at Fri Jul  7 17:01:22 2023 (1688742082.1 74.9)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4126071704: New connection
webhooks client 4126071704: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 17:01:35 2023 (1688742095.8 88.6)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4129178624: New connection
webhooks client 4129178624: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 17:02:26 2023 (1688742146.4 139.2)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4125209648: New connection
webhooks client 4125209648: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4125209648: Disconnected
Restarting printer
Start printer at Fri Jul  7 17:03:26 2023 (1688742206.3 199.1)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4128733552: New connection
webhooks client 4128733552: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 17:03:30 2023 (1688742210.0 202.8)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4124316720: New connection
webhooks client 4124316720: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
MCU error during connect
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/mcu.py", line 798, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 803, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'mcu': Unable to connect
Build file /home/rudis1261/klipper/klippy/../.config(3289): Fri Jul  7 16:49:52 2023
========= Last MCU build config =========
CONFIG_LOW_LEVEL_OPTIONS=y
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
CONFIG_MACH_STM32=y
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="stm32"
CONFIG_MCU="stm32f446xx"
CONFIG_CLOCK_FREQ=180000000
CONFIG_SERIAL=y
CONFIG_FLASH_SIZE=0x80000
CONFIG_FLASH_BOOT_ADDRESS=0x8000000
CONFIG_RAM_START=0x20000000
CONFIG_RAM_SIZE=0x20000
CONFIG_STACK_SIZE=512
CONFIG_FLASH_APPLICATION_ADDRESS=0x8008000
CONFIG_STM32_SELECT=y
# CONFIG_MACH_STM32F103 is not set
# CONFIG_MACH_STM32F207 is not set
# CONFIG_MACH_STM32F401 is not set
# CONFIG_MACH_STM32F405 is not set
# CONFIG_MACH_STM32F407 is not set
# CONFIG_MACH_STM32F429 is not set
CONFIG_MACH_STM32F446=y
# CONFIG_MACH_STM32F765 is not set
# CONFIG_MACH_STM32F031 is not set
# CONFIG_MACH_STM32F042 is not set
# CONFIG_MACH_STM32F070 is not set
# CONFIG_MACH_STM32F072 is not set
# CONFIG_MACH_STM32G070 is not set
# CONFIG_MACH_STM32G071 is not set
# CONFIG_MACH_STM32G0B0 is not set
# CONFIG_MACH_STM32G0B1 is not set
# CONFIG_MACH_STM32G431 is not set
# CONFIG_MACH_STM32H723 is not set
# CONFIG_MACH_STM32H743 is not set
# CONFIG_MACH_STM32H750 is not set
# CONFIG_MACH_STM32L412 is not set
# CONFIG_MACH_N32G452 is not set
# CONFIG_MACH_N32G455 is not set
CONFIG_MACH_STM32F4=y
CONFIG_HAVE_STM32_USBOTG=y
CONFIG_HAVE_STM32_CANBUS=y
CONFIG_HAVE_STM32_USBCANBUS=y
CONFIG_STM32_DFU_ROM_ADDRESS=0
CONFIG_STM32_FLASH_START_8000=y
# CONFIG_STM32_FLASH_START_10000 is not set
# CONFIG_STM32_FLASH_START_0000 is not set
# CONFIG_STM32_CLOCK_REF_8M is not set
CONFIG_STM32_CLOCK_REF_12M=y
# CONFIG_STM32_CLOCK_REF_16M is not set
# CONFIG_STM32_CLOCK_REF_20M is not set
# CONFIG_STM32_CLOCK_REF_24M is not set
# CONFIG_STM32_CLOCK_REF_25M is not set
# CONFIG_STM32_CLOCK_REF_INTERNAL is not set
CONFIG_CLOCK_REF_FREQ=12000000
CONFIG_STM32F0_TRIM=16
# CONFIG_STM32_USB_PA11_PA12 is not set
# CONFIG_STM32_SERIAL_USART1 is not set
# CONFIG_STM32_SERIAL_USART1_ALT_PB7_PB6 is not set
# CONFIG_STM32_SERIAL_USART2 is not set
CONFIG_STM32_SERIAL_USART2_ALT_PD6_PD5=y
# CONFIG_STM32_SERIAL_USART3 is not set
# CONFIG_STM32_SERIAL_USART3_ALT_PD9_PD8 is not set
# CONFIG_STM32_CANBUS_PA11_PA12 is not set
# CONFIG_STM32_CANBUS_PA11_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB8_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PI9_PH13 is not set
# CONFIG_STM32_MMENU_CANBUS_PB5_PB6 is not set
# CONFIG_STM32_MMENU_CANBUS_PB12_PB13 is not set
# CONFIG_STM32_MMENU_CANBUS_PD0_PD1 is not set
# CONFIG_STM32_USBCANBUS_PA11_PA12 is not set
CONFIG_SERIAL_BAUD=250000
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER="12345"
CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_INITIAL_PINS=""
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_SDIO=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_HAVE_BOOTLOADER_REQUEST=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/rudis1261/klipper/klippy/../out/klipper.dict(8561): Fri Jul  7 16:51:08 2023
Last MCU build version: v0.11.0-240-g6d48adf9
Last MCU build tools: gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34
Last MCU build config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PD6,PD5 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Build file /home/rudis1261/klipper/klippy/../out/klipper.elf(1243088): Fri Jul  7 16:51:30 2023
webhooks client 4124316720: Disconnected
Restarting printer
Start printer at Fri Jul  7 17:10:41 2023 (1688742641.9 634.7)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4123568808: New connection
webhooks client 4123568808: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
MCU error during connect
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/mcu.py", line 798, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 803, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'mcu': Unable to connect
Build file /home/rudis1261/klipper/klippy/../.config(3289): Fri Jul  7 16:49:52 2023
========= Last MCU build config =========
CONFIG_LOW_LEVEL_OPTIONS=y
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
CONFIG_MACH_STM32=y
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="stm32"
CONFIG_MCU="stm32f446xx"
CONFIG_CLOCK_FREQ=180000000
CONFIG_SERIAL=y
CONFIG_FLASH_SIZE=0x80000
CONFIG_FLASH_BOOT_ADDRESS=0x8000000
CONFIG_RAM_START=0x20000000
CONFIG_RAM_SIZE=0x20000
CONFIG_STACK_SIZE=512
CONFIG_FLASH_APPLICATION_ADDRESS=0x8008000
CONFIG_STM32_SELECT=y
# CONFIG_MACH_STM32F103 is not set
# CONFIG_MACH_STM32F207 is not set
# CONFIG_MACH_STM32F401 is not set
# CONFIG_MACH_STM32F405 is not set
# CONFIG_MACH_STM32F407 is not set
# CONFIG_MACH_STM32F429 is not set
CONFIG_MACH_STM32F446=y
# CONFIG_MACH_STM32F765 is not set
# CONFIG_MACH_STM32F031 is not set
# CONFIG_MACH_STM32F042 is not set
# CONFIG_MACH_STM32F070 is not set
# CONFIG_MACH_STM32F072 is not set
# CONFIG_MACH_STM32G070 is not set
# CONFIG_MACH_STM32G071 is not set
# CONFIG_MACH_STM32G0B0 is not set
# CONFIG_MACH_STM32G0B1 is not set
# CONFIG_MACH_STM32G431 is not set
# CONFIG_MACH_STM32H723 is not set
# CONFIG_MACH_STM32H743 is not set
# CONFIG_MACH_STM32H750 is not set
# CONFIG_MACH_STM32L412 is not set
# CONFIG_MACH_N32G452 is not set
# CONFIG_MACH_N32G455 is not set
CONFIG_MACH_STM32F4=y
CONFIG_HAVE_STM32_USBOTG=y
CONFIG_HAVE_STM32_CANBUS=y
CONFIG_HAVE_STM32_USBCANBUS=y
CONFIG_STM32_DFU_ROM_ADDRESS=0
CONFIG_STM32_FLASH_START_8000=y
# CONFIG_STM32_FLASH_START_10000 is not set
# CONFIG_STM32_FLASH_START_0000 is not set
# CONFIG_STM32_CLOCK_REF_8M is not set
CONFIG_STM32_CLOCK_REF_12M=y
# CONFIG_STM32_CLOCK_REF_16M is not set
# CONFIG_STM32_CLOCK_REF_20M is not set
# CONFIG_STM32_CLOCK_REF_24M is not set
# CONFIG_STM32_CLOCK_REF_25M is not set
# CONFIG_STM32_CLOCK_REF_INTERNAL is not set
CONFIG_CLOCK_REF_FREQ=12000000
CONFIG_STM32F0_TRIM=16
# CONFIG_STM32_USB_PA11_PA12 is not set
# CONFIG_STM32_SERIAL_USART1 is not set
# CONFIG_STM32_SERIAL_USART1_ALT_PB7_PB6 is not set
# CONFIG_STM32_SERIAL_USART2 is not set
CONFIG_STM32_SERIAL_USART2_ALT_PD6_PD5=y
# CONFIG_STM32_SERIAL_USART3 is not set
# CONFIG_STM32_SERIAL_USART3_ALT_PD9_PD8 is not set
# CONFIG_STM32_CANBUS_PA11_PA12 is not set
# CONFIG_STM32_CANBUS_PA11_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB8_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PI9_PH13 is not set
# CONFIG_STM32_MMENU_CANBUS_PB5_PB6 is not set
# CONFIG_STM32_MMENU_CANBUS_PB12_PB13 is not set
# CONFIG_STM32_MMENU_CANBUS_PD0_PD1 is not set
# CONFIG_STM32_USBCANBUS_PA11_PA12 is not set
CONFIG_SERIAL_BAUD=250000
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER="12345"
CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_INITIAL_PINS=""
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_SDIO=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_HAVE_BOOTLOADER_REQUEST=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/rudis1261/klipper/klippy/../out/klipper.dict(8561): Fri Jul  7 16:51:08 2023
Last MCU build version: v0.11.0-240-g6d48adf9
Last MCU build tools: gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34
Last MCU build config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PD6,PD5 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Build file /home/rudis1261/klipper/klippy/../out/klipper.elf(1243088): Fri Jul  7 16:51:30 2023
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 17:13:36 2023 (1688742816.5 809.3)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
webhooks client 4128355376: New connection
webhooks client 4128355376: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
mcu 'mcu': Unable to open serial port: [Errno 13] could not open port /dev/serial0: [Errno 13] Permission denied: '/dev/serial0'
MCU error during connect
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/mcu.py", line 798, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/rudis1261/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'mcu': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
  File "/home/rudis1261/klipper/klippy/mcu.py", line 803, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'mcu': Unable to connect
Build file /home/rudis1261/klipper/klippy/../.config(3289): Fri Jul  7 16:49:52 2023
========= Last MCU build config =========
CONFIG_LOW_LEVEL_OPTIONS=y
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
CONFIG_MACH_STM32=y
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="stm32"
CONFIG_MCU="stm32f446xx"
CONFIG_CLOCK_FREQ=180000000
CONFIG_SERIAL=y
CONFIG_FLASH_SIZE=0x80000
CONFIG_FLASH_BOOT_ADDRESS=0x8000000
CONFIG_RAM_START=0x20000000
CONFIG_RAM_SIZE=0x20000
CONFIG_STACK_SIZE=512
CONFIG_FLASH_APPLICATION_ADDRESS=0x8008000
CONFIG_STM32_SELECT=y
# CONFIG_MACH_STM32F103 is not set
# CONFIG_MACH_STM32F207 is not set
# CONFIG_MACH_STM32F401 is not set
# CONFIG_MACH_STM32F405 is not set
# CONFIG_MACH_STM32F407 is not set
# CONFIG_MACH_STM32F429 is not set
CONFIG_MACH_STM32F446=y
# CONFIG_MACH_STM32F765 is not set
# CONFIG_MACH_STM32F031 is not set
# CONFIG_MACH_STM32F042 is not set
# CONFIG_MACH_STM32F070 is not set
# CONFIG_MACH_STM32F072 is not set
# CONFIG_MACH_STM32G070 is not set
# CONFIG_MACH_STM32G071 is not set
# CONFIG_MACH_STM32G0B0 is not set
# CONFIG_MACH_STM32G0B1 is not set
# CONFIG_MACH_STM32G431 is not set
# CONFIG_MACH_STM32H723 is not set
# CONFIG_MACH_STM32H743 is not set
# CONFIG_MACH_STM32H750 is not set
# CONFIG_MACH_STM32L412 is not set
# CONFIG_MACH_N32G452 is not set
# CONFIG_MACH_N32G455 is not set
CONFIG_MACH_STM32F4=y
CONFIG_HAVE_STM32_USBOTG=y
CONFIG_HAVE_STM32_CANBUS=y
CONFIG_HAVE_STM32_USBCANBUS=y
CONFIG_STM32_DFU_ROM_ADDRESS=0
CONFIG_STM32_FLASH_START_8000=y
# CONFIG_STM32_FLASH_START_10000 is not set
# CONFIG_STM32_FLASH_START_0000 is not set
# CONFIG_STM32_CLOCK_REF_8M is not set
CONFIG_STM32_CLOCK_REF_12M=y
# CONFIG_STM32_CLOCK_REF_16M is not set
# CONFIG_STM32_CLOCK_REF_20M is not set
# CONFIG_STM32_CLOCK_REF_24M is not set
# CONFIG_STM32_CLOCK_REF_25M is not set
# CONFIG_STM32_CLOCK_REF_INTERNAL is not set
CONFIG_CLOCK_REF_FREQ=12000000
CONFIG_STM32F0_TRIM=16
# CONFIG_STM32_USB_PA11_PA12 is not set
# CONFIG_STM32_SERIAL_USART1 is not set
# CONFIG_STM32_SERIAL_USART1_ALT_PB7_PB6 is not set
# CONFIG_STM32_SERIAL_USART2 is not set
CONFIG_STM32_SERIAL_USART2_ALT_PD6_PD5=y
# CONFIG_STM32_SERIAL_USART3 is not set
# CONFIG_STM32_SERIAL_USART3_ALT_PD9_PD8 is not set
# CONFIG_STM32_CANBUS_PA11_PA12 is not set
# CONFIG_STM32_CANBUS_PA11_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB8_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PI9_PH13 is not set
# CONFIG_STM32_MMENU_CANBUS_PB5_PB6 is not set
# CONFIG_STM32_MMENU_CANBUS_PB12_PB13 is not set
# CONFIG_STM32_MMENU_CANBUS_PD0_PD1 is not set
# CONFIG_STM32_USBCANBUS_PA11_PA12 is not set
CONFIG_SERIAL_BAUD=250000
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER="12345"
CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_INITIAL_PINS=""
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_SDIO=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_HAVE_BOOTLOADER_REQUEST=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/rudis1261/klipper/klippy/../out/klipper.dict(8561): Fri Jul  7 16:51:08 2023
Last MCU build version: v0.11.0-240-g6d48adf9
Last MCU build tools: gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34
Last MCU build config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PD6,PD5 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Build file /home/rudis1261/klipper/klippy/../out/klipper.elf(1243088): Fri Jul  7 16:51:30 2023
Starting Klippy...
Args: ['/home/rudis1261/klipper/klippy/klippy.py', '/home/rudis1261/printer_data/config/printer.cfg', '-I', '/home/rudis1261/printer_data/comms/klippy.serial', '-l', '/home/rudis1261/printer_data/logs/klippy.log', '-a', '/home/rudis1261/printer_data/comms/klippy.sock']
Git version: 'v0.11.0-240-g6d48adf9'
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.9.2 (default, Mar 12 2021, 04:06:34) \n[GCC 10.2.1 20210110]'
Start printer at Fri Jul  7 17:17:29 2023 (1688743049.0 26.0)
===== Config file =====
[mcu]
serial = /dev/serial0

[printer]
kinematics = none
max_velocity = 1000
max_accel = 1000
=======================
mcu 'mcu': Starting serial connect
Loaded MCU 'mcu' 119 commands (v0.11.0-240-g6d48adf9 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
webhooks client 4131294416: New connection
webhooks client 4131294416: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
webhooks: registering remote method 'shutdown_machine' for connection id: 4131294416
webhooks: registering remote method 'reboot_machine' for connection id: 4131294416
webhooks: registering remote method 'pause_job_queue' for connection id: 4131294416
webhooks: registering remote method 'start_job_queue' for connection id: 4131294416
webhooks client 4131294416: Disconnected
Restarting printer
Start printer at Fri Jul  7 19:12:44 2023 (1688749964.6 6924.0)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	END_PRINT

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME
	wipe_nozzle

[probe]
pin = PG13
x_offset = -25.0
y_offset = -1.88
z_offset = 9.075

[heater_bed]
heater_pin = PA3
sensor_pin = PF3
sensor_type = Generic 3950
smooth_time = 3.0
max_power = 0.60
control = pid
pid_kp = 31.649
pid_ki = 1.901
pid_kd = 131.740
min_temp = -200
max_temp = 130

[bed_mesh]
speed = 200
horizontal_move_z = 10
mesh_min = 10, 7
mesh_max = 155, 165
probe_count = 5,5
fade_start = 0.5
fade_end = 2
split_delta_z = .025
move_check_distance = 5.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = 0.1
relative_reference_index = 12

[z_tilt]
z_positions = 
	-74.0, -18.0
	76.0,  217.0
	226.0, -18.0
points = 
	45, 25
	101, 160
	175, 25
speed = 200
horizontal_move_z = 20.0
retries = 4
retry_tolerance = 0.05

[stepper_z]
enable_pin = !PG2
step_pin = !PF9
dir_pin = !PF10
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
position_max = 180
position_min = -5
homing_speed = 15.0
second_homing_speed = 5.0
homing_retract_dist = 10.0
homing_positive_dir = false

[tmc2208 stepper_z]
uart_pin = PF2
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z1]
enable_pin = !PF1
step_pin = !PC13
dir_pin = !PF0
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z1]
uart_pin = PE4
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z2]
enable_pin = !PD4
step_pin = !PE2
dir_pin = PE3
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z2]
uart_pin = PE1
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_x]
enable_pin = !PA0
step_pin = PG4
dir_pin = !PC1
endstop_pin = tmc2209_stepper_x:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -8
position_endstop = 180
position_max = 180
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0
homing_positive_dir = true

[tmc2209 stepper_x]
diag_pin = PG11
uart_pin = PC7
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_x1]
enable_pin = !PF15
step_pin = PG0
dir_pin = PG1
endstop_pin = tmc2209_stepper_x1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_x1]
diag_pin = PG9
uart_pin = PD11
interpolate = false
run_current = 0.85
sense_resistor = 0.110
driver_sgthrs = 125
stealthchop_threshold = 999999

[stepper_y]
enable_pin = !PG5
step_pin = PF11
dir_pin = PG3
endstop_pin = tmc2209_stepper_y:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -5
position_endstop = -2
position_max = 184
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0

[tmc2209 stepper_y]
diag_pin = PG10
uart_pin = PC6
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_y1]
enable_pin = !PF14
step_pin = PF13
dir_pin = !PF12
endstop_pin = tmc2209_stepper_y1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_y1]
diag_pin = PG6
uart_pin = PC4
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[gcode_macro nozzle_clean]
gcode = 
	SAVE_GCODE_STATE NAME=clean_nozzle_state
	Wipe_Nozzle
	RESTORE_GCODE_STATE NAME=clean_nozzle_state MOVE=1

[gcode_macro Nozzle_Wiper_Variables]
variable_purge_x = -8
variable_purge_y = 110
variable_purge_x_entry = 0
variable_purge_y_entry = 110
variable_wipe_dx = 0
variable_wipe_dy = 16
variable_wipe_count = 4
variable_travel_speed = 300
variable_entry_speed = 100
variable_wipe_speed = 50
variable_purge_speed = 4
variable_purge_fan = 255
variable_wipe_fan = 128
gcode = 

[gcode_macro Go_To_Purge_Location]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set St = printer["gcode_macro Nozzle_Wiper_Variables"].travel_speed * 60 %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	
	{% if not (printer.toolhead.position.x == Px and printer.toolhead.position.y == Py) %}
	G1 X{Pxe} Y{Pye} F{St}
	G1 X{Px} Y{Py} F{Se}
	{% endif %}

[gcode_macro Wipe_Nozzle]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set Wdx = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dx|float %}
	{% set Wdy = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dy|float %}
	{% set Wc = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_count|int %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	{% set Sw = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_fan %}
	{% set old_Sf = params.OLD_FAN_SPEED|default(printer.fan.speed)|int %}
	
	{% if printer.fan.speed < Sf %}
	{% set wait_for_fan = True %}
	{% else %}
	{% set wait_for_fan = False %}
	{% endif %}
	
	
	Go_To_Purge_Location
	
	
	M106 S{Sf}
	
	
	{% if wait_for_fan %}
	G4 P800
	{% endif %}
	
	
	G1 X{Px + Wdx} Y{Py + Wdy} F12000
	{% for i in range(Wc) %}
	G1 X{Px} Y{Py} F{Sw}
	G1 X{Px + Wdx} Y{Py + Wdy} F{Sw}
	{% endfor %}
	
	
	G1 X{Pxe + Wdx} Y{Pye + Wdy} F{Se}
	
	
	M106 S{old_Sf}

[gcode_macro Purge]
gcode = 
	{% set TEMPERATURE = params.DEFAULT_TEMPERATURE|default(230)|float %}
	{% set EXACT_TEMP = params.EXACT_EXTRUDER_TEMP|default(0)|int %}
	{% set FEED_AMOUNT = params.DEFAULT_FEED_AMOUNT|default(50)|int %}
	{% set Sp = printer["gcode_macro Nozzle_Wiper_Variables"].purge_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].purge_fan %}
	{% set old_Sf = printer.fan.speed %}
	
	
	Go_To_Purge_Location
	
	
	{% if EXACT_TEMP|int == 1 and printer.extruder.temperature < TEMPERATURE %}
	M109 S{TEMPERATURE}
	{% endif %}
	
	
	M106 S{Sf}
	
	
	M83
	G1 E{FEED_AMOUNT|float - 3} F{Sp}
	G1 E5 F{Sp}
	G92 E0.0
	
	
	G4 P800
	
	
	Wipe_Nozzle OLD_FAN_SPEED={old_Sf}

[board_pins]
aliases = 
	
	EXP1_1=PE8, EXP1_2=PE7,
	EXP1_3=PE9, EXP1_4=PE10,
	EXP1_5=PE12, EXP1_6=PE13,
	EXP1_7=PE14, EXP1_8=PE15,
	EXP1_9=<GND>, EXP1_10=<5V>,
	
	
	EXP2_1=PA6, EXP2_2=PA5,
	EXP2_3=PB1, EXP2_4=PA4,
	EXP2_5=PB2, EXP2_6=PA7,
	EXP2_7=PC15, EXP2_8=<RST>,
	EXP2_9=<GND>, EXP2_10=<5V>

[gcode_macro _User_Variables]
variable_verbose = True
variable_debug = False
variable_travel_speed = 200
variable_move_accel = 1000
variable_dock_speed = 50
variable_release_speed = 75
variable_z_drop_speed = 20
variable_safe_z = 15
variable_enable_z_hop = True
variable_max_bed_y = 182
variable_max_bed_x = 182
variable_z_endstop_x = 0
variable_z_endstop_y = 0
variable_docklocation_x = -8
variable_docklocation_y = 181
variable_docklocation_z = -128
variable_enable_dock_servo = False
variable_servo_name = 'NAME'
variable_servo_deploy = 10
variable_servo_retract = 11
variable_servo_delay = 250
variable_dockmove_x = 0
variable_dockmove_y = -50
variable_dockmove_z = 0
variable_attachmove_x = -50
variable_attachmove_y = 0
variable_attachmove_z = 0
variable_umbilical = False
variable_umbilical_x = 40
variable_umbilical_y = 40
variable_park_toolhead = True
variable_parkposition_x = 40
variable_parkposition_y = 181
variable_parkposition_z = 10
variable_version = 1
variable_attachmove2_x = 0
variable_attachmove2_y = 0
variable_attachmove2_z = 0
variable_home_backoff_x = 10
variable_home_backoff_y = 10
variable_override_homing = 'X'
variable_dock_on_zhome = False
variable_bypass_probe_docking = False
gcode = 
	{% set Mx = printer['configfile'].config["stepper_x"]["position_max"]|float %}
	{% set My = printer['configfile'].config["stepper_y"]["position_max"]|float %}
	{% set Ox = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set Oy = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set Oz = printer['configfile'].config["probe"]["z_offset"]|float %}
	
	
	{% if z_endstop_x != 0 or z_endstop_y != 0 %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ z_endstop_x }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ z_endstop_y }
	
	
	{% else %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ (Mx * 0.5) - Ox }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ (My * 0.5) - Oy }
	{% endif %}

[respond]

[gcode_macro _Probe_Variables]
variable_probe_attached = False
variable_probe_state = False
variable_probe_lock = False
variable_z_endstop_x = 0
variable_z_endstop_y = 0
gcode = 

[gcode_macro _klicky_check_variables_version]
gcode = 
	{% set version = printer["gcode_macro _User_Variables"].version|default(0) %}
	
	{% if version != 1 %}
	{ action_raise_error("Please update your klicky variables, there are some functionality changes") }
	{% endif %}

[gcode_macro _KlickyDebug]
gcode = 
	{% set message  = params.MSG %}
	{% set debug = printer["gcode_macro _User_Variables"].debug|default(False) %}
	
	{% if debug %}
	{ action_respond_info(message) }
	{% endif %}

[gcode_macro _exit_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move  = params.MOVE|default(0) %}
	{% set speed = printer["gcode_macro _User_Variables"].travel_speed %}
	
	
	M400
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	RESTORE_GCODE_STATE NAME={function} MOVE={move} MOVE_SPEED={speed}

[gcode_macro _entry_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move_accel = printer["gcode_macro _User_Variables"].move_accel|default(1000) %}
	
	M400
	SAVE_GCODE_STATE NAME={function}
	
	SET_GCODE_OFFSET Z=0
	
	G90
	
	SET_VELOCITY_LIMIT ACCEL={move_accel}

[gcode_macro _Homing_Variables]
gcode = 
	{% set reset  = params.RESET|default(0) %}
	{% if reset %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }
	{% endif %}

[gcode_macro Attach_Probe_Lock]
description = Attaches Klicky Probe, can only be docked after unlocking
gcode = 
	Attach_Probe
	_Probe_Lock

[gcode_macro Dock_Probe_Unlock]
description = Docks Klicky Probe even if it was locked
gcode = 
	_Probe_Unlock
	Dock_Probe

[gcode_macro _Probe_Unlock]
description = Unlocks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to False"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }

[gcode_macro _Probe_Lock]
description = Locks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to True"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ True }

[gcode_macro _DeployKlickyDock]
description = Deploys Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_deploy = printer["gcode_macro _User_Variables"].servo_deploy|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_DeployKlickyDock Klicky servo configuration enabled"
	{% if servo_deploy == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo deploy angle specified") }
	{% endif %}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _DeployDock"] is defined %}
	_KlickyDebug msg="_DeployKlickyDock calling _DeployDock"
	_DeployDock
	{% endif %}

[gcode_macro _RetractKlickyDock]
description = Retracts Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_retract = printer["gcode_macro _User_Variables"].servo_retract|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_RetractKlickyDock Klicky servo configuration enabled"
	{% if servo_retract == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo retract angle specified") }
	{% endif %}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _RetractDock"] is defined %}
	_KlickyDebug msg="_RetractKlickyDock calling _RetractDock"
	_RetractDock
	{% endif %}

[gcode_macro Attach_Probe]
description = Attaches Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set attachmove2_x = printer["gcode_macro _User_Variables"].attachmove2_x|default(0) %}
	{% set attachmove2_y = printer["gcode_macro _User_Variables"].attachmove2_y|default(0) %}
	{% set attachmove2_z = printer["gcode_macro _User_Variables"].attachmove2_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	_entry_point function=Attach_Probe
	
	{% if bypass_probe_docking == False %}
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	_KlickyDebug msg="Attach_Probe Axis homed"
	
	
	{% elif not probe_attached and not probe_lock %}
	_KlickyDebug msg="Attach_Probe going to attach probe"
	{% if verbose %}
	{ action_respond_info("Attaching Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% if not enable_z_hop %}
	_KlickyDebug msg="Attach_Probe z_hop disabled"
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero, duplicate?") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	_entry_point function=Attach_Probe_intern
	
	
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}"
	G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Attach_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	_CheckProbe action=attach
	
	_exit_point function=Attach_Probe_intern move={goback}
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe locked not attaching probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already attached!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe already attached, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Attach_Probe
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro Dock_Probe]
description = Docks Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	{% if bypass_probe_docking == False %}
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}
	
	
	{% if bypass_probe_docking == False %}
	_entry_point function=Dock_Probe
	
	
	{% if probe_attached and not probe_lock %}
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% endif %}
	_KlickyDebug msg="Dock_Probe Axis homed"
	_KlickyDebug msg="Dock_Probe going to dock probe"
	{% if verbose %}
	{ action_respond_info("Docking Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Dock_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}"
	G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}
	{% endif %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving away from the dock to G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Dock_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	G4 P1000
	_CheckProbe action=dock
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe locked not docking probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already docked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe already docked, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Dock_Probe move={goback}
	{% else %}
	_KlickyDebug msg="Dock_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro PROBE_CALIBRATE]
rename_existing = _PROBE_CALIBRATE
description = Calibrate the probes z_offset with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_calibrate Axis homed"
	_KlickyDebug msg="probe_calibrate Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_CALIBRATE with the probe above the BED, check klicky_variables bed size!") }
	{% endif %}
	
	{% if bypass_probe_docking == False %}
	_CheckProbe action=query
	G90
	Attach_Probe back=1
	_KLICKY_STATUS_CALIBRATING_Z
	
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	M118 moving the toolhead 20 mm from the bed
	_KlickyDebug msg="probe_calibrate Moving Z up by 20mm"
	TESTZ Z=20
	M118 remove manually the probe and continue calibration
	_KLICKY_STATUS_READY
	{% else %}
	_KLICKY_STATUS_CALIBRATING_Z
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	_KLICKY_STATUS_READY
	{% endif %}

[gcode_macro PROBE_ACCURACY]
rename_existing = _PROBE_ACCURACY
description = Probe Z-height accuracy at current XY position with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_accuracy Axis homed"
	_KlickyDebug msg="probe_accuracy Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	_entry_point function=PROBE_ACCURACY
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_ACCURACY with the probe above the BED, check klicky_variables bed size!") }
	{% endif%}
	
	_CheckProbe action=query
	Attach_Probe back=1
	
	_KlickyDebug msg="probe_accuracy calling klipper probe accuracy"
	_PROBE_ACCURACY {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	Dock_Probe back=1
	
	_exit_point function=PROBE_ACCURACY move=1

[force_move]
enable_force_move = True

[homing_override]
axes = xyz
gcode = 
	
	_User_Variables
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	{% set kinematic_z = 0 %}
	{% set dock_on_zhome = printer["gcode_macro _User_Variables"].dock_on_zhome|default(True) %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set home_backoff_x = printer["gcode_macro _User_Variables"].home_backoff_x|default(0) %}
	{% set home_backoff_y = printer["gcode_macro _User_Variables"].home_backoff_y|default(0) %}
	{% set override_homing = printer["gcode_macro _User_Variables"].override_homing|default('') %}
	
	
	_klicky_check_variables_version
	
	_CheckProbe action=query
	
	
	{% set home_x, home_y, home_z, leave_probe_attached = False, False, False, False %}
	
	{% if 'PROBE_LOCK' in params%}
	{% if verbose %}
	{ action_respond_info("PROBE_LOCK = True") }
	{% endif %}
	{% set leave_probe_attached = True %}
	{% endif %}
	
	
	{% if not 'X' in params
	and not 'Y' in params
	and not 'Z' in params %}
	
	{% set home_x, home_y, home_z = True, True, True %}
	_KlickyDebug msg="homing_override goint to home all axes"
	
	{% else %}
	{% if 'X' in params %}
	{% set home_x = True %}
	_KlickyDebug msg="homing_override goint to home X"
	
	{% endif %}
	
	{% if 'Y' in params %}
	{% set home_y = True %}
	_KlickyDebug msg="homing_override goint to home Y"
	{% endif %}
	
	{% if 'Z' in params %}
	{% set home_z = True %}
	_KlickyDebug msg="homing_override goint to home Z"
	{% endif %}
	
	{% if 'X' in params
	and 'Y' in params
	and 'Z' in params %}
	
	
	_Homing_Variables reset=1
	_KlickyDebug msg="homing_override goint to home all axes"
	{% endif %}
	
	{% endif %}
	
	_entry_point function=homing_override
	_KLICKY_STATUS_HOMING
	
	
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% if not enable_z_hop %}
	_KlickyDebug msg="homing_override z_hop disabled"
	
	{% set kinematic_z = safe_z %}
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes and 'z' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("No axis homed") }
	{% endif %}
	_KlickyDebug msg="homing_override no axis homed, setting position as X=Y=0 Z={kinematic_z}"
	SET_KINEMATIC_POSITION X=0 Y=0 Z={kinematic_z}
	M400
	_KlickyDebug msg="homing_override moving toolhead to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	_KlickyDebug msg="homing_override clearing axis homed state"
	M84
	{% endif %}
	
	{% if home_z %}
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("X or Y not homed, forcing full G28") }
	{% endif %}
	{% set home_x, home_y, home_z = True, True, True %}
	{% endif %}
	{% endif %}
	
	
	{% if ((attachmove_y == 0 and override_homing == '' ) or (override_homing == 'Y'))%}
	
	{% if home_y %}
	{% if override_homing == 'Y' %}
	_KlickyDebug msg="homing_override Y homing first override, due to override_homing = Y"
	{% else %}
	_KlickyDebug msg="homing_override Y homing first override, due to attachmove_y = 0"
	{% endif %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y G28 Y0"
	G28 Y0
	
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop-home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	{% set home_y = False %}
	{% endif %}
	
	
	
	{% if home_x %}
	{% if verbose %}
	{ action_respond_info("Homing X") }
	{% endif %}
	{% if printer["gcode_macro _HOME_X"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_X external script to handle the X homing"
	_HOME_X
	{% else %}
	_KlickyDebug msg="homing_override Homing X, G28 X0"
	G28 X0
	
	{% if home_backoff_x != 0 %}
	{% if (printer.configfile.settings.stepper_x.position_endstop > (printer.configfile.settings.stepper_x.position_min|default(0) + printer.configfile.settings.stepper_x.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	
	{% if home_y %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y, G28 Y0"
	G28 Y0
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	{% if home_z %}
	{% if verbose %}
	{ action_respond_info("Homing Z") }
	{% endif %}
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe configured as a virtual Z endstop attaching probe"
	Attach_Probe
	
	{% if leave_probe_attached %}
	_Probe_Lock
	{% endif %}
	{% elif dock_on_zhome == True %}
	Dock_Probe
	{% endif %}
	
	_Home_Z
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe no longer required, docking probe"
	Dock_Probe
	{% elif dock_on_zhome == False %}
	Dock_Probe
	{% endif %}
	{% endif %}
	_CheckProbe action=query
	
	
	_Park_Toolhead
	
	_exit_point function=homing_override
	_KLICKY_STATUS_READY

[gcode_macro _Umbilical_Path]
gcode = 
	{% set umbilical = printer["gcode_macro _User_Variables"].umbilical %}
	{% set umbilical_x = printer["gcode_macro _User_Variables"].umbilical_x %}
	{% set umbilical_y = printer["gcode_macro _User_Variables"].umbilical_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	
	{% if umbilical %}
	
	_entry_point function=Umbilical_Path
	
	_KlickyDebug msg="_Umbilical_Path moving to G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}"
	G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}
	
	_exit_point function=Umbilical_Path
	{% endif %}

[gcode_macro _Home_Z]
gcode = 
	{% set z_endstop_x = printer["gcode_macro _Probe_Variables"].z_endstop_x %}
	{% set z_endstop_y = printer["gcode_macro _Probe_Variables"].z_endstop_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}    {% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Home_Z
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% else %}
	_KlickyDebug msg="_Home_Z XY Axis homed"
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="_Home_Z Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	
	
	_KlickyDebug msg="_Home_Z moving to Z endstop position G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}"
	G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}
	_KlickyDebug msg="_Home_Z Homing Z G28 Z"
	G28 Z0
	_KlickyDebug msg="_Home_Z toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_exit_point function=Home_Z

[gcode_macro _CheckProbe]
variable_probe_state = 0
gcode = 
	Query_Probe
	_SetProbeState action={ params.ACTION }

[gcode_macro _SetProbeState]
gcode = 
	{% set query_probe_triggered = printer.probe.last_query %}
	{% set action  = params.ACTION|default('') %}
	
	
	{% if query_probe_triggered %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ False }
	{% else %}
	
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ True }
	{% endif %}
	
	{% if action == 'query' %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_state VALUE={ query_probe_triggered }
	{% endif %}
	
	
	
	
	{% if not query_probe_triggered and action == 'dock' %}
	{ action_raise_error("Probe dock failed!") }
	{% endif %}
	
	
	{% if query_probe_triggered and action == 'attach' %}
	{ action_raise_error("Probe attach failed!") }
	{% endif %}

[gcode_macro _Park_Toolhead]
gcode = 
	{% set park_toolhead = printer["gcode_macro _User_Variables"].park_toolhead %}
	{% set parkposition_x = printer["gcode_macro _User_Variables"].parkposition_x %}
	{% set parkposition_y = printer["gcode_macro _User_Variables"].parkposition_y %}
	{% set parkposition_z = printer["gcode_macro _User_Variables"].parkposition_z %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Park_Toolhead
	
	{% if park_toolhead and 'xyz' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Parking Toolhead") }
	{% endif %}
	{% if parkposition_z == -128 %}
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}
	
	{% else %}
	
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}
	
	{% endif %}
	
	{% endif %}
	_exit_point function=Park_Toolhead

[gcode_macro _klicky_status_ready]
gcode = 
	{% if printer['gcode_macro status_ready'] is defined %}
	_KlickyDebug msg="_klicky_status_ready activating the LED STATUS_READY"
	STATUS_READY
	{% endif %}

[gcode_macro _klicky_status_busy]
gcode = 
	{% if printer['gcode_macro status_busy'] is defined %}
	_KlickyDebug msg="_klicky_status_busy activating the LED STATUS_BUSY"
	STATUS_BUSY
	{% endif %}

[gcode_macro _klicky_status_leveling]
gcode = 
	{% if printer['gcode_macro status_leveling'] is defined %}
	_KlickyDebug msg="_klicky_status_leveling activating the LED STATUS_LEVELING"
	STATUS_LEVELING
	{% endif %}

[gcode_macro _klicky_status_homing]
gcode = 
	{% if printer['gcode_macro status_homing'] is defined %}
	_KlickyDebug msg="_klicky_status_homing activating the LED STATUS_HOMING"
	STATUS_HOMING
	{% endif %}

[gcode_macro _klicky_status_cleaning]
gcode = 
	{% if printer['gcode_macro status_cleaning'] is defined %}
	_KlickyDebug msg="_klicky_status_cleaning activating the LED STATUS_CLEANING"
	STATUS_CLEANING
	{% endif %}

[gcode_macro _klicky_status_meshing]
gcode = 
	{% if printer['gcode_macro status_meshing'] is defined %}
	_KlickyDebug msg="_klicky_status_meshing activating the LED STATUS_MESHING"
	STATUS_MESHING
	{% endif %}

[gcode_macro _klicky_status_calibrating_z]
gcode = 
	{% if printer['gcode_macro status_calibrating_z'] is defined %}
	_KlickyDebug msg="_klicky_status_calibrating_z activating the LED STATUS_CALIBRATING_Z"
	STATUS_CALIBRATING_Z
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = _Z_TILT_ADJUST
description = 
gcode = 
	{% set V = printer["gcode_macro _User_Variables"].verbose %}
	{% if V %}
	{ action_respond_info("Z Tilt Adjust") }
	{% endif %}
	
	_CheckProbe action=query
	G90
	Attach_Probe
	_KLICKY_STATUS_LEVELING
	
	_Z_TILT_ADJUST {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	Dock_Probe
	G28 Z0

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
variable_led_enable = False
variable_status_macro = 'status_meshing'
variable_fuzz_enable = False
variable_fuzz_min = 0
variable_fuzz_max = 4
variable_margin_enable = False
variable_margin_size = 5
variable_probe_dock_enable = True
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_display_parameters = True
gcode = 
	
	{% if display_parameters == True %}
	{ action_respond_info("led_enable  : %d" % (led_enable))  }
	{ action_respond_info("status_macro: \'%s\'" % (status_macro))  }
	{ action_respond_info("fuzz_enable : %d" % (fuzz_enable))  }
	{ action_respond_info("fuzz_min    : %f" % (fuzz_min))  }
	{ action_respond_info("fuzz_max    : %f" % (fuzz_max))  }
	{ action_respond_info("probe_dock_enable: %d" % (probe_dock_enable))  }
	{ action_respond_info("attach_macro: \'%s\'" % (attach_macro))  }
	{ action_respond_info("detach_macro: \'%s\'" % (detach_macro))  }
	{% endif %}
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% if margin_enable == False %}
	{% set margin_size = 0 %}
	{% endif %}
	
	{ action_respond_info("{} object points, clamping to bed mesh [{!r} {!r}]".format(
	all_points | count,
	bed_mesh_min,
	bed_mesh_max,
	)) }
	
	{% if fuzz_enable == True %}
	{% set fuzz_range = range((fuzz_min * 100) | int, (fuzz_max * 100) | int + 1) %}
	{% set x_min = (bed_mesh_min[0] + fuzz_max - margin_size, x_min) | max - (fuzz_range | random / 100.0) %}
	{% set y_min = (bed_mesh_min[1] + fuzz_max - margin_size, y_min) | max - (fuzz_range | random / 100.0) %}
	{% set x_max = (bed_mesh_max[0] - fuzz_max + margin_size, x_max) | min + (fuzz_range | random / 100.0) %}
	{% set y_max = (bed_mesh_max[1] - fuzz_max + margin_size, y_max) | min + (fuzz_range | random / 100.0) %}
	{% else %}
	{% set x_min = [ bed_mesh_min[0], x_min - margin_size ] | max %}
	{% set y_min = [ bed_mesh_min[1], y_min - margin_size ] | max %}
	{% set x_max = [ bed_mesh_max[0], x_max + margin_size ] | min %}
	{% set y_max = [ bed_mesh_max[1], y_max + margin_size ] | min %}
	{% endif %}
	
	{ action_respond_info("Object bounds, clamped to the bed_mesh: {!r}, {!r}".format(
	(x_min, y_min),
	(x_max, y_max),
	)) }
	
	{% set points_x = (((x_max - x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((y_max - y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	{ action_respond_info( "Algorithm: {}".format(algorithm)) }
	
	{% set points_x = [points_x, min_points]|max  %}
	{% set points_y = [points_y, min_points]|max  %}
	{ action_respond_info( "Points: x: {}, y: {}".format(points_x, points_y) ) }
	
	{% if printer.configfile.settings.bed_mesh.relative_reference_index is defined %}
	{% set ref_index = (points_x * points_y / 2) | int %}
	{ action_respond_info( "Reference index: {}".format(ref_index) ) }
	{% else %}
	{% set ref_index = -1 %}
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	{% if led_enable == True %}
	{status_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={x_min},{y_min} mesh_max={x_max},{y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y} RELATIVE_REFERENCE_INDEX={ref_index}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SETUP_KAMP_MESHING]
gcode = 
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=display_parameters   VALUE={params.DISPLAY_PARAMETERS|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=led_enable   VALUE={params.LED_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=status_macro VALUE='"{params.STATUS_MACRO|default('status_meshing')|string}"'
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_enable VALUE={params.FUZZ_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_min    VALUE={params.FUZZ_MIN|default(0)|float}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_max    VALUE={params.FUZZ_MAX|default(4)|float}
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=probe_dock_enable VALUE={params.PROBE_DOCK_ENABLE|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=attach_macro VALUE='"{params.ATTACH_MACRO|default('Attach_Probe')|string}"'
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=detach_macro VALUE='"{params.DETACH_MACRO|default('Dock_Probe')|string}"'

[gcode_macro G29]
gcode = 
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro park_hotend]
gcode = 
	G1 X40
	M400
	G1 Y181
	M400

[gcode_macro LON]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro PRINTING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro LOFF]
gcode = 
	SET_LED LED=hotend RED=0 GREEN=0 BLUE=0

[gcode_macro HEATING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0.0314 BLUE=0 SYNC=0 TRANSMIT=1

[gcode_macro DONE]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0 BLUE=0.8157 SYNC=0 TRANSMIT=1

[gcode_macro PID_HOTEND]
gcode = 
	{% set EXTRUDER_TEMP = params.TEMPERATURE|default(245)|float %}
	PID_CALIBRATE HEATER=extruder TARGET={EXTRUDER_TEMP}

[gcode_macro PID_BED]
gcode = 
	{% set BED_TEMP = params.TEMPERATURE|default(110)|float %}
	PID_CALIBRATE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro SLOW]
gcode = 
	M220 S50
	SET_VELOCITY_LIMIT ACCEL=3000

[gcode_macro FAST]
gcode = 
	M220 S100
	SET_VELOCITY_LIMIT ACCEL=7500

[gcode_macro START_PRINT]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(190)|float %}
	{% set CHAMBER_TEMP = params.CHAMBER_TEMP|default(32)|float %}
	
	SETUP_KAMP_MESHING DISPLAY_PARAMETERS=1 PROBE_DOCK_ENABLE=1
	HEATING
	
	M117 Setting heater temps
	G90
	M140 S{BED_TEMP}
	M104 S0
	M400
	
	M117 Homing all axis
	G28
	
	{% if printer["temperature_sensor Chamber"].temperature < CHAMBER_TEMP %}
	M106 S255
	G0 X90 Y90 Z15
	M117 Waiting for Chamber to reach {CHAMBER_TEMP}
	TEMPERATURE_WAIT SENSOR="temperature_sensor Chamber" MINIMUM={CHAMBER_TEMP}
	M107
	M400
	{% endif %}
	
	M117 Waiting for bed, setting ext temp
	M190 S{BED_TEMP}
	M104 S{EXTRUDER_TEMP}
	M400
	
	M117 Z Tilt Adjust
	Z_TILT_ADJUST
	M400
	
	M117 Hot probe
	G29
	
	M117 Heating HotEnd
	Go_To_Purge_Location
	M400
	
	M117 Moving Z to top
	G0 Z1
	M400
	
	M117 Cleaning nozzle
	Purge
	M400
	
	M400
	M117 Print Started
	PRINTING

[gcode_macro END_PRINT]
gcode = 
	G91
	G1 Z5
	
	M400
	
	M83
	G1 E-10 F300
	
	M104 S0
	M140 S0
	M106 S0
	
	G90
	G1 X40 Y181 F10000
	
	M400
	
	M18 Y X E
	DONE

[gcode_macro BUZZ]
gcode = 
	{% set MOTOR = params.STEPPER|default(stepper_x)|string %}
	{% if MOTOR == 'x' %}
	{% set MOTOR = 'stepper_x' %}
	{% endif %}
	{% if MOTOR == 'x1' %}
	{% set MOTOR = 'stepper_x1' %}
	{% endif %}
	{% if MOTOR == 'y' %}
	{% set MOTOR = 'stepper_y' %}
	{% endif %}
	{% if MOTOR == 'y1' %}
	{% set MOTOR = 'stepper_y1' %}
	{% endif %}
	{% if MOTOR == 'z' %}
	{% set MOTOR = 'stepper_z' %}
	{% endif %}
	{% if MOTOR == 'z1' %}
	{% set MOTOR = 'stepper_z1' %}
	{% endif %}
	{% if MOTOR == 'z2' %}
	{% set MOTOR = 'stepper_z2' %}
	{% endif %}
	STEPPER_BUZZ stepper={MOTOR}

[gcode_macro PA]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[virtual_sdcard]
path = ~/gcode_files

[heater_fan hotend_fan]
pin = PA8
shutdown_speed = 0
fan_speed = 1
kick_start_time = 0.25
heater_temp = 50

[temperature_sensor Chamber]
sensor_pin = PF5
sensor_type = Generic 3950

[multi_pin cooling_fan_pins]
pins = PE5,PD12

[fan]
kick_start_time = 0.25
pin = multi_pin:cooling_fan_pins

[controller_fan case_fans]
kick_start_time = 1
fan_speed = 1
idle_timeout = 120
pin = PD13
heater = extruder
stepper = stepper_x

[controller_fan nevermore]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD14
heater = extruder
stepper = stepper_x

[controller_fan milkbox]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD15
heater = extruder
stepper = stepper_x

[printer]
kinematics = cartesian
max_velocity = 500
max_accel = 5000
max_z_velocity = 15
max_z_accel = 100
square_corner_velocity = 5

[exclude_object]

[gcode_arcs]
resolution = 0.1

[idle_timeout]
timeout = 1200

[mcu]
serial = /dev/ttyAMA0
restart_method = command

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 91.2
shaper_type_y = mzv
shaper_freq_y = 83.2

[extruder]
enable_pin = !PE0
step_pin = PE6
dir_pin = PA14
heater_pin = PA2
sensor_pin = PF4
microsteps = 16
rotation_distance = 22.71546
gear_ratio = 5:1
max_extrude_only_distance = 200
full_steps_per_rotation = 200
nozzle_diameter = 0.400
filament_diameter = 1.750
sensor_type = ATC Semitec 104NT-4-R025H42G
control = pid
pid_kp = 21.774
pid_ki = 1.837
pid_kd = 64.505
min_temp = -200
max_temp = 300
pressure_advance = 0.065
min_extrude_temp = 0

[tmc2208 extruder]
uart_pin = PD3
run_current = 0.25
sense_resistor = 0.110
hold_current = 0.1
driver_pwm_grad = 8
stealthchop_threshold = 5000

[neopixel hotend]
pin = PB0
color_order = GRB
chain_count = 1
initial_red = 1
initial_green = 1
initial_blue = 0.7
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 4106138216: New connection
webhooks client 4106138216: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
Loaded MCU 'mcu' 119 commands (v0.11.0-240-g6d48adf9 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Attempting automated MCU 'mcu' restart: CRC mismatch
Attempting MCU 'mcu' reset command
webhooks client 4106138216: Disconnected
Restarting printer
Start printer at Fri Jul  7 19:12:50 2023 (1688749970.5 6929.8)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	END_PRINT

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME
	wipe_nozzle

[probe]
pin = PG13
x_offset = -25.0
y_offset = -1.88
z_offset = 9.075

[heater_bed]
heater_pin = PA3
sensor_pin = PF3
sensor_type = Generic 3950
smooth_time = 3.0
max_power = 0.60
control = pid
pid_kp = 31.649
pid_ki = 1.901
pid_kd = 131.740
min_temp = -200
max_temp = 130

[bed_mesh]
speed = 200
horizontal_move_z = 10
mesh_min = 10, 7
mesh_max = 155, 165
probe_count = 5,5
fade_start = 0.5
fade_end = 2
split_delta_z = .025
move_check_distance = 5.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = 0.1
relative_reference_index = 12

[z_tilt]
z_positions = 
	-74.0, -18.0
	76.0,  217.0
	226.0, -18.0
points = 
	45, 25
	101, 160
	175, 25
speed = 200
horizontal_move_z = 20.0
retries = 4
retry_tolerance = 0.05

[stepper_z]
enable_pin = !PG2
step_pin = !PF9
dir_pin = !PF10
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
position_max = 180
position_min = -5
homing_speed = 15.0
second_homing_speed = 5.0
homing_retract_dist = 10.0
homing_positive_dir = false

[tmc2208 stepper_z]
uart_pin = PF2
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z1]
enable_pin = !PF1
step_pin = !PC13
dir_pin = !PF0
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z1]
uart_pin = PE4
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z2]
enable_pin = !PD4
step_pin = !PE2
dir_pin = PE3
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z2]
uart_pin = PE1
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_x]
enable_pin = !PA0
step_pin = PG4
dir_pin = !PC1
endstop_pin = tmc2209_stepper_x:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -8
position_endstop = 180
position_max = 180
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0
homing_positive_dir = true

[tmc2209 stepper_x]
diag_pin = PG11
uart_pin = PC7
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_x1]
enable_pin = !PF15
step_pin = PG0
dir_pin = PG1
endstop_pin = tmc2209_stepper_x1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_x1]
diag_pin = PG9
uart_pin = PD11
interpolate = false
run_current = 0.85
sense_resistor = 0.110
driver_sgthrs = 125
stealthchop_threshold = 999999

[stepper_y]
enable_pin = !PG5
step_pin = PF11
dir_pin = PG3
endstop_pin = tmc2209_stepper_y:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -5
position_endstop = -2
position_max = 184
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0

[tmc2209 stepper_y]
diag_pin = PG10
uart_pin = PC6
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_y1]
enable_pin = !PF14
step_pin = PF13
dir_pin = !PF12
endstop_pin = tmc2209_stepper_y1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_y1]
diag_pin = PG6
uart_pin = PC4
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[gcode_macro nozzle_clean]
gcode = 
	SAVE_GCODE_STATE NAME=clean_nozzle_state
	Wipe_Nozzle
	RESTORE_GCODE_STATE NAME=clean_nozzle_state MOVE=1

[gcode_macro Nozzle_Wiper_Variables]
variable_purge_x = -8
variable_purge_y = 110
variable_purge_x_entry = 0
variable_purge_y_entry = 110
variable_wipe_dx = 0
variable_wipe_dy = 16
variable_wipe_count = 4
variable_travel_speed = 300
variable_entry_speed = 100
variable_wipe_speed = 50
variable_purge_speed = 4
variable_purge_fan = 255
variable_wipe_fan = 128
gcode = 

[gcode_macro Go_To_Purge_Location]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set St = printer["gcode_macro Nozzle_Wiper_Variables"].travel_speed * 60 %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	
	{% if not (printer.toolhead.position.x == Px and printer.toolhead.position.y == Py) %}
	G1 X{Pxe} Y{Pye} F{St}
	G1 X{Px} Y{Py} F{Se}
	{% endif %}

[gcode_macro Wipe_Nozzle]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set Wdx = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dx|float %}
	{% set Wdy = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dy|float %}
	{% set Wc = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_count|int %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	{% set Sw = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_fan %}
	{% set old_Sf = params.OLD_FAN_SPEED|default(printer.fan.speed)|int %}
	
	{% if printer.fan.speed < Sf %}
	{% set wait_for_fan = True %}
	{% else %}
	{% set wait_for_fan = False %}
	{% endif %}
	
	
	Go_To_Purge_Location
	
	
	M106 S{Sf}
	
	
	{% if wait_for_fan %}
	G4 P800
	{% endif %}
	
	
	G1 X{Px + Wdx} Y{Py + Wdy} F12000
	{% for i in range(Wc) %}
	G1 X{Px} Y{Py} F{Sw}
	G1 X{Px + Wdx} Y{Py + Wdy} F{Sw}
	{% endfor %}
	
	
	G1 X{Pxe + Wdx} Y{Pye + Wdy} F{Se}
	
	
	M106 S{old_Sf}

[gcode_macro Purge]
gcode = 
	{% set TEMPERATURE = params.DEFAULT_TEMPERATURE|default(230)|float %}
	{% set EXACT_TEMP = params.EXACT_EXTRUDER_TEMP|default(0)|int %}
	{% set FEED_AMOUNT = params.DEFAULT_FEED_AMOUNT|default(50)|int %}
	{% set Sp = printer["gcode_macro Nozzle_Wiper_Variables"].purge_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].purge_fan %}
	{% set old_Sf = printer.fan.speed %}
	
	
	Go_To_Purge_Location
	
	
	{% if EXACT_TEMP|int == 1 and printer.extruder.temperature < TEMPERATURE %}
	M109 S{TEMPERATURE}
	{% endif %}
	
	
	M106 S{Sf}
	
	
	M83
	G1 E{FEED_AMOUNT|float - 3} F{Sp}
	G1 E5 F{Sp}
	G92 E0.0
	
	
	G4 P800
	
	
	Wipe_Nozzle OLD_FAN_SPEED={old_Sf}

[board_pins]
aliases = 
	
	EXP1_1=PE8, EXP1_2=PE7,
	EXP1_3=PE9, EXP1_4=PE10,
	EXP1_5=PE12, EXP1_6=PE13,
	EXP1_7=PE14, EXP1_8=PE15,
	EXP1_9=<GND>, EXP1_10=<5V>,
	
	
	EXP2_1=PA6, EXP2_2=PA5,
	EXP2_3=PB1, EXP2_4=PA4,
	EXP2_5=PB2, EXP2_6=PA7,
	EXP2_7=PC15, EXP2_8=<RST>,
	EXP2_9=<GND>, EXP2_10=<5V>

[gcode_macro _User_Variables]
variable_verbose = True
variable_debug = False
variable_travel_speed = 200
variable_move_accel = 1000
variable_dock_speed = 50
variable_release_speed = 75
variable_z_drop_speed = 20
variable_safe_z = 15
variable_enable_z_hop = True
variable_max_bed_y = 182
variable_max_bed_x = 182
variable_z_endstop_x = 0
variable_z_endstop_y = 0
variable_docklocation_x = -8
variable_docklocation_y = 181
variable_docklocation_z = -128
variable_enable_dock_servo = False
variable_servo_name = 'NAME'
variable_servo_deploy = 10
variable_servo_retract = 11
variable_servo_delay = 250
variable_dockmove_x = 0
variable_dockmove_y = -50
variable_dockmove_z = 0
variable_attachmove_x = -50
variable_attachmove_y = 0
variable_attachmove_z = 0
variable_umbilical = False
variable_umbilical_x = 40
variable_umbilical_y = 40
variable_park_toolhead = True
variable_parkposition_x = 40
variable_parkposition_y = 181
variable_parkposition_z = 10
variable_version = 1
variable_attachmove2_x = 0
variable_attachmove2_y = 0
variable_attachmove2_z = 0
variable_home_backoff_x = 10
variable_home_backoff_y = 10
variable_override_homing = 'X'
variable_dock_on_zhome = False
variable_bypass_probe_docking = False
gcode = 
	{% set Mx = printer['configfile'].config["stepper_x"]["position_max"]|float %}
	{% set My = printer['configfile'].config["stepper_y"]["position_max"]|float %}
	{% set Ox = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set Oy = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set Oz = printer['configfile'].config["probe"]["z_offset"]|float %}
	
	
	{% if z_endstop_x != 0 or z_endstop_y != 0 %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ z_endstop_x }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ z_endstop_y }
	
	
	{% else %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ (Mx * 0.5) - Ox }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ (My * 0.5) - Oy }
	{% endif %}

[respond]

[gcode_macro _Probe_Variables]
variable_probe_attached = False
variable_probe_state = False
variable_probe_lock = False
variable_z_endstop_x = 0
variable_z_endstop_y = 0
gcode = 

[gcode_macro _klicky_check_variables_version]
gcode = 
	{% set version = printer["gcode_macro _User_Variables"].version|default(0) %}
	
	{% if version != 1 %}
	{ action_raise_error("Please update your klicky variables, there are some functionality changes") }
	{% endif %}

[gcode_macro _KlickyDebug]
gcode = 
	{% set message  = params.MSG %}
	{% set debug = printer["gcode_macro _User_Variables"].debug|default(False) %}
	
	{% if debug %}
	{ action_respond_info(message) }
	{% endif %}

[gcode_macro _exit_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move  = params.MOVE|default(0) %}
	{% set speed = printer["gcode_macro _User_Variables"].travel_speed %}
	
	
	M400
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	RESTORE_GCODE_STATE NAME={function} MOVE={move} MOVE_SPEED={speed}

[gcode_macro _entry_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move_accel = printer["gcode_macro _User_Variables"].move_accel|default(1000) %}
	
	M400
	SAVE_GCODE_STATE NAME={function}
	
	SET_GCODE_OFFSET Z=0
	
	G90
	
	SET_VELOCITY_LIMIT ACCEL={move_accel}

[gcode_macro _Homing_Variables]
gcode = 
	{% set reset  = params.RESET|default(0) %}
	{% if reset %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }
	{% endif %}

[gcode_macro Attach_Probe_Lock]
description = Attaches Klicky Probe, can only be docked after unlocking
gcode = 
	Attach_Probe
	_Probe_Lock

[gcode_macro Dock_Probe_Unlock]
description = Docks Klicky Probe even if it was locked
gcode = 
	_Probe_Unlock
	Dock_Probe

[gcode_macro _Probe_Unlock]
description = Unlocks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to False"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }

[gcode_macro _Probe_Lock]
description = Locks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to True"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ True }

[gcode_macro _DeployKlickyDock]
description = Deploys Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_deploy = printer["gcode_macro _User_Variables"].servo_deploy|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_DeployKlickyDock Klicky servo configuration enabled"
	{% if servo_deploy == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo deploy angle specified") }
	{% endif %}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _DeployDock"] is defined %}
	_KlickyDebug msg="_DeployKlickyDock calling _DeployDock"
	_DeployDock
	{% endif %}

[gcode_macro _RetractKlickyDock]
description = Retracts Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_retract = printer["gcode_macro _User_Variables"].servo_retract|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_RetractKlickyDock Klicky servo configuration enabled"
	{% if servo_retract == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo retract angle specified") }
	{% endif %}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _RetractDock"] is defined %}
	_KlickyDebug msg="_RetractKlickyDock calling _RetractDock"
	_RetractDock
	{% endif %}

[gcode_macro Attach_Probe]
description = Attaches Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set attachmove2_x = printer["gcode_macro _User_Variables"].attachmove2_x|default(0) %}
	{% set attachmove2_y = printer["gcode_macro _User_Variables"].attachmove2_y|default(0) %}
	{% set attachmove2_z = printer["gcode_macro _User_Variables"].attachmove2_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	_entry_point function=Attach_Probe
	
	{% if bypass_probe_docking == False %}
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	_KlickyDebug msg="Attach_Probe Axis homed"
	
	
	{% elif not probe_attached and not probe_lock %}
	_KlickyDebug msg="Attach_Probe going to attach probe"
	{% if verbose %}
	{ action_respond_info("Attaching Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% if not enable_z_hop %}
	_KlickyDebug msg="Attach_Probe z_hop disabled"
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero, duplicate?") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	_entry_point function=Attach_Probe_intern
	
	
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}"
	G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Attach_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	_CheckProbe action=attach
	
	_exit_point function=Attach_Probe_intern move={goback}
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe locked not attaching probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already attached!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe already attached, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Attach_Probe
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro Dock_Probe]
description = Docks Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	{% if bypass_probe_docking == False %}
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}
	
	
	{% if bypass_probe_docking == False %}
	_entry_point function=Dock_Probe
	
	
	{% if probe_attached and not probe_lock %}
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% endif %}
	_KlickyDebug msg="Dock_Probe Axis homed"
	_KlickyDebug msg="Dock_Probe going to dock probe"
	{% if verbose %}
	{ action_respond_info("Docking Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Dock_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}"
	G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}
	{% endif %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving away from the dock to G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Dock_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	G4 P1000
	_CheckProbe action=dock
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe locked not docking probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already docked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe already docked, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Dock_Probe move={goback}
	{% else %}
	_KlickyDebug msg="Dock_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro PROBE_CALIBRATE]
rename_existing = _PROBE_CALIBRATE
description = Calibrate the probes z_offset with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_calibrate Axis homed"
	_KlickyDebug msg="probe_calibrate Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_CALIBRATE with the probe above the BED, check klicky_variables bed size!") }
	{% endif %}
	
	{% if bypass_probe_docking == False %}
	_CheckProbe action=query
	G90
	Attach_Probe back=1
	_KLICKY_STATUS_CALIBRATING_Z
	
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	M118 moving the toolhead 20 mm from the bed
	_KlickyDebug msg="probe_calibrate Moving Z up by 20mm"
	TESTZ Z=20
	M118 remove manually the probe and continue calibration
	_KLICKY_STATUS_READY
	{% else %}
	_KLICKY_STATUS_CALIBRATING_Z
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	_KLICKY_STATUS_READY
	{% endif %}

[gcode_macro PROBE_ACCURACY]
rename_existing = _PROBE_ACCURACY
description = Probe Z-height accuracy at current XY position with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_accuracy Axis homed"
	_KlickyDebug msg="probe_accuracy Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	_entry_point function=PROBE_ACCURACY
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_ACCURACY with the probe above the BED, check klicky_variables bed size!") }
	{% endif%}
	
	_CheckProbe action=query
	Attach_Probe back=1
	
	_KlickyDebug msg="probe_accuracy calling klipper probe accuracy"
	_PROBE_ACCURACY {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	Dock_Probe back=1
	
	_exit_point function=PROBE_ACCURACY move=1

[force_move]
enable_force_move = True

[homing_override]
axes = xyz
gcode = 
	
	_User_Variables
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	{% set kinematic_z = 0 %}
	{% set dock_on_zhome = printer["gcode_macro _User_Variables"].dock_on_zhome|default(True) %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set home_backoff_x = printer["gcode_macro _User_Variables"].home_backoff_x|default(0) %}
	{% set home_backoff_y = printer["gcode_macro _User_Variables"].home_backoff_y|default(0) %}
	{% set override_homing = printer["gcode_macro _User_Variables"].override_homing|default('') %}
	
	
	_klicky_check_variables_version
	
	_CheckProbe action=query
	
	
	{% set home_x, home_y, home_z, leave_probe_attached = False, False, False, False %}
	
	{% if 'PROBE_LOCK' in params%}
	{% if verbose %}
	{ action_respond_info("PROBE_LOCK = True") }
	{% endif %}
	{% set leave_probe_attached = True %}
	{% endif %}
	
	
	{% if not 'X' in params
	and not 'Y' in params
	and not 'Z' in params %}
	
	{% set home_x, home_y, home_z = True, True, True %}
	_KlickyDebug msg="homing_override goint to home all axes"
	
	{% else %}
	{% if 'X' in params %}
	{% set home_x = True %}
	_KlickyDebug msg="homing_override goint to home X"
	
	{% endif %}
	
	{% if 'Y' in params %}
	{% set home_y = True %}
	_KlickyDebug msg="homing_override goint to home Y"
	{% endif %}
	
	{% if 'Z' in params %}
	{% set home_z = True %}
	_KlickyDebug msg="homing_override goint to home Z"
	{% endif %}
	
	{% if 'X' in params
	and 'Y' in params
	and 'Z' in params %}
	
	
	_Homing_Variables reset=1
	_KlickyDebug msg="homing_override goint to home all axes"
	{% endif %}
	
	{% endif %}
	
	_entry_point function=homing_override
	_KLICKY_STATUS_HOMING
	
	
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% if not enable_z_hop %}
	_KlickyDebug msg="homing_override z_hop disabled"
	
	{% set kinematic_z = safe_z %}
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes and 'z' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("No axis homed") }
	{% endif %}
	_KlickyDebug msg="homing_override no axis homed, setting position as X=Y=0 Z={kinematic_z}"
	SET_KINEMATIC_POSITION X=0 Y=0 Z={kinematic_z}
	M400
	_KlickyDebug msg="homing_override moving toolhead to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	_KlickyDebug msg="homing_override clearing axis homed state"
	M84
	{% endif %}
	
	{% if home_z %}
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("X or Y not homed, forcing full G28") }
	{% endif %}
	{% set home_x, home_y, home_z = True, True, True %}
	{% endif %}
	{% endif %}
	
	
	{% if ((attachmove_y == 0 and override_homing == '' ) or (override_homing == 'Y'))%}
	
	{% if home_y %}
	{% if override_homing == 'Y' %}
	_KlickyDebug msg="homing_override Y homing first override, due to override_homing = Y"
	{% else %}
	_KlickyDebug msg="homing_override Y homing first override, due to attachmove_y = 0"
	{% endif %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y G28 Y0"
	G28 Y0
	
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop-home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	{% set home_y = False %}
	{% endif %}
	
	
	
	{% if home_x %}
	{% if verbose %}
	{ action_respond_info("Homing X") }
	{% endif %}
	{% if printer["gcode_macro _HOME_X"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_X external script to handle the X homing"
	_HOME_X
	{% else %}
	_KlickyDebug msg="homing_override Homing X, G28 X0"
	G28 X0
	
	{% if home_backoff_x != 0 %}
	{% if (printer.configfile.settings.stepper_x.position_endstop > (printer.configfile.settings.stepper_x.position_min|default(0) + printer.configfile.settings.stepper_x.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	
	{% if home_y %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y, G28 Y0"
	G28 Y0
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	{% if home_z %}
	{% if verbose %}
	{ action_respond_info("Homing Z") }
	{% endif %}
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe configured as a virtual Z endstop attaching probe"
	Attach_Probe
	
	{% if leave_probe_attached %}
	_Probe_Lock
	{% endif %}
	{% elif dock_on_zhome == True %}
	Dock_Probe
	{% endif %}
	
	_Home_Z
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe no longer required, docking probe"
	Dock_Probe
	{% elif dock_on_zhome == False %}
	Dock_Probe
	{% endif %}
	{% endif %}
	_CheckProbe action=query
	
	
	_Park_Toolhead
	
	_exit_point function=homing_override
	_KLICKY_STATUS_READY

[gcode_macro _Umbilical_Path]
gcode = 
	{% set umbilical = printer["gcode_macro _User_Variables"].umbilical %}
	{% set umbilical_x = printer["gcode_macro _User_Variables"].umbilical_x %}
	{% set umbilical_y = printer["gcode_macro _User_Variables"].umbilical_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	
	{% if umbilical %}
	
	_entry_point function=Umbilical_Path
	
	_KlickyDebug msg="_Umbilical_Path moving to G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}"
	G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}
	
	_exit_point function=Umbilical_Path
	{% endif %}

[gcode_macro _Home_Z]
gcode = 
	{% set z_endstop_x = printer["gcode_macro _Probe_Variables"].z_endstop_x %}
	{% set z_endstop_y = printer["gcode_macro _Probe_Variables"].z_endstop_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}    {% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Home_Z
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% else %}
	_KlickyDebug msg="_Home_Z XY Axis homed"
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="_Home_Z Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	
	
	_KlickyDebug msg="_Home_Z moving to Z endstop position G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}"
	G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}
	_KlickyDebug msg="_Home_Z Homing Z G28 Z"
	G28 Z0
	_KlickyDebug msg="_Home_Z toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_exit_point function=Home_Z

[gcode_macro _CheckProbe]
variable_probe_state = 0
gcode = 
	Query_Probe
	_SetProbeState action={ params.ACTION }

[gcode_macro _SetProbeState]
gcode = 
	{% set query_probe_triggered = printer.probe.last_query %}
	{% set action  = params.ACTION|default('') %}
	
	
	{% if query_probe_triggered %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ False }
	{% else %}
	
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ True }
	{% endif %}
	
	{% if action == 'query' %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_state VALUE={ query_probe_triggered }
	{% endif %}
	
	
	
	
	{% if not query_probe_triggered and action == 'dock' %}
	{ action_raise_error("Probe dock failed!") }
	{% endif %}
	
	
	{% if query_probe_triggered and action == 'attach' %}
	{ action_raise_error("Probe attach failed!") }
	{% endif %}

[gcode_macro _Park_Toolhead]
gcode = 
	{% set park_toolhead = printer["gcode_macro _User_Variables"].park_toolhead %}
	{% set parkposition_x = printer["gcode_macro _User_Variables"].parkposition_x %}
	{% set parkposition_y = printer["gcode_macro _User_Variables"].parkposition_y %}
	{% set parkposition_z = printer["gcode_macro _User_Variables"].parkposition_z %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Park_Toolhead
	
	{% if park_toolhead and 'xyz' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Parking Toolhead") }
	{% endif %}
	{% if parkposition_z == -128 %}
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}
	
	{% else %}
	
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}
	
	{% endif %}
	
	{% endif %}
	_exit_point function=Park_Toolhead

[gcode_macro _klicky_status_ready]
gcode = 
	{% if printer['gcode_macro status_ready'] is defined %}
	_KlickyDebug msg="_klicky_status_ready activating the LED STATUS_READY"
	STATUS_READY
	{% endif %}

[gcode_macro _klicky_status_busy]
gcode = 
	{% if printer['gcode_macro status_busy'] is defined %}
	_KlickyDebug msg="_klicky_status_busy activating the LED STATUS_BUSY"
	STATUS_BUSY
	{% endif %}

[gcode_macro _klicky_status_leveling]
gcode = 
	{% if printer['gcode_macro status_leveling'] is defined %}
	_KlickyDebug msg="_klicky_status_leveling activating the LED STATUS_LEVELING"
	STATUS_LEVELING
	{% endif %}

[gcode_macro _klicky_status_homing]
gcode = 
	{% if printer['gcode_macro status_homing'] is defined %}
	_KlickyDebug msg="_klicky_status_homing activating the LED STATUS_HOMING"
	STATUS_HOMING
	{% endif %}

[gcode_macro _klicky_status_cleaning]
gcode = 
	{% if printer['gcode_macro status_cleaning'] is defined %}
	_KlickyDebug msg="_klicky_status_cleaning activating the LED STATUS_CLEANING"
	STATUS_CLEANING
	{% endif %}

[gcode_macro _klicky_status_meshing]
gcode = 
	{% if printer['gcode_macro status_meshing'] is defined %}
	_KlickyDebug msg="_klicky_status_meshing activating the LED STATUS_MESHING"
	STATUS_MESHING
	{% endif %}

[gcode_macro _klicky_status_calibrating_z]
gcode = 
	{% if printer['gcode_macro status_calibrating_z'] is defined %}
	_KlickyDebug msg="_klicky_status_calibrating_z activating the LED STATUS_CALIBRATING_Z"
	STATUS_CALIBRATING_Z
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = _Z_TILT_ADJUST
description = 
gcode = 
	{% set V = printer["gcode_macro _User_Variables"].verbose %}
	{% if V %}
	{ action_respond_info("Z Tilt Adjust") }
	{% endif %}
	
	_CheckProbe action=query
	G90
	Attach_Probe
	_KLICKY_STATUS_LEVELING
	
	_Z_TILT_ADJUST {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	Dock_Probe
	G28 Z0

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
variable_led_enable = False
variable_status_macro = 'status_meshing'
variable_fuzz_enable = False
variable_fuzz_min = 0
variable_fuzz_max = 4
variable_margin_enable = False
variable_margin_size = 5
variable_probe_dock_enable = True
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_display_parameters = True
gcode = 
	
	{% if display_parameters == True %}
	{ action_respond_info("led_enable  : %d" % (led_enable))  }
	{ action_respond_info("status_macro: \'%s\'" % (status_macro))  }
	{ action_respond_info("fuzz_enable : %d" % (fuzz_enable))  }
	{ action_respond_info("fuzz_min    : %f" % (fuzz_min))  }
	{ action_respond_info("fuzz_max    : %f" % (fuzz_max))  }
	{ action_respond_info("probe_dock_enable: %d" % (probe_dock_enable))  }
	{ action_respond_info("attach_macro: \'%s\'" % (attach_macro))  }
	{ action_respond_info("detach_macro: \'%s\'" % (detach_macro))  }
	{% endif %}
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% if margin_enable == False %}
	{% set margin_size = 0 %}
	{% endif %}
	
	{ action_respond_info("{} object points, clamping to bed mesh [{!r} {!r}]".format(
	all_points | count,
	bed_mesh_min,
	bed_mesh_max,
	)) }
	
	{% if fuzz_enable == True %}
	{% set fuzz_range = range((fuzz_min * 100) | int, (fuzz_max * 100) | int + 1) %}
	{% set x_min = (bed_mesh_min[0] + fuzz_max - margin_size, x_min) | max - (fuzz_range | random / 100.0) %}
	{% set y_min = (bed_mesh_min[1] + fuzz_max - margin_size, y_min) | max - (fuzz_range | random / 100.0) %}
	{% set x_max = (bed_mesh_max[0] - fuzz_max + margin_size, x_max) | min + (fuzz_range | random / 100.0) %}
	{% set y_max = (bed_mesh_max[1] - fuzz_max + margin_size, y_max) | min + (fuzz_range | random / 100.0) %}
	{% else %}
	{% set x_min = [ bed_mesh_min[0], x_min - margin_size ] | max %}
	{% set y_min = [ bed_mesh_min[1], y_min - margin_size ] | max %}
	{% set x_max = [ bed_mesh_max[0], x_max + margin_size ] | min %}
	{% set y_max = [ bed_mesh_max[1], y_max + margin_size ] | min %}
	{% endif %}
	
	{ action_respond_info("Object bounds, clamped to the bed_mesh: {!r}, {!r}".format(
	(x_min, y_min),
	(x_max, y_max),
	)) }
	
	{% set points_x = (((x_max - x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((y_max - y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	{ action_respond_info( "Algorithm: {}".format(algorithm)) }
	
	{% set points_x = [points_x, min_points]|max  %}
	{% set points_y = [points_y, min_points]|max  %}
	{ action_respond_info( "Points: x: {}, y: {}".format(points_x, points_y) ) }
	
	{% if printer.configfile.settings.bed_mesh.relative_reference_index is defined %}
	{% set ref_index = (points_x * points_y / 2) | int %}
	{ action_respond_info( "Reference index: {}".format(ref_index) ) }
	{% else %}
	{% set ref_index = -1 %}
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	{% if led_enable == True %}
	{status_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={x_min},{y_min} mesh_max={x_max},{y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y} RELATIVE_REFERENCE_INDEX={ref_index}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SETUP_KAMP_MESHING]
gcode = 
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=display_parameters   VALUE={params.DISPLAY_PARAMETERS|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=led_enable   VALUE={params.LED_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=status_macro VALUE='"{params.STATUS_MACRO|default('status_meshing')|string}"'
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_enable VALUE={params.FUZZ_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_min    VALUE={params.FUZZ_MIN|default(0)|float}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_max    VALUE={params.FUZZ_MAX|default(4)|float}
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=probe_dock_enable VALUE={params.PROBE_DOCK_ENABLE|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=attach_macro VALUE='"{params.ATTACH_MACRO|default('Attach_Probe')|string}"'
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=detach_macro VALUE='"{params.DETACH_MACRO|default('Dock_Probe')|string}"'

[gcode_macro G29]
gcode = 
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro park_hotend]
gcode = 
	G1 X40
	M400
	G1 Y181
	M400

[gcode_macro LON]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro PRINTING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro LOFF]
gcode = 
	SET_LED LED=hotend RED=0 GREEN=0 BLUE=0

[gcode_macro HEATING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0.0314 BLUE=0 SYNC=0 TRANSMIT=1

[gcode_macro DONE]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0 BLUE=0.8157 SYNC=0 TRANSMIT=1

[gcode_macro PID_HOTEND]
gcode = 
	{% set EXTRUDER_TEMP = params.TEMPERATURE|default(245)|float %}
	PID_CALIBRATE HEATER=extruder TARGET={EXTRUDER_TEMP}

[gcode_macro PID_BED]
gcode = 
	{% set BED_TEMP = params.TEMPERATURE|default(110)|float %}
	PID_CALIBRATE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro SLOW]
gcode = 
	M220 S50
	SET_VELOCITY_LIMIT ACCEL=3000

[gcode_macro FAST]
gcode = 
	M220 S100
	SET_VELOCITY_LIMIT ACCEL=7500

[gcode_macro START_PRINT]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(190)|float %}
	{% set CHAMBER_TEMP = params.CHAMBER_TEMP|default(32)|float %}
	
	SETUP_KAMP_MESHING DISPLAY_PARAMETERS=1 PROBE_DOCK_ENABLE=1
	HEATING
	
	M117 Setting heater temps
	G90
	M140 S{BED_TEMP}
	M104 S0
	M400
	
	M117 Homing all axis
	G28
	
	{% if printer["temperature_sensor Chamber"].temperature < CHAMBER_TEMP %}
	M106 S255
	G0 X90 Y90 Z15
	M117 Waiting for Chamber to reach {CHAMBER_TEMP}
	TEMPERATURE_WAIT SENSOR="temperature_sensor Chamber" MINIMUM={CHAMBER_TEMP}
	M107
	M400
	{% endif %}
	
	M117 Waiting for bed, setting ext temp
	M190 S{BED_TEMP}
	M104 S{EXTRUDER_TEMP}
	M400
	
	M117 Z Tilt Adjust
	Z_TILT_ADJUST
	M400
	
	M117 Hot probe
	G29
	
	M117 Heating HotEnd
	Go_To_Purge_Location
	M400
	
	M117 Moving Z to top
	G0 Z1
	M400
	
	M117 Cleaning nozzle
	Purge
	M400
	
	M400
	M117 Print Started
	PRINTING

[gcode_macro END_PRINT]
gcode = 
	G91
	G1 Z5
	
	M400
	
	M83
	G1 E-10 F300
	
	M104 S0
	M140 S0
	M106 S0
	
	G90
	G1 X40 Y181 F10000
	
	M400
	
	M18 Y X E
	DONE

[gcode_macro BUZZ]
gcode = 
	{% set MOTOR = params.STEPPER|default(stepper_x)|string %}
	{% if MOTOR == 'x' %}
	{% set MOTOR = 'stepper_x' %}
	{% endif %}
	{% if MOTOR == 'x1' %}
	{% set MOTOR = 'stepper_x1' %}
	{% endif %}
	{% if MOTOR == 'y' %}
	{% set MOTOR = 'stepper_y' %}
	{% endif %}
	{% if MOTOR == 'y1' %}
	{% set MOTOR = 'stepper_y1' %}
	{% endif %}
	{% if MOTOR == 'z' %}
	{% set MOTOR = 'stepper_z' %}
	{% endif %}
	{% if MOTOR == 'z1' %}
	{% set MOTOR = 'stepper_z1' %}
	{% endif %}
	{% if MOTOR == 'z2' %}
	{% set MOTOR = 'stepper_z2' %}
	{% endif %}
	STEPPER_BUZZ stepper={MOTOR}

[gcode_macro PA]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[virtual_sdcard]
path = ~/gcode_files

[heater_fan hotend_fan]
pin = PA8
shutdown_speed = 0
fan_speed = 1
kick_start_time = 0.25
heater_temp = 50

[temperature_sensor Chamber]
sensor_pin = PF5
sensor_type = Generic 3950

[multi_pin cooling_fan_pins]
pins = PE5,PD12

[fan]
kick_start_time = 0.25
pin = multi_pin:cooling_fan_pins

[controller_fan case_fans]
kick_start_time = 1
fan_speed = 1
idle_timeout = 120
pin = PD13
heater = extruder
stepper = stepper_x

[controller_fan nevermore]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD14
heater = extruder
stepper = stepper_x

[controller_fan milkbox]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD15
heater = extruder
stepper = stepper_x

[printer]
kinematics = cartesian
max_velocity = 500
max_accel = 5000
max_z_velocity = 15
max_z_accel = 100
square_corner_velocity = 5

[exclude_object]

[gcode_arcs]
resolution = 0.1

[idle_timeout]
timeout = 1200

[mcu]
serial = /dev/ttyAMA0
restart_method = command

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 91.2
shaper_type_y = mzv
shaper_freq_y = 83.2

[extruder]
enable_pin = !PE0
step_pin = PE6
dir_pin = PA14
heater_pin = PA2
sensor_pin = PF4
microsteps = 16
rotation_distance = 22.71546
gear_ratio = 5:1
max_extrude_only_distance = 200
full_steps_per_rotation = 200
nozzle_diameter = 0.400
filament_diameter = 1.750
sensor_type = ATC Semitec 104NT-4-R025H42G
control = pid
pid_kp = 21.774
pid_ki = 1.837
pid_kd = 64.505
min_temp = -200
max_temp = 300
pressure_advance = 0.065
min_extrude_temp = 0

[tmc2208 extruder]
uart_pin = PD3
run_current = 0.25
sense_resistor = 0.110
hold_current = 0.1
driver_pwm_grad = 8
stealthchop_threshold = 5000

[neopixel hotend]
pin = PB0
color_order = GRB
chain_count = 1
initial_red = 1
initial_green = 1
initial_blue = 0.7
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 4109539936: New connection
webhooks client 4109539936: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
Loaded MCU 'mcu' 119 commands (v0.11.0-240-g6d48adf9 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (35.0, 8.9)     | (10.0, 7.0)
  1   | (71.2, 8.9)     | (46.2, 7.0)
  2   | (107.5, 8.9)    | (82.5, 7.0)
  3   | (143.8, 8.9)    | (118.8, 7.0)
  4   | (180.0, 8.9)    | (155.0, 7.0)
  5   | (180.0, 48.4)   | (155.0, 46.5)
  6   | (143.8, 48.4)   | (118.8, 46.5)
  7   | (107.5, 48.4)   | (82.5, 46.5)
  8   | (71.2, 48.4)    | (46.2, 46.5)
  9   | (35.0, 48.4)    | (10.0, 46.5)
  10  | (35.0, 87.9)    | (10.0, 86.0)
  11  | (71.2, 87.9)    | (46.2, 86.0)
  12  | (107.5, 87.9)   | (82.5, 86.0)
  13  | (143.8, 87.9)   | (118.8, 86.0)
  14  | (180.0, 87.9)   | (155.0, 86.0)
  15  | (180.0, 127.4)  | (155.0, 125.5)
  16  | (143.8, 127.4)  | (118.8, 125.5)
  17  | (107.5, 127.4)  | (82.5, 125.5)
  18  | (71.2, 127.4)   | (46.2, 125.5)
  19  | (35.0, 127.4)   | (10.0, 125.5)
  20  | (35.0, 166.9)   | (10.0, 165.0)
  21  | (71.2, 166.9)   | (46.2, 165.0)
  22  | (107.5, 166.9)  | (82.5, 165.0)
  23  | (143.8, 166.9)  | (118.8, 165.0)
  24  | (180.0, 166.9)  | (155.0, 165.0)
bed_mesh: relative_reference_index 12 is (82.50, 86.00)
Starting heater checks for extruder
Stats 6934.3: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3485 bytes_read=6954 bytes_retransmit=0 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179994021 heater_bed: target=0 temp=0.0 pwm=0.000  Chamber: temp=0.0 sysload=0.54 cputime=51.678 memavail=1676948 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4109539936
webhooks: registering remote method 'reboot_machine' for connection id: 4109539936
webhooks: registering remote method 'pause_job_queue' for connection id: 4109539936
webhooks: registering remote method 'start_job_queue' for connection id: 4109539936
Stats 6935.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000009 bytes_write=3491 bytes_read=7120 bytes_retransmit=0 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179997795 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.54 cputime=51.752 memavail=1672952 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6936.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000009 bytes_write=3497 bytes_read=7301 bytes_retransmit=0 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999306 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.50 cputime=51.810 memavail=1671760 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6937.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000009 bytes_write=3503 bytes_read=7467 bytes_retransmit=0 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999669 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.50 cputime=51.832 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6938.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000009 bytes_write=3509 bytes_read=7618 bytes_retransmit=0 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999820 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.50 cputime=51.854 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6939.3: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000009 bytes_write=3515 bytes_read=7799 bytes_retransmit=0 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999905 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.50 cputime=51.877 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6940.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3521 bytes_read=7979 bytes_retransmit=0 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999984 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.6 sysload=0.50 cputime=51.900 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6941.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3527 bytes_read=8130 bytes_retransmit=0 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999946 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.46 cputime=51.922 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6942.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3533 bytes_read=8311 bytes_retransmit=0 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999951 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.46 cputime=51.945 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6943.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3539 bytes_read=8477 bytes_retransmit=0 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999951 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.46 cputime=51.967 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6944.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3545 bytes_read=8628 bytes_retransmit=0 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999975 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.46 cputime=51.989 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6945.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3551 bytes_read=8823 bytes_retransmit=0 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999979 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.46 cputime=52.013 memavail=1675540 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6946.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3557 bytes_read=8989 bytes_retransmit=0 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000146 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.42 cputime=52.035 memavail=1675308 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6947.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3563 bytes_read=9140 bytes_retransmit=0 bytes_invalid=0 send_seq=279 receive_seq=279 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000121 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.42 cputime=52.058 memavail=1675308 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6948.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3575 bytes_read=9337 bytes_retransmit=0 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000088 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.42 cputime=52.081 memavail=1675308 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6949.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3581 bytes_read=9503 bytes_retransmit=0 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000077 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.42 cputime=52.104 memavail=1675308 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6950.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3587 bytes_read=9668 bytes_retransmit=0 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000071 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.42 cputime=52.127 memavail=1675308 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6951.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3593 bytes_read=9849 bytes_retransmit=0 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000063 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.39 cputime=52.150 memavail=1675308 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6952.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3599 bytes_read=10015 bytes_retransmit=0 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000070 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.39 cputime=52.173 memavail=1675308 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6953.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3605 bytes_read=10166 bytes_retransmit=0 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000079 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.39 cputime=52.195 memavail=1675084 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6954.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3611 bytes_read=10336 bytes_retransmit=0 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000077 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.39 cputime=52.218 memavail=1675084 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6955.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3617 bytes_read=10511 bytes_retransmit=0 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000075 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.39 cputime=52.241 memavail=1675352 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6956.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3623 bytes_read=10662 bytes_retransmit=0 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000072 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.68 cputime=52.263 memavail=1675112 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6957.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3629 bytes_read=10843 bytes_retransmit=0 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000075 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.68 cputime=52.286 memavail=1675112 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6958.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3635 bytes_read=11009 bytes_retransmit=0 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000075 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.68 cputime=52.308 memavail=1675112 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6959.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3641 bytes_read=11175 bytes_retransmit=0 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000081 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.68 cputime=52.331 memavail=1675116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6960.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3647 bytes_read=11355 bytes_retransmit=0 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000085 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.6 sysload=0.68 cputime=52.354 memavail=1675116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6961.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3653 bytes_read=11521 bytes_retransmit=0 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000087 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.62 cputime=52.376 memavail=1675116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6962.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3659 bytes_read=11687 bytes_retransmit=0 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000089 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.62 cputime=52.399 memavail=1675116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6963.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3665 bytes_read=11853 bytes_retransmit=0 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000087 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.62 cputime=52.422 memavail=1675116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6964.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3671 bytes_read=12019 bytes_retransmit=0 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000088 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.62 cputime=52.445 memavail=1675116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6965.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3677 bytes_read=12199 bytes_retransmit=0 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000087 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.62 cputime=52.468 memavail=1675116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6966.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3683 bytes_read=12365 bytes_retransmit=0 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000090 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.57 cputime=52.490 memavail=1674876 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6967.3: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3689 bytes_read=12531 bytes_retransmit=0 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000091 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.57 cputime=52.512 memavail=1674876 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6968.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3695 bytes_read=12697 bytes_retransmit=0 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000092 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.57 cputime=52.535 memavail=1674876 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6969.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3701 bytes_read=12863 bytes_retransmit=0 bytes_invalid=0 send_seq=302 receive_seq=302 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000091 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.57 cputime=52.558 memavail=1674884 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6970.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3707 bytes_read=13029 bytes_retransmit=0 bytes_invalid=0 send_seq=303 receive_seq=303 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.57 cputime=52.581 memavail=1674884 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Unknown stepper STEPPER_X
Unknown stepper STEPPER_X
Stats 6971.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3713 bytes_read=13209 bytes_retransmit=0 bytes_invalid=0 send_seq=304 receive_seq=304 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.53 cputime=52.610 memavail=1671116 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6972.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3719 bytes_read=13375 bytes_retransmit=0 bytes_invalid=0 send_seq=305 receive_seq=305 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.53 cputime=52.633 memavail=1668180 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6973.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3725 bytes_read=13541 bytes_retransmit=0 bytes_invalid=0 send_seq=306 receive_seq=306 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.53 cputime=52.656 memavail=1668180 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6974.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3731 bytes_read=13707 bytes_retransmit=0 bytes_invalid=0 send_seq=307 receive_seq=307 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.53 cputime=52.679 memavail=1674392 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6975.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3737 bytes_read=13873 bytes_retransmit=0 bytes_invalid=0 send_seq=308 receive_seq=308 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.53 cputime=52.702 memavail=1674468 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6976.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3743 bytes_read=14053 bytes_retransmit=0 bytes_invalid=0 send_seq=309 receive_seq=309 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.72 cputime=52.725 memavail=1674216 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6977.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3749 bytes_read=14218 bytes_retransmit=0 bytes_invalid=0 send_seq=310 receive_seq=310 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.72 cputime=52.749 memavail=1674216 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6978.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3755 bytes_read=14373 bytes_retransmit=0 bytes_invalid=0 send_seq=311 receive_seq=311 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.72 cputime=52.773 memavail=1674216 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6979.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3761 bytes_read=14534 bytes_retransmit=0 bytes_invalid=0 send_seq=312 receive_seq=312 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000126 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.72 cputime=52.796 memavail=1674216 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6980.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3767 bytes_read=14700 bytes_retransmit=0 bytes_invalid=0 send_seq=313 receive_seq=313 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000126 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.72 cputime=52.819 memavail=1674216 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6981.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3773 bytes_read=14880 bytes_retransmit=0 bytes_invalid=0 send_seq=314 receive_seq=314 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000123 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.83 cputime=52.843 memavail=1670192 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Unknown stepper STEPPERX
Unknown stepper STEPPERX
Stats 6982.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3779 bytes_read=15046 bytes_retransmit=0 bytes_invalid=0 send_seq=315 receive_seq=315 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000120 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.83 cputime=52.872 memavail=1669448 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6983.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3785 bytes_read=15212 bytes_retransmit=0 bytes_invalid=0 send_seq=316 receive_seq=316 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000117 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.83 cputime=52.895 memavail=1667212 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6984.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3791 bytes_read=15378 bytes_retransmit=0 bytes_invalid=0 send_seq=317 receive_seq=317 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000114 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.83 cputime=52.918 memavail=1667212 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6985.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3797 bytes_read=15544 bytes_retransmit=0 bytes_invalid=0 send_seq=318 receive_seq=318 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000112 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.83 cputime=52.941 memavail=1673476 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6986.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3803 bytes_read=15724 bytes_retransmit=0 bytes_invalid=0 send_seq=319 receive_seq=319 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000110 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.76 cputime=52.961 memavail=1673488 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6987.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3809 bytes_read=15890 bytes_retransmit=0 bytes_invalid=0 send_seq=320 receive_seq=320 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000109 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.76 cputime=52.983 memavail=1673488 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6988.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3815 bytes_read=16056 bytes_retransmit=0 bytes_invalid=0 send_seq=321 receive_seq=321 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000107 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.76 cputime=53.007 memavail=1673488 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6989.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000005 bytes_write=3821 bytes_read=16222 bytes_retransmit=0 bytes_invalid=0 send_seq=322 receive_seq=322 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000108 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.76 cputime=53.029 memavail=1673488 print_time=0.005 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stepper buzz stepper_x
TMC 'stepper_x' reports GSTAT:      00000001 reset=1(Reset)
TMC 'stepper_x' reports GSTAT:      00000000
Stats 6994.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=4287 bytes_read=17469 bytes_retransmit=0 bytes_invalid=0 send_seq=350 receive_seq=350 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.78 cputime=53.196 memavail=1670212 print_time=66.565 buffer_time=2.365 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6995.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=4415 bytes_read=17696 bytes_retransmit=0 bytes_invalid=0 send_seq=356 receive_seq=356 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.78 cputime=53.229 memavail=1676440 print_time=67.555 buffer_time=2.354 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6996.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=4501 bytes_read=17923 bytes_retransmit=0 bytes_invalid=0 send_seq=359 receive_seq=359 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.72 cputime=53.261 memavail=1675236 print_time=68.595 buffer_time=2.393 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6997.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=4561 bytes_read=18135 bytes_retransmit=0 bytes_invalid=0 send_seq=362 receive_seq=362 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.72 cputime=53.294 memavail=1675236 print_time=69.725 buffer_time=2.523 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 6998.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=4621 bytes_read=18347 bytes_retransmit=0 bytes_invalid=0 send_seq=365 receive_seq=365 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000100 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.72 cputime=53.325 memavail=1675236 print_time=70.715 buffer_time=2.512 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 6999.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=4681 bytes_read=18559 bytes_retransmit=0 bytes_invalid=0 send_seq=368 receive_seq=368 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000100 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.72 cputime=53.356 memavail=1675236 print_time=71.305 buffer_time=2.101 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7000.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=4741 bytes_read=18771 bytes_retransmit=0 bytes_invalid=0 send_seq=371 receive_seq=371 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.72 cputime=53.388 memavail=1675236 print_time=72.295 buffer_time=2.090 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7001.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=4827 bytes_read=18995 bytes_retransmit=0 bytes_invalid=0 send_seq=374 receive_seq=374 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000101 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.66 cputime=53.420 memavail=1675236 print_time=73.335 buffer_time=2.130 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7002.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=4887 bytes_read=19196 bytes_retransmit=0 bytes_invalid=0 send_seq=377 receive_seq=377 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.66 cputime=53.452 memavail=1675236 print_time=74.465 buffer_time=2.260 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7003.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=4947 bytes_read=19404 bytes_retransmit=0 bytes_invalid=0 send_seq=380 receive_seq=380 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000099 heater_bed: target=0 temp=18.5 pwm=0.000  Chamber: temp=18.8 sysload=0.66 cputime=53.483 memavail=1675236 print_time=75.455 buffer_time=2.249 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7004.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=5033 bytes_read=19616 bytes_retransmit=0 bytes_invalid=0 send_seq=383 receive_seq=383 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000100 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.66 cputime=53.515 memavail=1675236 print_time=76.495 buffer_time=2.289 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7005.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=5093 bytes_read=19828 bytes_retransmit=0 bytes_invalid=0 send_seq=386 receive_seq=386 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000100 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.66 cputime=53.548 memavail=1675236 print_time=77.625 buffer_time=2.418 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7006.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=5153 bytes_read=20054 bytes_retransmit=0 bytes_invalid=0 send_seq=389 receive_seq=389 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.61 cputime=53.579 memavail=1675512 print_time=78.615 buffer_time=2.408 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7007.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=5213 bytes_read=20281 bytes_retransmit=0 bytes_invalid=0 send_seq=392 receive_seq=392 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000105 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.61 cputime=53.611 memavail=1675512 print_time=79.655 buffer_time=2.447 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Pausing toolhead to calculate stepper_x phase offset
Stats 7008.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=5273 bytes_read=20478 bytes_retransmit=0 bytes_invalid=0 send_seq=395 receive_seq=395 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=8 upcoming_bytes=0 freq=180000105 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.61 cputime=53.644 memavail=1675512 print_time=79.855 buffer_time=1.647 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7009.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=5287 bytes_read=20644 bytes_retransmit=0 bytes_invalid=0 send_seq=396 receive_seq=396 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000105 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.61 cputime=53.669 memavail=1675512 print_time=79.855 buffer_time=0.646 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7010.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=5313 bytes_read=20864 bytes_retransmit=0 bytes_invalid=0 send_seq=399 receive_seq=399 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.61 cputime=53.697 memavail=1675512 print_time=79.855 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7011.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=5319 bytes_read=21029 bytes_retransmit=0 bytes_invalid=0 send_seq=400 receive_seq=400 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.56 cputime=53.720 memavail=1675512 print_time=79.855 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7012.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=5325 bytes_read=21195 bytes_retransmit=0 bytes_invalid=0 send_seq=401 receive_seq=401 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000101 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.56 cputime=53.742 memavail=1675512 print_time=79.855 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7013.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=5331 bytes_read=21376 bytes_retransmit=0 bytes_invalid=0 send_seq=402 receive_seq=402 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000100 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.56 cputime=53.765 memavail=1675512 print_time=79.855 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7014.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=5337 bytes_read=21527 bytes_retransmit=0 bytes_invalid=0 send_seq=403 receive_seq=403 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000099 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.56 cputime=53.787 memavail=1675512 print_time=79.855 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stepper buzz stepper_x1
Stats 7015.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=5718 bytes_read=21991 bytes_retransmit=0 bytes_invalid=0 send_seq=423 receive_seq=422 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.56 cputime=53.850 memavail=1675512 print_time=87.590 buffer_time=2.377 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
TMC 'stepper_x1' reports GSTAT:      00000001 reset=1(Reset)
TMC 'stepper_x1' reports GSTAT:      00000000
Stats 7016.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=5811 bytes_read=22291 bytes_retransmit=0 bytes_invalid=0 send_seq=428 receive_seq=428 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.51 cputime=53.890 memavail=1675532 print_time=88.630 buffer_time=2.416 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7017.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=5871 bytes_read=22488 bytes_retransmit=0 bytes_invalid=0 send_seq=431 receive_seq=431 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.51 cputime=53.920 memavail=1675532 print_time=89.220 buffer_time=2.006 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7018.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=5931 bytes_read=22700 bytes_retransmit=0 bytes_invalid=0 send_seq=434 receive_seq=434 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.51 cputime=53.953 memavail=1675532 print_time=90.750 buffer_time=2.535 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7019.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=6017 bytes_read=22927 bytes_retransmit=0 bytes_invalid=0 send_seq=437 receive_seq=437 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.51 cputime=53.984 memavail=1675532 print_time=91.340 buffer_time=2.124 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7020.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=6077 bytes_read=23124 bytes_retransmit=0 bytes_invalid=0 send_seq=440 receive_seq=440 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000101 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.51 cputime=54.015 memavail=1675532 print_time=92.330 buffer_time=2.114 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7021.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6137 bytes_read=23350 bytes_retransmit=0 bytes_invalid=0 send_seq=443 receive_seq=443 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.55 cputime=54.046 memavail=1675532 print_time=93.370 buffer_time=2.153 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7022.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6223 bytes_read=23577 bytes_retransmit=0 bytes_invalid=0 send_seq=446 receive_seq=446 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.55 cputime=54.080 memavail=1675536 print_time=94.500 buffer_time=2.282 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7023.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6283 bytes_read=23774 bytes_retransmit=0 bytes_invalid=0 send_seq=449 receive_seq=449 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.55 cputime=54.110 memavail=1675536 print_time=95.490 buffer_time=2.271 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7024.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6343 bytes_read=23986 bytes_retransmit=0 bytes_invalid=0 send_seq=452 receive_seq=452 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.55 cputime=54.141 memavail=1675536 print_time=96.530 buffer_time=2.311 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7025.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6403 bytes_read=24208 bytes_retransmit=0 bytes_invalid=0 send_seq=455 receive_seq=455 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.55 cputime=54.174 memavail=1675536 print_time=97.660 buffer_time=2.440 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7026.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6463 bytes_read=24409 bytes_retransmit=0 bytes_invalid=0 send_seq=458 receive_seq=458 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.59 cputime=54.207 memavail=1675312 print_time=98.650 buffer_time=2.430 print_stall=0 extruder: target=0 temp=18.3 pwm=0.000
Stats 7027.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6549 bytes_read=24620 bytes_retransmit=0 bytes_invalid=0 send_seq=461 receive_seq=461 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.59 cputime=54.237 memavail=1675320 print_time=99.240 buffer_time=2.019 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7028.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6609 bytes_read=24847 bytes_retransmit=0 bytes_invalid=0 send_seq=464 receive_seq=464 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.59 cputime=54.269 memavail=1675320 print_time=100.230 buffer_time=2.008 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7029.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6669 bytes_read=25044 bytes_retransmit=0 bytes_invalid=0 send_seq=467 receive_seq=467 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000105 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.59 cputime=54.299 memavail=1675320 print_time=101.270 buffer_time=2.047 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Pausing toolhead to calculate stepper_x1 phase offset
Stats 7030.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=6711 bytes_read=25256 bytes_retransmit=0 bytes_invalid=0 send_seq=470 receive_seq=470 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000105 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.59 cputime=54.334 memavail=1675320 print_time=101.470 buffer_time=1.247 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7031.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=6717 bytes_read=25451 bytes_retransmit=0 bytes_invalid=0 send_seq=471 receive_seq=471 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.54 cputime=54.360 memavail=1675320 print_time=101.470 buffer_time=0.246 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7032.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=6737 bytes_read=25625 bytes_retransmit=0 bytes_invalid=0 send_seq=473 receive_seq=473 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.54 cputime=54.387 memavail=1675320 print_time=101.470 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stepper buzz stepper_y1
TMC 'stepper_y1' reports GSTAT:      00000001 reset=1(Reset)
TMC 'stepper_y1' reports GSTAT:      00000000
Stats 7033.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=7184 bytes_read=26199 bytes_retransmit=0 bytes_invalid=0 send_seq=498 receive_seq=498 retransmit_seq=0 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000116 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.54 cputime=54.466 memavail=1675320 print_time=105.282 buffer_time=2.056 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7034.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=7244 bytes_read=26426 bytes_retransmit=0 bytes_invalid=0 send_seq=501 receive_seq=501 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000117 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.54 cputime=54.497 memavail=1675324 print_time=106.322 buffer_time=2.096 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7035.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=7330 bytes_read=26623 bytes_retransmit=0 bytes_invalid=0 send_seq=504 receive_seq=504 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000117 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.54 cputime=54.529 memavail=1675324 print_time=107.452 buffer_time=2.225 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7036.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7390 bytes_read=26850 bytes_retransmit=0 bytes_invalid=0 send_seq=507 receive_seq=507 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000117 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.50 cputime=54.561 memavail=1674768 print_time=108.442 buffer_time=2.214 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7037.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7450 bytes_read=27077 bytes_retransmit=0 bytes_invalid=0 send_seq=510 receive_seq=510 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000118 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.9 sysload=0.50 cputime=54.593 memavail=1674820 print_time=109.482 buffer_time=2.253 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7038.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7510 bytes_read=27274 bytes_retransmit=0 bytes_invalid=0 send_seq=513 receive_seq=513 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000118 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.50 cputime=54.625 memavail=1674820 print_time=110.612 buffer_time=2.382 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7039.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7570 bytes_read=27486 bytes_retransmit=0 bytes_invalid=0 send_seq=516 receive_seq=516 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000118 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.50 cputime=54.656 memavail=1674820 print_time=111.602 buffer_time=2.372 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7040.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7656 bytes_read=27713 bytes_retransmit=0 bytes_invalid=0 send_seq=519 receive_seq=519 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000117 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.50 cputime=54.688 memavail=1674820 print_time=112.642 buffer_time=2.411 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7041.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7716 bytes_read=27924 bytes_retransmit=0 bytes_invalid=0 send_seq=522 receive_seq=522 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000115 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.46 cputime=54.719 memavail=1674820 print_time=113.232 buffer_time=2.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7042.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7776 bytes_read=28136 bytes_retransmit=0 bytes_invalid=0 send_seq=525 receive_seq=525 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000115 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.46 cputime=54.751 memavail=1674820 print_time=114.762 buffer_time=2.530 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7043.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7862 bytes_read=28363 bytes_retransmit=0 bytes_invalid=0 send_seq=528 receive_seq=528 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000115 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.46 cputime=54.783 memavail=1674820 print_time=115.352 buffer_time=2.119 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7044.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7922 bytes_read=28560 bytes_retransmit=0 bytes_invalid=0 send_seq=531 receive_seq=531 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000114 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.46 cputime=54.814 memavail=1674820 print_time=116.342 buffer_time=2.108 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7045.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=7982 bytes_read=28772 bytes_retransmit=0 bytes_invalid=0 send_seq=534 receive_seq=534 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000114 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.46 cputime=54.845 memavail=1674820 print_time=117.382 buffer_time=2.147 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7046.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=8042 bytes_read=29013 bytes_retransmit=0 bytes_invalid=0 send_seq=537 receive_seq=537 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000113 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.42 cputime=54.879 memavail=1674588 print_time=118.512 buffer_time=2.276 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Pausing toolhead to calculate stepper_y1 phase offset
Stats 7047.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=8102 bytes_read=29210 bytes_retransmit=0 bytes_invalid=0 send_seq=540 receive_seq=540 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=8 upcoming_bytes=0 freq=180000120 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.42 cputime=54.912 memavail=1674592 print_time=119.162 buffer_time=1.925 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7048.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=8116 bytes_read=29376 bytes_retransmit=0 bytes_invalid=0 send_seq=541 receive_seq=541 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000118 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.42 cputime=54.938 memavail=1674592 print_time=119.162 buffer_time=0.924 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7049.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=8136 bytes_read=29574 bytes_retransmit=0 bytes_invalid=0 send_seq=543 receive_seq=543 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000116 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.42 cputime=54.966 memavail=1674592 print_time=119.162 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7050.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=8142 bytes_read=29730 bytes_retransmit=0 bytes_invalid=0 send_seq=544 receive_seq=544 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000114 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.42 cputime=54.989 memavail=1674592 print_time=119.162 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7051.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=8148 bytes_read=29895 bytes_retransmit=0 bytes_invalid=0 send_seq=545 receive_seq=545 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000112 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.39 cputime=55.011 memavail=1674592 print_time=119.162 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7052.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=8154 bytes_read=30076 bytes_retransmit=0 bytes_invalid=0 send_seq=546 receive_seq=546 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000111 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.39 cputime=55.034 memavail=1674600 print_time=119.162 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7053.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=8160 bytes_read=30242 bytes_retransmit=0 bytes_invalid=0 send_seq=547 receive_seq=547 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000109 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.39 cputime=55.056 memavail=1674600 print_time=119.162 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7054.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=8166 bytes_read=30393 bytes_retransmit=0 bytes_invalid=0 send_seq=548 receive_seq=548 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000108 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.39 cputime=55.078 memavail=1674600 print_time=119.162 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stepper buzz stepper_y
Stats 7055.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=8326 bytes_read=30630 bytes_retransmit=0 bytes_invalid=0 send_seq=555 receive_seq=555 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000107 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.39 cputime=55.116 memavail=1674600 print_time=127.693 buffer_time=2.450 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
TMC 'stepper_y' reports GSTAT:      00000001 reset=1(Reset)
TMC 'stepper_y' reports GSTAT:      00000000
Stats 7056.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=8619 bytes_read=31162 bytes_retransmit=0 bytes_invalid=0 send_seq=574 receive_seq=574 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000105 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.36 cputime=55.181 memavail=1673856 print_time=128.283 buffer_time=2.040 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7057.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=8679 bytes_read=31359 bytes_retransmit=0 bytes_invalid=0 send_seq=577 receive_seq=577 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000105 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.36 cputime=55.211 memavail=1673856 print_time=129.273 buffer_time=2.029 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7058.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=8765 bytes_read=31586 bytes_retransmit=0 bytes_invalid=0 send_seq=580 receive_seq=580 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.36 cputime=55.243 memavail=1673860 print_time=130.313 buffer_time=2.068 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7059.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=8825 bytes_read=31798 bytes_retransmit=0 bytes_invalid=0 send_seq=583 receive_seq=583 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.36 cputime=55.275 memavail=1673860 print_time=131.443 buffer_time=2.197 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7060.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000004 bytes_write=8885 bytes_read=31995 bytes_retransmit=0 bytes_invalid=0 send_seq=586 receive_seq=586 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.36 cputime=55.306 memavail=1673860 print_time=132.433 buffer_time=2.187 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7061.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=8945 bytes_read=32236 bytes_retransmit=0 bytes_invalid=0 send_seq=589 receive_seq=589 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.338 memavail=1673860 print_time=133.473 buffer_time=2.226 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7062.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9005 bytes_read=32448 bytes_retransmit=0 bytes_invalid=0 send_seq=592 receive_seq=592 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=52 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.370 memavail=1673860 print_time=134.603 buffer_time=2.355 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7063.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9091 bytes_read=32645 bytes_retransmit=0 bytes_invalid=0 send_seq=595 receive_seq=595 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.400 memavail=1673860 print_time=135.593 buffer_time=2.344 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7064.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9151 bytes_read=32872 bytes_retransmit=0 bytes_invalid=0 send_seq=598 receive_seq=598 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000090 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.33 cputime=55.431 memavail=1673864 print_time=136.633 buffer_time=2.384 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7065.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9211 bytes_read=33084 bytes_retransmit=0 bytes_invalid=0 send_seq=601 receive_seq=601 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=52 upcoming_bytes=0 freq=180000091 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.463 memavail=1673864 print_time=137.763 buffer_time=2.514 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7066.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=9297 bytes_read=33295 bytes_retransmit=0 bytes_invalid=0 send_seq=604 receive_seq=604 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000093 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.30 cputime=55.494 memavail=1674064 print_time=138.753 buffer_time=2.503 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7067.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=9357 bytes_read=33522 bytes_retransmit=0 bytes_invalid=0 send_seq=607 receive_seq=607 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000093 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.30 cputime=55.525 memavail=1674064 print_time=139.343 buffer_time=2.092 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7068.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=9417 bytes_read=33734 bytes_retransmit=0 bytes_invalid=0 send_seq=610 receive_seq=610 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.30 cputime=55.556 memavail=1674124 print_time=140.333 buffer_time=2.081 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7069.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=9477 bytes_read=33931 bytes_retransmit=0 bytes_invalid=0 send_seq=613 receive_seq=613 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=26 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.30 cputime=55.586 memavail=1674124 print_time=141.373 buffer_time=2.121 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Pausing toolhead to calculate stepper_y phase offset
Stats 7070.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000008 mcu_task_stddev=0.000005 bytes_write=9537 bytes_read=34158 bytes_retransmit=0 bytes_invalid=0 send_seq=616 receive_seq=616 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=8 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.30 cputime=55.621 memavail=1674124 print_time=141.573 buffer_time=1.320 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7071.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9557 bytes_read=34354 bytes_retransmit=0 bytes_invalid=0 send_seq=618 receive_seq=618 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.7 sysload=0.28 cputime=55.647 memavail=1674124 print_time=141.573 buffer_time=0.319 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7072.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9577 bytes_read=34528 bytes_retransmit=0 bytes_invalid=0 send_seq=620 receive_seq=620 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=55.672 memavail=1674124 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7073.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9583 bytes_read=34699 bytes_retransmit=0 bytes_invalid=0 send_seq=621 receive_seq=621 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=55.695 memavail=1674124 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7074.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9589 bytes_read=34857 bytes_retransmit=0 bytes_invalid=0 send_seq=622 receive_seq=622 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=55.718 memavail=1674124 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7075.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=9595 bytes_read=35008 bytes_retransmit=0 bytes_invalid=0 send_seq=623 receive_seq=623 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=55.740 memavail=1674128 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7076.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9601 bytes_read=35203 bytes_retransmit=0 bytes_invalid=0 send_seq=624 receive_seq=624 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.763 memavail=1674148 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7077.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9607 bytes_read=35369 bytes_retransmit=0 bytes_invalid=0 send_seq=625 receive_seq=625 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.786 memavail=1674144 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7078.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9613 bytes_read=35520 bytes_retransmit=0 bytes_invalid=0 send_seq=626 receive_seq=626 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.807 memavail=1674144 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7079.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9619 bytes_read=35701 bytes_retransmit=0 bytes_invalid=0 send_seq=627 receive_seq=627 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.830 memavail=1674144 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7080.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9625 bytes_read=35867 bytes_retransmit=0 bytes_invalid=0 send_seq=628 receive_seq=628 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000093 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=55.853 memavail=1674144 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7081.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9631 bytes_read=36032 bytes_retransmit=0 bytes_invalid=0 send_seq=629 receive_seq=629 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000093 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.31 cputime=55.875 memavail=1674152 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7082.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9637 bytes_read=36213 bytes_retransmit=0 bytes_invalid=0 send_seq=630 receive_seq=630 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000093 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.31 cputime=55.898 memavail=1674152 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7083.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9643 bytes_read=36379 bytes_retransmit=0 bytes_invalid=0 send_seq=631 receive_seq=631 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.31 cputime=55.920 memavail=1674152 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7084.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9649 bytes_read=36530 bytes_retransmit=0 bytes_invalid=0 send_seq=632 receive_seq=632 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000093 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.31 cputime=55.942 memavail=1674152 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7085.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9655 bytes_read=36711 bytes_retransmit=0 bytes_invalid=0 send_seq=633 receive_seq=633 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000094 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.31 cputime=55.965 memavail=1674152 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7086.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9661 bytes_read=36891 bytes_retransmit=0 bytes_invalid=0 send_seq=634 receive_seq=634 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=55.988 memavail=1674352 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7087.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9667 bytes_read=37042 bytes_retransmit=0 bytes_invalid=0 send_seq=635 receive_seq=635 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000095 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.28 cputime=56.010 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7088.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9673 bytes_read=37223 bytes_retransmit=0 bytes_invalid=0 send_seq=636 receive_seq=636 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=56.033 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7089.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9679 bytes_read=37389 bytes_retransmit=0 bytes_invalid=0 send_seq=637 receive_seq=637 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=56.056 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7090.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9685 bytes_read=37540 bytes_retransmit=0 bytes_invalid=0 send_seq=638 receive_seq=638 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.28 cputime=56.078 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7091.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9691 bytes_read=37735 bytes_retransmit=0 bytes_invalid=0 send_seq=639 receive_seq=639 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.26 cputime=56.101 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7092.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9697 bytes_read=37901 bytes_retransmit=0 bytes_invalid=0 send_seq=640 receive_seq=640 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.26 cputime=56.124 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7093.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9703 bytes_read=38052 bytes_retransmit=0 bytes_invalid=0 send_seq=641 receive_seq=641 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.26 cputime=56.146 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7094.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9709 bytes_read=38233 bytes_retransmit=0 bytes_invalid=0 send_seq=642 receive_seq=642 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.26 cputime=56.169 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7095.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9715 bytes_read=38399 bytes_retransmit=0 bytes_invalid=0 send_seq=643 receive_seq=643 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.26 cputime=56.192 memavail=1674428 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7096.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9721 bytes_read=38564 bytes_retransmit=0 bytes_invalid=0 send_seq=644 receive_seq=644 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.24 cputime=56.215 memavail=1673420 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7097.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9727 bytes_read=38734 bytes_retransmit=0 bytes_invalid=0 send_seq=645 receive_seq=645 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000099 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.24 cputime=56.238 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7098.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9733 bytes_read=38893 bytes_retransmit=0 bytes_invalid=0 send_seq=646 receive_seq=646 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.24 cputime=56.261 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7099.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9739 bytes_read=39044 bytes_retransmit=0 bytes_invalid=0 send_seq=647 receive_seq=647 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000097 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.24 cputime=56.283 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7100.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9745 bytes_read=39225 bytes_retransmit=0 bytes_invalid=0 send_seq=648 receive_seq=648 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.24 cputime=56.303 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7101.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9751 bytes_read=39405 bytes_retransmit=0 bytes_invalid=0 send_seq=649 receive_seq=649 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.22 cputime=56.327 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7102.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9757 bytes_read=39556 bytes_retransmit=0 bytes_invalid=0 send_seq=650 receive_seq=650 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000098 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.22 cputime=56.350 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7103.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9763 bytes_read=39737 bytes_retransmit=0 bytes_invalid=0 send_seq=651 receive_seq=651 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.22 cputime=56.373 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7104.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9769 bytes_read=39903 bytes_retransmit=0 bytes_invalid=0 send_seq=652 receive_seq=652 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.22 cputime=56.395 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7105.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9775 bytes_read=40069 bytes_retransmit=0 bytes_invalid=0 send_seq=653 receive_seq=653 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.22 cputime=56.418 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7106.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9781 bytes_read=40249 bytes_retransmit=0 bytes_invalid=0 send_seq=654 receive_seq=654 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.20 cputime=56.441 memavail=1673432 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7107.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9787 bytes_read=40415 bytes_retransmit=0 bytes_invalid=0 send_seq=655 receive_seq=655 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.20 cputime=56.463 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7108.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9793 bytes_read=40581 bytes_retransmit=0 bytes_invalid=0 send_seq=656 receive_seq=656 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.9 sysload=0.20 cputime=56.486 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7109.4: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9799 bytes_read=40747 bytes_retransmit=0 bytes_invalid=0 send_seq=657 receive_seq=657 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.20 cputime=56.508 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7110.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9805 bytes_read=40913 bytes_retransmit=0 bytes_invalid=0 send_seq=658 receive_seq=658 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.9 sysload=0.20 cputime=56.530 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7111.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9811 bytes_read=41093 bytes_retransmit=0 bytes_invalid=0 send_seq=659 receive_seq=659 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000096 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.18 cputime=56.553 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7112.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9817 bytes_read=41259 bytes_retransmit=0 bytes_invalid=0 send_seq=660 receive_seq=660 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.18 cputime=56.575 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7113.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9823 bytes_read=41425 bytes_retransmit=0 bytes_invalid=0 send_seq=661 receive_seq=661 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.18 cputime=56.597 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7114.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9829 bytes_read=41591 bytes_retransmit=0 bytes_invalid=0 send_seq=662 receive_seq=662 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.18 cputime=56.619 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7115.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9835 bytes_read=41757 bytes_retransmit=0 bytes_invalid=0 send_seq=663 receive_seq=663 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.18 cputime=56.642 memavail=1673456 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7116.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9841 bytes_read=41937 bytes_retransmit=0 bytes_invalid=0 send_seq=664 receive_seq=664 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000104 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.7 sysload=0.17 cputime=56.665 memavail=1673220 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7117.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9847 bytes_read=42103 bytes_retransmit=0 bytes_invalid=0 send_seq=665 receive_seq=665 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.17 cputime=56.688 memavail=1673224 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7118.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9853 bytes_read=42269 bytes_retransmit=0 bytes_invalid=0 send_seq=666 receive_seq=666 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000103 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.17 cputime=56.710 memavail=1673224 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7119.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9859 bytes_read=42435 bytes_retransmit=0 bytes_invalid=0 send_seq=667 receive_seq=667 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.17 cputime=56.733 memavail=1673224 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7120.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9865 bytes_read=42600 bytes_retransmit=0 bytes_invalid=0 send_seq=668 receive_seq=668 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.17 cputime=56.755 memavail=1672972 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7121.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9871 bytes_read=42770 bytes_retransmit=0 bytes_invalid=0 send_seq=669 receive_seq=669 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000101 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.16 cputime=56.778 memavail=1672972 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7122.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9877 bytes_read=42931 bytes_retransmit=0 bytes_invalid=0 send_seq=670 receive_seq=670 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000102 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.16 cputime=56.800 memavail=1672972 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7123.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9883 bytes_read=43097 bytes_retransmit=0 bytes_invalid=0 send_seq=671 receive_seq=671 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000101 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.16 cputime=56.822 memavail=1672972 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7124.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9889 bytes_read=43263 bytes_retransmit=0 bytes_invalid=0 send_seq=672 receive_seq=672 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000112 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.16 cputime=56.844 memavail=1672972 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7125.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9895 bytes_read=43429 bytes_retransmit=0 bytes_invalid=0 send_seq=673 receive_seq=673 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000111 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.16 cputime=56.867 memavail=1672972 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7126.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9901 bytes_read=43609 bytes_retransmit=0 bytes_invalid=0 send_seq=674 receive_seq=674 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000110 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.14 cputime=56.889 memavail=1673980 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7127.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9907 bytes_read=43775 bytes_retransmit=0 bytes_invalid=0 send_seq=675 receive_seq=675 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000109 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.14 cputime=56.911 memavail=1673992 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7128.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9913 bytes_read=43941 bytes_retransmit=0 bytes_invalid=0 send_seq=676 receive_seq=676 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000109 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.14 cputime=56.933 memavail=1673992 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7129.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9958 bytes_read=44122 bytes_retransmit=0 bytes_invalid=0 send_seq=680 receive_seq=680 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000110 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.14 cputime=56.957 memavail=1673992 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7130.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=9964 bytes_read=44288 bytes_retransmit=0 bytes_invalid=0 send_seq=681 receive_seq=681 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000109 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.14 cputime=56.979 memavail=1673992 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7131.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=9970 bytes_read=44468 bytes_retransmit=0 bytes_invalid=0 send_seq=682 receive_seq=682 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000108 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.8 sysload=0.13 cputime=57.001 memavail=1673992 print_time=141.573 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7176.5: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=10246 bytes_read=52033 bytes_retransmit=0 bytes_invalid=0 send_seq=728 receive_seq=728 retransmit_seq=0 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000100 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.41 cputime=57.971 memavail=1673512 print_time=246.391 buffer_time=0.047 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 4109539936: Disconnected
Restarting printer
Start printer at Fri Jul  7 19:16:58 2023 (1688750218.3 7177.7)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	END_PRINT

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME
	wipe_nozzle

[probe]
pin = PG13
x_offset = -25.0
y_offset = -1.88
z_offset = 9.075

[heater_bed]
heater_pin = PA3
sensor_pin = PF3
sensor_type = Generic 3950
smooth_time = 3.0
max_power = 0.60
control = pid
pid_kp = 31.649
pid_ki = 1.901
pid_kd = 131.740
min_temp = -200
max_temp = 130

[bed_mesh]
speed = 200
horizontal_move_z = 10
mesh_min = 10, 7
mesh_max = 155, 165
probe_count = 5,5
fade_start = 0.5
fade_end = 2
split_delta_z = .025
move_check_distance = 5.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = 0.1
relative_reference_index = 12

[z_tilt]
z_positions = 
	-74.0, -18.0
	76.0,  217.0
	226.0, -18.0
points = 
	45, 25
	101, 160
	175, 25
speed = 200
horizontal_move_z = 20.0
retries = 4
retry_tolerance = 0.05

[stepper_z]
enable_pin = !PG2
step_pin = !PF9
dir_pin = !PF10
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
position_max = 180
position_min = -5
homing_speed = 15.0
second_homing_speed = 5.0
homing_retract_dist = 10.0
homing_positive_dir = false

[tmc2208 stepper_z]
uart_pin = PF2
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z1]
enable_pin = !PF1
step_pin = !PC13
dir_pin = !PF0
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z1]
uart_pin = PE4
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z2]
enable_pin = !PD4
step_pin = !PE2
dir_pin = PE3
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z2]
uart_pin = PE1
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_x]
enable_pin = !PA0
step_pin = PG4
dir_pin = !PC1
endstop_pin = tmc2209_stepper_x:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -8
position_endstop = 180
position_max = 180
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0
homing_positive_dir = true

[tmc2209 stepper_x]
diag_pin = PG11
uart_pin = PC7
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_x1]
enable_pin = !PF15
step_pin = PG0
dir_pin = PG1
endstop_pin = tmc2209_stepper_x1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_x1]
diag_pin = PG9
uart_pin = PD11
interpolate = false
run_current = 0.85
sense_resistor = 0.110
driver_sgthrs = 125
stealthchop_threshold = 999999

[stepper_y]
enable_pin = !PG5
step_pin = PF11
dir_pin = PG3
endstop_pin = tmc2209_stepper_y:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -5
position_endstop = -2
position_max = 184
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0

[tmc2209 stepper_y]
diag_pin = PG10
uart_pin = PC6
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_y1]
enable_pin = !PF14
step_pin = PF13
dir_pin = !PF12
endstop_pin = tmc2209_stepper_y1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_y1]
diag_pin = PG6
uart_pin = PC4
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[gcode_macro nozzle_clean]
gcode = 
	SAVE_GCODE_STATE NAME=clean_nozzle_state
	Wipe_Nozzle
	RESTORE_GCODE_STATE NAME=clean_nozzle_state MOVE=1

[gcode_macro Nozzle_Wiper_Variables]
variable_purge_x = -8
variable_purge_y = 110
variable_purge_x_entry = 0
variable_purge_y_entry = 110
variable_wipe_dx = 0
variable_wipe_dy = 16
variable_wipe_count = 4
variable_travel_speed = 300
variable_entry_speed = 100
variable_wipe_speed = 50
variable_purge_speed = 4
variable_purge_fan = 255
variable_wipe_fan = 128
gcode = 

[gcode_macro Go_To_Purge_Location]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set St = printer["gcode_macro Nozzle_Wiper_Variables"].travel_speed * 60 %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	
	{% if not (printer.toolhead.position.x == Px and printer.toolhead.position.y == Py) %}
	G1 X{Pxe} Y{Pye} F{St}
	G1 X{Px} Y{Py} F{Se}
	{% endif %}

[gcode_macro Wipe_Nozzle]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set Wdx = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dx|float %}
	{% set Wdy = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dy|float %}
	{% set Wc = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_count|int %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	{% set Sw = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_fan %}
	{% set old_Sf = params.OLD_FAN_SPEED|default(printer.fan.speed)|int %}
	
	{% if printer.fan.speed < Sf %}
	{% set wait_for_fan = True %}
	{% else %}
	{% set wait_for_fan = False %}
	{% endif %}
	
	
	Go_To_Purge_Location
	
	
	M106 S{Sf}
	
	
	{% if wait_for_fan %}
	G4 P800
	{% endif %}
	
	
	G1 X{Px + Wdx} Y{Py + Wdy} F12000
	{% for i in range(Wc) %}
	G1 X{Px} Y{Py} F{Sw}
	G1 X{Px + Wdx} Y{Py + Wdy} F{Sw}
	{% endfor %}
	
	
	G1 X{Pxe + Wdx} Y{Pye + Wdy} F{Se}
	
	
	M106 S{old_Sf}

[gcode_macro Purge]
gcode = 
	{% set TEMPERATURE = params.DEFAULT_TEMPERATURE|default(230)|float %}
	{% set EXACT_TEMP = params.EXACT_EXTRUDER_TEMP|default(0)|int %}
	{% set FEED_AMOUNT = params.DEFAULT_FEED_AMOUNT|default(50)|int %}
	{% set Sp = printer["gcode_macro Nozzle_Wiper_Variables"].purge_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].purge_fan %}
	{% set old_Sf = printer.fan.speed %}
	
	
	Go_To_Purge_Location
	
	
	{% if EXACT_TEMP|int == 1 and printer.extruder.temperature < TEMPERATURE %}
	M109 S{TEMPERATURE}
	{% endif %}
	
	
	M106 S{Sf}
	
	
	M83
	G1 E{FEED_AMOUNT|float - 3} F{Sp}
	G1 E5 F{Sp}
	G92 E0.0
	
	
	G4 P800
	
	
	Wipe_Nozzle OLD_FAN_SPEED={old_Sf}

[board_pins]
aliases = 
	
	EXP1_1=PE8, EXP1_2=PE7,
	EXP1_3=PE9, EXP1_4=PE10,
	EXP1_5=PE12, EXP1_6=PE13,
	EXP1_7=PE14, EXP1_8=PE15,
	EXP1_9=<GND>, EXP1_10=<5V>,
	
	
	EXP2_1=PA6, EXP2_2=PA5,
	EXP2_3=PB1, EXP2_4=PA4,
	EXP2_5=PB2, EXP2_6=PA7,
	EXP2_7=PC15, EXP2_8=<RST>,
	EXP2_9=<GND>, EXP2_10=<5V>

[gcode_macro _User_Variables]
variable_verbose = True
variable_debug = False
variable_travel_speed = 200
variable_move_accel = 1000
variable_dock_speed = 50
variable_release_speed = 75
variable_z_drop_speed = 20
variable_safe_z = 15
variable_enable_z_hop = True
variable_max_bed_y = 182
variable_max_bed_x = 182
variable_z_endstop_x = 0
variable_z_endstop_y = 0
variable_docklocation_x = -8
variable_docklocation_y = 181
variable_docklocation_z = -128
variable_enable_dock_servo = False
variable_servo_name = 'NAME'
variable_servo_deploy = 10
variable_servo_retract = 11
variable_servo_delay = 250
variable_dockmove_x = 0
variable_dockmove_y = -50
variable_dockmove_z = 0
variable_attachmove_x = -50
variable_attachmove_y = 0
variable_attachmove_z = 0
variable_umbilical = False
variable_umbilical_x = 40
variable_umbilical_y = 40
variable_park_toolhead = True
variable_parkposition_x = 40
variable_parkposition_y = 181
variable_parkposition_z = 10
variable_version = 1
variable_attachmove2_x = 0
variable_attachmove2_y = 0
variable_attachmove2_z = 0
variable_home_backoff_x = 10
variable_home_backoff_y = 10
variable_override_homing = 'X'
variable_dock_on_zhome = False
variable_bypass_probe_docking = False
gcode = 
	{% set Mx = printer['configfile'].config["stepper_x"]["position_max"]|float %}
	{% set My = printer['configfile'].config["stepper_y"]["position_max"]|float %}
	{% set Ox = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set Oy = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set Oz = printer['configfile'].config["probe"]["z_offset"]|float %}
	
	
	{% if z_endstop_x != 0 or z_endstop_y != 0 %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ z_endstop_x }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ z_endstop_y }
	
	
	{% else %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ (Mx * 0.5) - Ox }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ (My * 0.5) - Oy }
	{% endif %}

[respond]

[gcode_macro _Probe_Variables]
variable_probe_attached = False
variable_probe_state = False
variable_probe_lock = False
variable_z_endstop_x = 0
variable_z_endstop_y = 0
gcode = 

[gcode_macro _klicky_check_variables_version]
gcode = 
	{% set version = printer["gcode_macro _User_Variables"].version|default(0) %}
	
	{% if version != 1 %}
	{ action_raise_error("Please update your klicky variables, there are some functionality changes") }
	{% endif %}

[gcode_macro _KlickyDebug]
gcode = 
	{% set message  = params.MSG %}
	{% set debug = printer["gcode_macro _User_Variables"].debug|default(False) %}
	
	{% if debug %}
	{ action_respond_info(message) }
	{% endif %}

[gcode_macro _exit_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move  = params.MOVE|default(0) %}
	{% set speed = printer["gcode_macro _User_Variables"].travel_speed %}
	
	
	M400
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	RESTORE_GCODE_STATE NAME={function} MOVE={move} MOVE_SPEED={speed}

[gcode_macro _entry_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move_accel = printer["gcode_macro _User_Variables"].move_accel|default(1000) %}
	
	M400
	SAVE_GCODE_STATE NAME={function}
	
	SET_GCODE_OFFSET Z=0
	
	G90
	
	SET_VELOCITY_LIMIT ACCEL={move_accel}

[gcode_macro _Homing_Variables]
gcode = 
	{% set reset  = params.RESET|default(0) %}
	{% if reset %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }
	{% endif %}

[gcode_macro Attach_Probe_Lock]
description = Attaches Klicky Probe, can only be docked after unlocking
gcode = 
	Attach_Probe
	_Probe_Lock

[gcode_macro Dock_Probe_Unlock]
description = Docks Klicky Probe even if it was locked
gcode = 
	_Probe_Unlock
	Dock_Probe

[gcode_macro _Probe_Unlock]
description = Unlocks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to False"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }

[gcode_macro _Probe_Lock]
description = Locks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to True"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ True }

[gcode_macro _DeployKlickyDock]
description = Deploys Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_deploy = printer["gcode_macro _User_Variables"].servo_deploy|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_DeployKlickyDock Klicky servo configuration enabled"
	{% if servo_deploy == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo deploy angle specified") }
	{% endif %}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _DeployDock"] is defined %}
	_KlickyDebug msg="_DeployKlickyDock calling _DeployDock"
	_DeployDock
	{% endif %}

[gcode_macro _RetractKlickyDock]
description = Retracts Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_retract = printer["gcode_macro _User_Variables"].servo_retract|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_RetractKlickyDock Klicky servo configuration enabled"
	{% if servo_retract == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo retract angle specified") }
	{% endif %}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _RetractDock"] is defined %}
	_KlickyDebug msg="_RetractKlickyDock calling _RetractDock"
	_RetractDock
	{% endif %}

[gcode_macro Attach_Probe]
description = Attaches Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set attachmove2_x = printer["gcode_macro _User_Variables"].attachmove2_x|default(0) %}
	{% set attachmove2_y = printer["gcode_macro _User_Variables"].attachmove2_y|default(0) %}
	{% set attachmove2_z = printer["gcode_macro _User_Variables"].attachmove2_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	_entry_point function=Attach_Probe
	
	{% if bypass_probe_docking == False %}
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	_KlickyDebug msg="Attach_Probe Axis homed"
	
	
	{% elif not probe_attached and not probe_lock %}
	_KlickyDebug msg="Attach_Probe going to attach probe"
	{% if verbose %}
	{ action_respond_info("Attaching Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% if not enable_z_hop %}
	_KlickyDebug msg="Attach_Probe z_hop disabled"
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero, duplicate?") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	_entry_point function=Attach_Probe_intern
	
	
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}"
	G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Attach_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	_CheckProbe action=attach
	
	_exit_point function=Attach_Probe_intern move={goback}
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe locked not attaching probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already attached!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe already attached, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Attach_Probe
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro Dock_Probe]
description = Docks Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	{% if bypass_probe_docking == False %}
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}
	
	
	{% if bypass_probe_docking == False %}
	_entry_point function=Dock_Probe
	
	
	{% if probe_attached and not probe_lock %}
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% endif %}
	_KlickyDebug msg="Dock_Probe Axis homed"
	_KlickyDebug msg="Dock_Probe going to dock probe"
	{% if verbose %}
	{ action_respond_info("Docking Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Dock_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}"
	G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}
	{% endif %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving away from the dock to G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Dock_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	G4 P1000
	_CheckProbe action=dock
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe locked not docking probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already docked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe already docked, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Dock_Probe move={goback}
	{% else %}
	_KlickyDebug msg="Dock_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro PROBE_CALIBRATE]
rename_existing = _PROBE_CALIBRATE
description = Calibrate the probes z_offset with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_calibrate Axis homed"
	_KlickyDebug msg="probe_calibrate Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_CALIBRATE with the probe above the BED, check klicky_variables bed size!") }
	{% endif %}
	
	{% if bypass_probe_docking == False %}
	_CheckProbe action=query
	G90
	Attach_Probe back=1
	_KLICKY_STATUS_CALIBRATING_Z
	
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	M118 moving the toolhead 20 mm from the bed
	_KlickyDebug msg="probe_calibrate Moving Z up by 20mm"
	TESTZ Z=20
	M118 remove manually the probe and continue calibration
	_KLICKY_STATUS_READY
	{% else %}
	_KLICKY_STATUS_CALIBRATING_Z
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	_KLICKY_STATUS_READY
	{% endif %}

[gcode_macro PROBE_ACCURACY]
rename_existing = _PROBE_ACCURACY
description = Probe Z-height accuracy at current XY position with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_accuracy Axis homed"
	_KlickyDebug msg="probe_accuracy Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	_entry_point function=PROBE_ACCURACY
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_ACCURACY with the probe above the BED, check klicky_variables bed size!") }
	{% endif%}
	
	_CheckProbe action=query
	Attach_Probe back=1
	
	_KlickyDebug msg="probe_accuracy calling klipper probe accuracy"
	_PROBE_ACCURACY {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	Dock_Probe back=1
	
	_exit_point function=PROBE_ACCURACY move=1

[force_move]
enable_force_move = True

[homing_override]
axes = xyz
gcode = 
	
	_User_Variables
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	{% set kinematic_z = 0 %}
	{% set dock_on_zhome = printer["gcode_macro _User_Variables"].dock_on_zhome|default(True) %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set home_backoff_x = printer["gcode_macro _User_Variables"].home_backoff_x|default(0) %}
	{% set home_backoff_y = printer["gcode_macro _User_Variables"].home_backoff_y|default(0) %}
	{% set override_homing = printer["gcode_macro _User_Variables"].override_homing|default('') %}
	
	
	_klicky_check_variables_version
	
	_CheckProbe action=query
	
	
	{% set home_x, home_y, home_z, leave_probe_attached = False, False, False, False %}
	
	{% if 'PROBE_LOCK' in params%}
	{% if verbose %}
	{ action_respond_info("PROBE_LOCK = True") }
	{% endif %}
	{% set leave_probe_attached = True %}
	{% endif %}
	
	
	{% if not 'X' in params
	and not 'Y' in params
	and not 'Z' in params %}
	
	{% set home_x, home_y, home_z = True, True, True %}
	_KlickyDebug msg="homing_override goint to home all axes"
	
	{% else %}
	{% if 'X' in params %}
	{% set home_x = True %}
	_KlickyDebug msg="homing_override goint to home X"
	
	{% endif %}
	
	{% if 'Y' in params %}
	{% set home_y = True %}
	_KlickyDebug msg="homing_override goint to home Y"
	{% endif %}
	
	{% if 'Z' in params %}
	{% set home_z = True %}
	_KlickyDebug msg="homing_override goint to home Z"
	{% endif %}
	
	{% if 'X' in params
	and 'Y' in params
	and 'Z' in params %}
	
	
	_Homing_Variables reset=1
	_KlickyDebug msg="homing_override goint to home all axes"
	{% endif %}
	
	{% endif %}
	
	_entry_point function=homing_override
	_KLICKY_STATUS_HOMING
	
	
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% if not enable_z_hop %}
	_KlickyDebug msg="homing_override z_hop disabled"
	
	{% set kinematic_z = safe_z %}
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes and 'z' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("No axis homed") }
	{% endif %}
	_KlickyDebug msg="homing_override no axis homed, setting position as X=Y=0 Z={kinematic_z}"
	SET_KINEMATIC_POSITION X=0 Y=0 Z={kinematic_z}
	M400
	_KlickyDebug msg="homing_override moving toolhead to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	_KlickyDebug msg="homing_override clearing axis homed state"
	M84
	{% endif %}
	
	{% if home_z %}
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("X or Y not homed, forcing full G28") }
	{% endif %}
	{% set home_x, home_y, home_z = True, True, True %}
	{% endif %}
	{% endif %}
	
	
	{% if ((attachmove_y == 0 and override_homing == '' ) or (override_homing == 'Y'))%}
	
	{% if home_y %}
	{% if override_homing == 'Y' %}
	_KlickyDebug msg="homing_override Y homing first override, due to override_homing = Y"
	{% else %}
	_KlickyDebug msg="homing_override Y homing first override, due to attachmove_y = 0"
	{% endif %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y G28 Y0"
	G28 Y0
	
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop-home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	{% set home_y = False %}
	{% endif %}
	
	
	
	{% if home_x %}
	{% if verbose %}
	{ action_respond_info("Homing X") }
	{% endif %}
	{% if printer["gcode_macro _HOME_X"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_X external script to handle the X homing"
	_HOME_X
	{% else %}
	_KlickyDebug msg="homing_override Homing X, G28 X0"
	G28 X0
	
	{% if home_backoff_x != 0 %}
	{% if (printer.configfile.settings.stepper_x.position_endstop > (printer.configfile.settings.stepper_x.position_min|default(0) + printer.configfile.settings.stepper_x.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	
	{% if home_y %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y, G28 Y0"
	G28 Y0
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	{% if home_z %}
	{% if verbose %}
	{ action_respond_info("Homing Z") }
	{% endif %}
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe configured as a virtual Z endstop attaching probe"
	Attach_Probe
	
	{% if leave_probe_attached %}
	_Probe_Lock
	{% endif %}
	{% elif dock_on_zhome == True %}
	Dock_Probe
	{% endif %}
	
	_Home_Z
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe no longer required, docking probe"
	Dock_Probe
	{% elif dock_on_zhome == False %}
	Dock_Probe
	{% endif %}
	{% endif %}
	_CheckProbe action=query
	
	
	_Park_Toolhead
	
	_exit_point function=homing_override
	_KLICKY_STATUS_READY

[gcode_macro _Umbilical_Path]
gcode = 
	{% set umbilical = printer["gcode_macro _User_Variables"].umbilical %}
	{% set umbilical_x = printer["gcode_macro _User_Variables"].umbilical_x %}
	{% set umbilical_y = printer["gcode_macro _User_Variables"].umbilical_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	
	{% if umbilical %}
	
	_entry_point function=Umbilical_Path
	
	_KlickyDebug msg="_Umbilical_Path moving to G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}"
	G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}
	
	_exit_point function=Umbilical_Path
	{% endif %}

[gcode_macro _Home_Z]
gcode = 
	{% set z_endstop_x = printer["gcode_macro _Probe_Variables"].z_endstop_x %}
	{% set z_endstop_y = printer["gcode_macro _Probe_Variables"].z_endstop_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}    {% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Home_Z
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% else %}
	_KlickyDebug msg="_Home_Z XY Axis homed"
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="_Home_Z Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	
	
	_KlickyDebug msg="_Home_Z moving to Z endstop position G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}"
	G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}
	_KlickyDebug msg="_Home_Z Homing Z G28 Z"
	G28 Z0
	_KlickyDebug msg="_Home_Z toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_exit_point function=Home_Z

[gcode_macro _CheckProbe]
variable_probe_state = 0
gcode = 
	Query_Probe
	_SetProbeState action={ params.ACTION }

[gcode_macro _SetProbeState]
gcode = 
	{% set query_probe_triggered = printer.probe.last_query %}
	{% set action  = params.ACTION|default('') %}
	
	
	{% if query_probe_triggered %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ False }
	{% else %}
	
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ True }
	{% endif %}
	
	{% if action == 'query' %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_state VALUE={ query_probe_triggered }
	{% endif %}
	
	
	
	
	{% if not query_probe_triggered and action == 'dock' %}
	{ action_raise_error("Probe dock failed!") }
	{% endif %}
	
	
	{% if query_probe_triggered and action == 'attach' %}
	{ action_raise_error("Probe attach failed!") }
	{% endif %}

[gcode_macro _Park_Toolhead]
gcode = 
	{% set park_toolhead = printer["gcode_macro _User_Variables"].park_toolhead %}
	{% set parkposition_x = printer["gcode_macro _User_Variables"].parkposition_x %}
	{% set parkposition_y = printer["gcode_macro _User_Variables"].parkposition_y %}
	{% set parkposition_z = printer["gcode_macro _User_Variables"].parkposition_z %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Park_Toolhead
	
	{% if park_toolhead and 'xyz' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Parking Toolhead") }
	{% endif %}
	{% if parkposition_z == -128 %}
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}
	
	{% else %}
	
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}
	
	{% endif %}
	
	{% endif %}
	_exit_point function=Park_Toolhead

[gcode_macro _klicky_status_ready]
gcode = 
	{% if printer['gcode_macro status_ready'] is defined %}
	_KlickyDebug msg="_klicky_status_ready activating the LED STATUS_READY"
	STATUS_READY
	{% endif %}

[gcode_macro _klicky_status_busy]
gcode = 
	{% if printer['gcode_macro status_busy'] is defined %}
	_KlickyDebug msg="_klicky_status_busy activating the LED STATUS_BUSY"
	STATUS_BUSY
	{% endif %}

[gcode_macro _klicky_status_leveling]
gcode = 
	{% if printer['gcode_macro status_leveling'] is defined %}
	_KlickyDebug msg="_klicky_status_leveling activating the LED STATUS_LEVELING"
	STATUS_LEVELING
	{% endif %}

[gcode_macro _klicky_status_homing]
gcode = 
	{% if printer['gcode_macro status_homing'] is defined %}
	_KlickyDebug msg="_klicky_status_homing activating the LED STATUS_HOMING"
	STATUS_HOMING
	{% endif %}

[gcode_macro _klicky_status_cleaning]
gcode = 
	{% if printer['gcode_macro status_cleaning'] is defined %}
	_KlickyDebug msg="_klicky_status_cleaning activating the LED STATUS_CLEANING"
	STATUS_CLEANING
	{% endif %}

[gcode_macro _klicky_status_meshing]
gcode = 
	{% if printer['gcode_macro status_meshing'] is defined %}
	_KlickyDebug msg="_klicky_status_meshing activating the LED STATUS_MESHING"
	STATUS_MESHING
	{% endif %}

[gcode_macro _klicky_status_calibrating_z]
gcode = 
	{% if printer['gcode_macro status_calibrating_z'] is defined %}
	_KlickyDebug msg="_klicky_status_calibrating_z activating the LED STATUS_CALIBRATING_Z"
	STATUS_CALIBRATING_Z
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = _Z_TILT_ADJUST
description = 
gcode = 
	{% set V = printer["gcode_macro _User_Variables"].verbose %}
	{% if V %}
	{ action_respond_info("Z Tilt Adjust") }
	{% endif %}
	
	_CheckProbe action=query
	G90
	Attach_Probe
	_KLICKY_STATUS_LEVELING
	
	_Z_TILT_ADJUST {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	Dock_Probe
	G28 Z0

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
variable_led_enable = False
variable_status_macro = 'status_meshing'
variable_fuzz_enable = False
variable_fuzz_min = 0
variable_fuzz_max = 4
variable_margin_enable = False
variable_margin_size = 5
variable_probe_dock_enable = True
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_display_parameters = True
gcode = 
	
	{% if display_parameters == True %}
	{ action_respond_info("led_enable  : %d" % (led_enable))  }
	{ action_respond_info("status_macro: \'%s\'" % (status_macro))  }
	{ action_respond_info("fuzz_enable : %d" % (fuzz_enable))  }
	{ action_respond_info("fuzz_min    : %f" % (fuzz_min))  }
	{ action_respond_info("fuzz_max    : %f" % (fuzz_max))  }
	{ action_respond_info("probe_dock_enable: %d" % (probe_dock_enable))  }
	{ action_respond_info("attach_macro: \'%s\'" % (attach_macro))  }
	{ action_respond_info("detach_macro: \'%s\'" % (detach_macro))  }
	{% endif %}
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% if margin_enable == False %}
	{% set margin_size = 0 %}
	{% endif %}
	
	{ action_respond_info("{} object points, clamping to bed mesh [{!r} {!r}]".format(
	all_points | count,
	bed_mesh_min,
	bed_mesh_max,
	)) }
	
	{% if fuzz_enable == True %}
	{% set fuzz_range = range((fuzz_min * 100) | int, (fuzz_max * 100) | int + 1) %}
	{% set x_min = (bed_mesh_min[0] + fuzz_max - margin_size, x_min) | max - (fuzz_range | random / 100.0) %}
	{% set y_min = (bed_mesh_min[1] + fuzz_max - margin_size, y_min) | max - (fuzz_range | random / 100.0) %}
	{% set x_max = (bed_mesh_max[0] - fuzz_max + margin_size, x_max) | min + (fuzz_range | random / 100.0) %}
	{% set y_max = (bed_mesh_max[1] - fuzz_max + margin_size, y_max) | min + (fuzz_range | random / 100.0) %}
	{% else %}
	{% set x_min = [ bed_mesh_min[0], x_min - margin_size ] | max %}
	{% set y_min = [ bed_mesh_min[1], y_min - margin_size ] | max %}
	{% set x_max = [ bed_mesh_max[0], x_max + margin_size ] | min %}
	{% set y_max = [ bed_mesh_max[1], y_max + margin_size ] | min %}
	{% endif %}
	
	{ action_respond_info("Object bounds, clamped to the bed_mesh: {!r}, {!r}".format(
	(x_min, y_min),
	(x_max, y_max),
	)) }
	
	{% set points_x = (((x_max - x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((y_max - y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	{ action_respond_info( "Algorithm: {}".format(algorithm)) }
	
	{% set points_x = [points_x, min_points]|max  %}
	{% set points_y = [points_y, min_points]|max  %}
	{ action_respond_info( "Points: x: {}, y: {}".format(points_x, points_y) ) }
	
	{% if printer.configfile.settings.bed_mesh.relative_reference_index is defined %}
	{% set ref_index = (points_x * points_y / 2) | int %}
	{ action_respond_info( "Reference index: {}".format(ref_index) ) }
	{% else %}
	{% set ref_index = -1 %}
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	{% if led_enable == True %}
	{status_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={x_min},{y_min} mesh_max={x_max},{y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y} RELATIVE_REFERENCE_INDEX={ref_index}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SETUP_KAMP_MESHING]
gcode = 
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=display_parameters   VALUE={params.DISPLAY_PARAMETERS|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=led_enable   VALUE={params.LED_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=status_macro VALUE='"{params.STATUS_MACRO|default('status_meshing')|string}"'
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_enable VALUE={params.FUZZ_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_min    VALUE={params.FUZZ_MIN|default(0)|float}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_max    VALUE={params.FUZZ_MAX|default(4)|float}
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=probe_dock_enable VALUE={params.PROBE_DOCK_ENABLE|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=attach_macro VALUE='"{params.ATTACH_MACRO|default('Attach_Probe')|string}"'
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=detach_macro VALUE='"{params.DETACH_MACRO|default('Dock_Probe')|string}"'

[gcode_macro G29]
gcode = 
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro park_hotend]
gcode = 
	G1 X40
	M400
	G1 Y181
	M400

[gcode_macro LON]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro PRINTING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro LOFF]
gcode = 
	SET_LED LED=hotend RED=0 GREEN=0 BLUE=0

[gcode_macro HEATING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0.0314 BLUE=0 SYNC=0 TRANSMIT=1

[gcode_macro DONE]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0 BLUE=0.8157 SYNC=0 TRANSMIT=1

[gcode_macro PID_HOTEND]
gcode = 
	{% set EXTRUDER_TEMP = params.TEMPERATURE|default(245)|float %}
	PID_CALIBRATE HEATER=extruder TARGET={EXTRUDER_TEMP}

[gcode_macro PID_BED]
gcode = 
	{% set BED_TEMP = params.TEMPERATURE|default(110)|float %}
	PID_CALIBRATE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro SLOW]
gcode = 
	M220 S50
	SET_VELOCITY_LIMIT ACCEL=3000

[gcode_macro FAST]
gcode = 
	M220 S100
	SET_VELOCITY_LIMIT ACCEL=7500

[gcode_macro START_PRINT]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(190)|float %}
	{% set CHAMBER_TEMP = params.CHAMBER_TEMP|default(32)|float %}
	
	SETUP_KAMP_MESHING DISPLAY_PARAMETERS=1 PROBE_DOCK_ENABLE=1
	HEATING
	
	M117 Setting heater temps
	G90
	M140 S{BED_TEMP}
	M104 S0
	M400
	
	M117 Homing all axis
	G28
	
	{% if printer["temperature_sensor Chamber"].temperature < CHAMBER_TEMP %}
	M106 S255
	G0 X90 Y90 Z15
	M117 Waiting for Chamber to reach {CHAMBER_TEMP}
	TEMPERATURE_WAIT SENSOR="temperature_sensor Chamber" MINIMUM={CHAMBER_TEMP}
	M107
	M400
	{% endif %}
	
	M117 Waiting for bed, setting ext temp
	M190 S{BED_TEMP}
	M104 S{EXTRUDER_TEMP}
	M400
	
	M117 Z Tilt Adjust
	Z_TILT_ADJUST
	M400
	
	M117 Hot probe
	G29
	
	M117 Heating HotEnd
	Go_To_Purge_Location
	M400
	
	M117 Moving Z to top
	G0 Z1
	M400
	
	M117 Cleaning nozzle
	Purge
	M400
	
	M400
	M117 Print Started
	PRINTING

[gcode_macro END_PRINT]
gcode = 
	G91
	G1 Z5
	
	M400
	
	M83
	G1 E-10 F300
	
	M104 S0
	M140 S0
	M106 S0
	
	G90
	G1 X40 Y181 F10000
	
	M400
	
	M18 Y X E
	DONE

[gcode_macro BUZZ]
gcode = 
	{% set MOTOR = params.STEPPER|default(stepper_x)|string %}
	{% if MOTOR == 'x' %}
	{% set MOTOR = 'stepper_x' %}
	{% endif %}
	{% if MOTOR == 'x1' %}
	{% set MOTOR = 'stepper_x1' %}
	{% endif %}
	{% if MOTOR == 'y' %}
	{% set MOTOR = 'stepper_y' %}
	{% endif %}
	{% if MOTOR == 'y1' %}
	{% set MOTOR = 'stepper_y1' %}
	{% endif %}
	{% if MOTOR == 'z' %}
	{% set MOTOR = 'stepper_z' %}
	{% endif %}
	{% if MOTOR == 'z1' %}
	{% set MOTOR = 'stepper_z1' %}
	{% endif %}
	{% if MOTOR == 'z2' %}
	{% set MOTOR = 'stepper_z2' %}
	{% endif %}
	STEPPER_BUZZ stepper={MOTOR}

[gcode_macro PA]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[virtual_sdcard]
path = ~/gcode_files

[heater_fan hotend_fan]
pin = PA8
shutdown_speed = 0
fan_speed = 1
kick_start_time = 0.25
heater_temp = 50

[temperature_sensor Chamber]
sensor_pin = PF5
sensor_type = Generic 3950

[multi_pin cooling_fan_pins]
pins = PE5,PD12

[fan]
kick_start_time = 0.25
pin = multi_pin:cooling_fan_pins

[controller_fan case_fans]
kick_start_time = 1
fan_speed = 1
idle_timeout = 120
pin = PD13
heater = extruder
stepper = stepper_x

[controller_fan nevermore]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD14
heater = extruder
stepper = stepper_x

[controller_fan milkbox]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD15
heater = extruder
stepper = stepper_x

[printer]
kinematics = cartesian
max_velocity = 500
max_accel = 5000
max_z_velocity = 15
max_z_accel = 100
square_corner_velocity = 5

[exclude_object]

[gcode_arcs]
resolution = 0.1

[idle_timeout]
timeout = 1200

[mcu]
serial = /dev/ttyAMA0
restart_method = command

[extruder]
enable_pin = !PE0
step_pin = PE6
dir_pin = PA14
heater_pin = PA2
sensor_pin = PF4
microsteps = 16
rotation_distance = 22.71546
gear_ratio = 5:1
max_extrude_only_distance = 200
full_steps_per_rotation = 200
nozzle_diameter = 0.400
filament_diameter = 1.750
sensor_type = ATC Semitec 104NT-4-R025H42G
control = pid
min_temp = -200
max_temp = 280
min_extrude_temp = 0

[tmc2208 extruder]
uart_pin = PD3
run_current = 0.25
sense_resistor = 0.110
hold_current = 0.1
driver_pwm_grad = 8
stealthchop_threshold = 5000

[neopixel front_strip]
pin = PB0
color_order = GRB
chain_count = 6
initial_red = 1
initial_green = 1
initial_blue = 0.7
=======================
Config error
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/rudis1261/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/rudis1261/klipper/klippy/toolhead.py", line 607, in add_printer_objects
    kinematics.extruder.add_printer_objects(config)
  File "/home/rudis1261/klipper/klippy/kinematics/extruder.py", line 339, in add_printer_objects
    pe = PrinterExtruder(config.getsection(section), i)
  File "/home/rudis1261/klipper/klippy/kinematics/extruder.py", line 166, in __init__
    self.heater = pheaters.setup_heater(config, gcode_id)
  File "/home/rudis1261/klipper/klippy/extras/heaters.py", line 265, in setup_heater
    self.heaters[heater_name] = heater = Heater(config, sensor)
  File "/home/rudis1261/klipper/klippy/extras/heaters.py", line 48, in __init__
    self.control = algo(self, config)
  File "/home/rudis1261/klipper/klippy/extras/heaters.py", line 179, in __init__
    self.Kp = config.getfloat('pid_Kp') / PID_PARAM_BASE
  File "/home/rudis1261/klipper/klippy/configfile.py", line 65, in getfloat
    return self._get_wrapper(self.fileconfig.getfloat, option, default,
  File "/home/rudis1261/klipper/klippy/configfile.py", line 32, in _get_wrapper
    raise error("Option '%s' in section '%s' must be specified"
configparser.Error: Option 'pid_Kp' in section 'extruder' must be specified
webhooks client 4106138144: New connection
webhooks client 4106138144: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
Unable to issue reset command on MCU 'mcu'
webhooks client 4106138144: Disconnected
Restarting printer
Start printer at Fri Jul  7 19:17:17 2023 (1688750237.8 7197.2)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	END_PRINT

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME
	wipe_nozzle

[probe]
pin = PG13
x_offset = -25.0
y_offset = -1.88
z_offset = 9.075

[heater_bed]
heater_pin = PA3
sensor_pin = PF3
sensor_type = Generic 3950
smooth_time = 3.0
max_power = 0.60
control = pid
pid_kp = 31.649
pid_ki = 1.901
pid_kd = 131.740
min_temp = -200
max_temp = 130

[bed_mesh]
speed = 200
horizontal_move_z = 10
mesh_min = 10, 7
mesh_max = 155, 165
probe_count = 5,5
fade_start = 0.5
fade_end = 2
split_delta_z = .025
move_check_distance = 5.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = 0.1
relative_reference_index = 12

[z_tilt]
z_positions = 
	-74.0, -18.0
	76.0,  217.0
	226.0, -18.0
points = 
	45, 25
	101, 160
	175, 25
speed = 200
horizontal_move_z = 20.0
retries = 4
retry_tolerance = 0.05

[stepper_z]
enable_pin = !PG2
step_pin = !PF9
dir_pin = !PF10
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
position_max = 180
position_min = -5
homing_speed = 15.0
second_homing_speed = 5.0
homing_retract_dist = 10.0
homing_positive_dir = false

[tmc2208 stepper_z]
uart_pin = PF2
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z1]
enable_pin = !PF1
step_pin = !PC13
dir_pin = !PF0
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z1]
uart_pin = PE4
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z2]
enable_pin = !PD4
step_pin = !PE2
dir_pin = PE3
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z2]
uart_pin = PE1
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_x]
enable_pin = !PA0
step_pin = PG4
dir_pin = !PC1
endstop_pin = tmc2209_stepper_x:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -8
position_endstop = 180
position_max = 180
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0
homing_positive_dir = true

[tmc2209 stepper_x]
diag_pin = PG11
uart_pin = PC7
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_x1]
enable_pin = !PF15
step_pin = PG0
dir_pin = PG1
endstop_pin = tmc2209_stepper_x1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_x1]
diag_pin = PG9
uart_pin = PD11
interpolate = false
run_current = 0.85
sense_resistor = 0.110
driver_sgthrs = 125
stealthchop_threshold = 999999

[stepper_y]
enable_pin = !PG5
step_pin = PF11
dir_pin = PG3
endstop_pin = tmc2209_stepper_y:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -5
position_endstop = -2
position_max = 184
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0

[tmc2209 stepper_y]
diag_pin = PG10
uart_pin = PC6
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_y1]
enable_pin = !PF14
step_pin = PF13
dir_pin = !PF12
endstop_pin = tmc2209_stepper_y1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_y1]
diag_pin = PG6
uart_pin = PC4
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[gcode_macro nozzle_clean]
gcode = 
	SAVE_GCODE_STATE NAME=clean_nozzle_state
	Wipe_Nozzle
	RESTORE_GCODE_STATE NAME=clean_nozzle_state MOVE=1

[gcode_macro Nozzle_Wiper_Variables]
variable_purge_x = -8
variable_purge_y = 110
variable_purge_x_entry = 0
variable_purge_y_entry = 110
variable_wipe_dx = 0
variable_wipe_dy = 16
variable_wipe_count = 4
variable_travel_speed = 300
variable_entry_speed = 100
variable_wipe_speed = 50
variable_purge_speed = 4
variable_purge_fan = 255
variable_wipe_fan = 128
gcode = 

[gcode_macro Go_To_Purge_Location]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set St = printer["gcode_macro Nozzle_Wiper_Variables"].travel_speed * 60 %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	
	{% if not (printer.toolhead.position.x == Px and printer.toolhead.position.y == Py) %}
	G1 X{Pxe} Y{Pye} F{St}
	G1 X{Px} Y{Py} F{Se}
	{% endif %}

[gcode_macro Wipe_Nozzle]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set Wdx = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dx|float %}
	{% set Wdy = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dy|float %}
	{% set Wc = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_count|int %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	{% set Sw = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_fan %}
	{% set old_Sf = params.OLD_FAN_SPEED|default(printer.fan.speed)|int %}
	
	{% if printer.fan.speed < Sf %}
	{% set wait_for_fan = True %}
	{% else %}
	{% set wait_for_fan = False %}
	{% endif %}
	
	
	Go_To_Purge_Location
	
	
	M106 S{Sf}
	
	
	{% if wait_for_fan %}
	G4 P800
	{% endif %}
	
	
	G1 X{Px + Wdx} Y{Py + Wdy} F12000
	{% for i in range(Wc) %}
	G1 X{Px} Y{Py} F{Sw}
	G1 X{Px + Wdx} Y{Py + Wdy} F{Sw}
	{% endfor %}
	
	
	G1 X{Pxe + Wdx} Y{Pye + Wdy} F{Se}
	
	
	M106 S{old_Sf}

[gcode_macro Purge]
gcode = 
	{% set TEMPERATURE = params.DEFAULT_TEMPERATURE|default(230)|float %}
	{% set EXACT_TEMP = params.EXACT_EXTRUDER_TEMP|default(0)|int %}
	{% set FEED_AMOUNT = params.DEFAULT_FEED_AMOUNT|default(50)|int %}
	{% set Sp = printer["gcode_macro Nozzle_Wiper_Variables"].purge_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].purge_fan %}
	{% set old_Sf = printer.fan.speed %}
	
	
	Go_To_Purge_Location
	
	
	{% if EXACT_TEMP|int == 1 and printer.extruder.temperature < TEMPERATURE %}
	M109 S{TEMPERATURE}
	{% endif %}
	
	
	M106 S{Sf}
	
	
	M83
	G1 E{FEED_AMOUNT|float - 3} F{Sp}
	G1 E5 F{Sp}
	G92 E0.0
	
	
	G4 P800
	
	
	Wipe_Nozzle OLD_FAN_SPEED={old_Sf}

[board_pins]
aliases = 
	
	EXP1_1=PE8, EXP1_2=PE7,
	EXP1_3=PE9, EXP1_4=PE10,
	EXP1_5=PE12, EXP1_6=PE13,
	EXP1_7=PE14, EXP1_8=PE15,
	EXP1_9=<GND>, EXP1_10=<5V>,
	
	
	EXP2_1=PA6, EXP2_2=PA5,
	EXP2_3=PB1, EXP2_4=PA4,
	EXP2_5=PB2, EXP2_6=PA7,
	EXP2_7=PC15, EXP2_8=<RST>,
	EXP2_9=<GND>, EXP2_10=<5V>

[gcode_macro _User_Variables]
variable_verbose = True
variable_debug = False
variable_travel_speed = 200
variable_move_accel = 1000
variable_dock_speed = 50
variable_release_speed = 75
variable_z_drop_speed = 20
variable_safe_z = 15
variable_enable_z_hop = True
variable_max_bed_y = 182
variable_max_bed_x = 182
variable_z_endstop_x = 0
variable_z_endstop_y = 0
variable_docklocation_x = -8
variable_docklocation_y = 181
variable_docklocation_z = -128
variable_enable_dock_servo = False
variable_servo_name = 'NAME'
variable_servo_deploy = 10
variable_servo_retract = 11
variable_servo_delay = 250
variable_dockmove_x = 0
variable_dockmove_y = -50
variable_dockmove_z = 0
variable_attachmove_x = -50
variable_attachmove_y = 0
variable_attachmove_z = 0
variable_umbilical = False
variable_umbilical_x = 40
variable_umbilical_y = 40
variable_park_toolhead = True
variable_parkposition_x = 40
variable_parkposition_y = 181
variable_parkposition_z = 10
variable_version = 1
variable_attachmove2_x = 0
variable_attachmove2_y = 0
variable_attachmove2_z = 0
variable_home_backoff_x = 10
variable_home_backoff_y = 10
variable_override_homing = 'X'
variable_dock_on_zhome = False
variable_bypass_probe_docking = False
gcode = 
	{% set Mx = printer['configfile'].config["stepper_x"]["position_max"]|float %}
	{% set My = printer['configfile'].config["stepper_y"]["position_max"]|float %}
	{% set Ox = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set Oy = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set Oz = printer['configfile'].config["probe"]["z_offset"]|float %}
	
	
	{% if z_endstop_x != 0 or z_endstop_y != 0 %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ z_endstop_x }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ z_endstop_y }
	
	
	{% else %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ (Mx * 0.5) - Ox }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ (My * 0.5) - Oy }
	{% endif %}

[respond]

[gcode_macro _Probe_Variables]
variable_probe_attached = False
variable_probe_state = False
variable_probe_lock = False
variable_z_endstop_x = 0
variable_z_endstop_y = 0
gcode = 

[gcode_macro _klicky_check_variables_version]
gcode = 
	{% set version = printer["gcode_macro _User_Variables"].version|default(0) %}
	
	{% if version != 1 %}
	{ action_raise_error("Please update your klicky variables, there are some functionality changes") }
	{% endif %}

[gcode_macro _KlickyDebug]
gcode = 
	{% set message  = params.MSG %}
	{% set debug = printer["gcode_macro _User_Variables"].debug|default(False) %}
	
	{% if debug %}
	{ action_respond_info(message) }
	{% endif %}

[gcode_macro _exit_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move  = params.MOVE|default(0) %}
	{% set speed = printer["gcode_macro _User_Variables"].travel_speed %}
	
	
	M400
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	RESTORE_GCODE_STATE NAME={function} MOVE={move} MOVE_SPEED={speed}

[gcode_macro _entry_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move_accel = printer["gcode_macro _User_Variables"].move_accel|default(1000) %}
	
	M400
	SAVE_GCODE_STATE NAME={function}
	
	SET_GCODE_OFFSET Z=0
	
	G90
	
	SET_VELOCITY_LIMIT ACCEL={move_accel}

[gcode_macro _Homing_Variables]
gcode = 
	{% set reset  = params.RESET|default(0) %}
	{% if reset %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }
	{% endif %}

[gcode_macro Attach_Probe_Lock]
description = Attaches Klicky Probe, can only be docked after unlocking
gcode = 
	Attach_Probe
	_Probe_Lock

[gcode_macro Dock_Probe_Unlock]
description = Docks Klicky Probe even if it was locked
gcode = 
	_Probe_Unlock
	Dock_Probe

[gcode_macro _Probe_Unlock]
description = Unlocks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to False"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }

[gcode_macro _Probe_Lock]
description = Locks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to True"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ True }

[gcode_macro _DeployKlickyDock]
description = Deploys Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_deploy = printer["gcode_macro _User_Variables"].servo_deploy|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_DeployKlickyDock Klicky servo configuration enabled"
	{% if servo_deploy == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo deploy angle specified") }
	{% endif %}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _DeployDock"] is defined %}
	_KlickyDebug msg="_DeployKlickyDock calling _DeployDock"
	_DeployDock
	{% endif %}

[gcode_macro _RetractKlickyDock]
description = Retracts Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_retract = printer["gcode_macro _User_Variables"].servo_retract|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_RetractKlickyDock Klicky servo configuration enabled"
	{% if servo_retract == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo retract angle specified") }
	{% endif %}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _RetractDock"] is defined %}
	_KlickyDebug msg="_RetractKlickyDock calling _RetractDock"
	_RetractDock
	{% endif %}

[gcode_macro Attach_Probe]
description = Attaches Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set attachmove2_x = printer["gcode_macro _User_Variables"].attachmove2_x|default(0) %}
	{% set attachmove2_y = printer["gcode_macro _User_Variables"].attachmove2_y|default(0) %}
	{% set attachmove2_z = printer["gcode_macro _User_Variables"].attachmove2_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	_entry_point function=Attach_Probe
	
	{% if bypass_probe_docking == False %}
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	_KlickyDebug msg="Attach_Probe Axis homed"
	
	
	{% elif not probe_attached and not probe_lock %}
	_KlickyDebug msg="Attach_Probe going to attach probe"
	{% if verbose %}
	{ action_respond_info("Attaching Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% if not enable_z_hop %}
	_KlickyDebug msg="Attach_Probe z_hop disabled"
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero, duplicate?") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	_entry_point function=Attach_Probe_intern
	
	
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}"
	G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Attach_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	_CheckProbe action=attach
	
	_exit_point function=Attach_Probe_intern move={goback}
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe locked not attaching probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already attached!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe already attached, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Attach_Probe
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro Dock_Probe]
description = Docks Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	{% if bypass_probe_docking == False %}
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}
	
	
	{% if bypass_probe_docking == False %}
	_entry_point function=Dock_Probe
	
	
	{% if probe_attached and not probe_lock %}
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% endif %}
	_KlickyDebug msg="Dock_Probe Axis homed"
	_KlickyDebug msg="Dock_Probe going to dock probe"
	{% if verbose %}
	{ action_respond_info("Docking Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Dock_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}"
	G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}
	{% endif %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving away from the dock to G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Dock_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	G4 P1000
	_CheckProbe action=dock
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe locked not docking probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already docked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe already docked, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Dock_Probe move={goback}
	{% else %}
	_KlickyDebug msg="Dock_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro PROBE_CALIBRATE]
rename_existing = _PROBE_CALIBRATE
description = Calibrate the probes z_offset with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_calibrate Axis homed"
	_KlickyDebug msg="probe_calibrate Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_CALIBRATE with the probe above the BED, check klicky_variables bed size!") }
	{% endif %}
	
	{% if bypass_probe_docking == False %}
	_CheckProbe action=query
	G90
	Attach_Probe back=1
	_KLICKY_STATUS_CALIBRATING_Z
	
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	M118 moving the toolhead 20 mm from the bed
	_KlickyDebug msg="probe_calibrate Moving Z up by 20mm"
	TESTZ Z=20
	M118 remove manually the probe and continue calibration
	_KLICKY_STATUS_READY
	{% else %}
	_KLICKY_STATUS_CALIBRATING_Z
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	_KLICKY_STATUS_READY
	{% endif %}

[gcode_macro PROBE_ACCURACY]
rename_existing = _PROBE_ACCURACY
description = Probe Z-height accuracy at current XY position with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_accuracy Axis homed"
	_KlickyDebug msg="probe_accuracy Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	_entry_point function=PROBE_ACCURACY
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_ACCURACY with the probe above the BED, check klicky_variables bed size!") }
	{% endif%}
	
	_CheckProbe action=query
	Attach_Probe back=1
	
	_KlickyDebug msg="probe_accuracy calling klipper probe accuracy"
	_PROBE_ACCURACY {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	Dock_Probe back=1
	
	_exit_point function=PROBE_ACCURACY move=1

[force_move]
enable_force_move = True

[homing_override]
axes = xyz
gcode = 
	
	_User_Variables
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	{% set kinematic_z = 0 %}
	{% set dock_on_zhome = printer["gcode_macro _User_Variables"].dock_on_zhome|default(True) %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set home_backoff_x = printer["gcode_macro _User_Variables"].home_backoff_x|default(0) %}
	{% set home_backoff_y = printer["gcode_macro _User_Variables"].home_backoff_y|default(0) %}
	{% set override_homing = printer["gcode_macro _User_Variables"].override_homing|default('') %}
	
	
	_klicky_check_variables_version
	
	_CheckProbe action=query
	
	
	{% set home_x, home_y, home_z, leave_probe_attached = False, False, False, False %}
	
	{% if 'PROBE_LOCK' in params%}
	{% if verbose %}
	{ action_respond_info("PROBE_LOCK = True") }
	{% endif %}
	{% set leave_probe_attached = True %}
	{% endif %}
	
	
	{% if not 'X' in params
	and not 'Y' in params
	and not 'Z' in params %}
	
	{% set home_x, home_y, home_z = True, True, True %}
	_KlickyDebug msg="homing_override goint to home all axes"
	
	{% else %}
	{% if 'X' in params %}
	{% set home_x = True %}
	_KlickyDebug msg="homing_override goint to home X"
	
	{% endif %}
	
	{% if 'Y' in params %}
	{% set home_y = True %}
	_KlickyDebug msg="homing_override goint to home Y"
	{% endif %}
	
	{% if 'Z' in params %}
	{% set home_z = True %}
	_KlickyDebug msg="homing_override goint to home Z"
	{% endif %}
	
	{% if 'X' in params
	and 'Y' in params
	and 'Z' in params %}
	
	
	_Homing_Variables reset=1
	_KlickyDebug msg="homing_override goint to home all axes"
	{% endif %}
	
	{% endif %}
	
	_entry_point function=homing_override
	_KLICKY_STATUS_HOMING
	
	
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% if not enable_z_hop %}
	_KlickyDebug msg="homing_override z_hop disabled"
	
	{% set kinematic_z = safe_z %}
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes and 'z' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("No axis homed") }
	{% endif %}
	_KlickyDebug msg="homing_override no axis homed, setting position as X=Y=0 Z={kinematic_z}"
	SET_KINEMATIC_POSITION X=0 Y=0 Z={kinematic_z}
	M400
	_KlickyDebug msg="homing_override moving toolhead to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	_KlickyDebug msg="homing_override clearing axis homed state"
	M84
	{% endif %}
	
	{% if home_z %}
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("X or Y not homed, forcing full G28") }
	{% endif %}
	{% set home_x, home_y, home_z = True, True, True %}
	{% endif %}
	{% endif %}
	
	
	{% if ((attachmove_y == 0 and override_homing == '' ) or (override_homing == 'Y'))%}
	
	{% if home_y %}
	{% if override_homing == 'Y' %}
	_KlickyDebug msg="homing_override Y homing first override, due to override_homing = Y"
	{% else %}
	_KlickyDebug msg="homing_override Y homing first override, due to attachmove_y = 0"
	{% endif %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y G28 Y0"
	G28 Y0
	
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop-home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	{% set home_y = False %}
	{% endif %}
	
	
	
	{% if home_x %}
	{% if verbose %}
	{ action_respond_info("Homing X") }
	{% endif %}
	{% if printer["gcode_macro _HOME_X"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_X external script to handle the X homing"
	_HOME_X
	{% else %}
	_KlickyDebug msg="homing_override Homing X, G28 X0"
	G28 X0
	
	{% if home_backoff_x != 0 %}
	{% if (printer.configfile.settings.stepper_x.position_endstop > (printer.configfile.settings.stepper_x.position_min|default(0) + printer.configfile.settings.stepper_x.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	
	{% if home_y %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y, G28 Y0"
	G28 Y0
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	{% if home_z %}
	{% if verbose %}
	{ action_respond_info("Homing Z") }
	{% endif %}
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe configured as a virtual Z endstop attaching probe"
	Attach_Probe
	
	{% if leave_probe_attached %}
	_Probe_Lock
	{% endif %}
	{% elif dock_on_zhome == True %}
	Dock_Probe
	{% endif %}
	
	_Home_Z
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe no longer required, docking probe"
	Dock_Probe
	{% elif dock_on_zhome == False %}
	Dock_Probe
	{% endif %}
	{% endif %}
	_CheckProbe action=query
	
	
	_Park_Toolhead
	
	_exit_point function=homing_override
	_KLICKY_STATUS_READY

[gcode_macro _Umbilical_Path]
gcode = 
	{% set umbilical = printer["gcode_macro _User_Variables"].umbilical %}
	{% set umbilical_x = printer["gcode_macro _User_Variables"].umbilical_x %}
	{% set umbilical_y = printer["gcode_macro _User_Variables"].umbilical_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	
	{% if umbilical %}
	
	_entry_point function=Umbilical_Path
	
	_KlickyDebug msg="_Umbilical_Path moving to G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}"
	G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}
	
	_exit_point function=Umbilical_Path
	{% endif %}

[gcode_macro _Home_Z]
gcode = 
	{% set z_endstop_x = printer["gcode_macro _Probe_Variables"].z_endstop_x %}
	{% set z_endstop_y = printer["gcode_macro _Probe_Variables"].z_endstop_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}    {% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Home_Z
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% else %}
	_KlickyDebug msg="_Home_Z XY Axis homed"
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="_Home_Z Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	
	
	_KlickyDebug msg="_Home_Z moving to Z endstop position G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}"
	G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}
	_KlickyDebug msg="_Home_Z Homing Z G28 Z"
	G28 Z0
	_KlickyDebug msg="_Home_Z toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_exit_point function=Home_Z

[gcode_macro _CheckProbe]
variable_probe_state = 0
gcode = 
	Query_Probe
	_SetProbeState action={ params.ACTION }

[gcode_macro _SetProbeState]
gcode = 
	{% set query_probe_triggered = printer.probe.last_query %}
	{% set action  = params.ACTION|default('') %}
	
	
	{% if query_probe_triggered %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ False }
	{% else %}
	
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ True }
	{% endif %}
	
	{% if action == 'query' %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_state VALUE={ query_probe_triggered }
	{% endif %}
	
	
	
	
	{% if not query_probe_triggered and action == 'dock' %}
	{ action_raise_error("Probe dock failed!") }
	{% endif %}
	
	
	{% if query_probe_triggered and action == 'attach' %}
	{ action_raise_error("Probe attach failed!") }
	{% endif %}

[gcode_macro _Park_Toolhead]
gcode = 
	{% set park_toolhead = printer["gcode_macro _User_Variables"].park_toolhead %}
	{% set parkposition_x = printer["gcode_macro _User_Variables"].parkposition_x %}
	{% set parkposition_y = printer["gcode_macro _User_Variables"].parkposition_y %}
	{% set parkposition_z = printer["gcode_macro _User_Variables"].parkposition_z %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Park_Toolhead
	
	{% if park_toolhead and 'xyz' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Parking Toolhead") }
	{% endif %}
	{% if parkposition_z == -128 %}
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}
	
	{% else %}
	
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}
	
	{% endif %}
	
	{% endif %}
	_exit_point function=Park_Toolhead

[gcode_macro _klicky_status_ready]
gcode = 
	{% if printer['gcode_macro status_ready'] is defined %}
	_KlickyDebug msg="_klicky_status_ready activating the LED STATUS_READY"
	STATUS_READY
	{% endif %}

[gcode_macro _klicky_status_busy]
gcode = 
	{% if printer['gcode_macro status_busy'] is defined %}
	_KlickyDebug msg="_klicky_status_busy activating the LED STATUS_BUSY"
	STATUS_BUSY
	{% endif %}

[gcode_macro _klicky_status_leveling]
gcode = 
	{% if printer['gcode_macro status_leveling'] is defined %}
	_KlickyDebug msg="_klicky_status_leveling activating the LED STATUS_LEVELING"
	STATUS_LEVELING
	{% endif %}

[gcode_macro _klicky_status_homing]
gcode = 
	{% if printer['gcode_macro status_homing'] is defined %}
	_KlickyDebug msg="_klicky_status_homing activating the LED STATUS_HOMING"
	STATUS_HOMING
	{% endif %}

[gcode_macro _klicky_status_cleaning]
gcode = 
	{% if printer['gcode_macro status_cleaning'] is defined %}
	_KlickyDebug msg="_klicky_status_cleaning activating the LED STATUS_CLEANING"
	STATUS_CLEANING
	{% endif %}

[gcode_macro _klicky_status_meshing]
gcode = 
	{% if printer['gcode_macro status_meshing'] is defined %}
	_KlickyDebug msg="_klicky_status_meshing activating the LED STATUS_MESHING"
	STATUS_MESHING
	{% endif %}

[gcode_macro _klicky_status_calibrating_z]
gcode = 
	{% if printer['gcode_macro status_calibrating_z'] is defined %}
	_KlickyDebug msg="_klicky_status_calibrating_z activating the LED STATUS_CALIBRATING_Z"
	STATUS_CALIBRATING_Z
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = _Z_TILT_ADJUST
description = 
gcode = 
	{% set V = printer["gcode_macro _User_Variables"].verbose %}
	{% if V %}
	{ action_respond_info("Z Tilt Adjust") }
	{% endif %}
	
	_CheckProbe action=query
	G90
	Attach_Probe
	_KLICKY_STATUS_LEVELING
	
	_Z_TILT_ADJUST {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	Dock_Probe
	G28 Z0

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
variable_led_enable = False
variable_status_macro = 'status_meshing'
variable_fuzz_enable = False
variable_fuzz_min = 0
variable_fuzz_max = 4
variable_margin_enable = False
variable_margin_size = 5
variable_probe_dock_enable = True
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_display_parameters = True
gcode = 
	
	{% if display_parameters == True %}
	{ action_respond_info("led_enable  : %d" % (led_enable))  }
	{ action_respond_info("status_macro: \'%s\'" % (status_macro))  }
	{ action_respond_info("fuzz_enable : %d" % (fuzz_enable))  }
	{ action_respond_info("fuzz_min    : %f" % (fuzz_min))  }
	{ action_respond_info("fuzz_max    : %f" % (fuzz_max))  }
	{ action_respond_info("probe_dock_enable: %d" % (probe_dock_enable))  }
	{ action_respond_info("attach_macro: \'%s\'" % (attach_macro))  }
	{ action_respond_info("detach_macro: \'%s\'" % (detach_macro))  }
	{% endif %}
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% if margin_enable == False %}
	{% set margin_size = 0 %}
	{% endif %}
	
	{ action_respond_info("{} object points, clamping to bed mesh [{!r} {!r}]".format(
	all_points | count,
	bed_mesh_min,
	bed_mesh_max,
	)) }
	
	{% if fuzz_enable == True %}
	{% set fuzz_range = range((fuzz_min * 100) | int, (fuzz_max * 100) | int + 1) %}
	{% set x_min = (bed_mesh_min[0] + fuzz_max - margin_size, x_min) | max - (fuzz_range | random / 100.0) %}
	{% set y_min = (bed_mesh_min[1] + fuzz_max - margin_size, y_min) | max - (fuzz_range | random / 100.0) %}
	{% set x_max = (bed_mesh_max[0] - fuzz_max + margin_size, x_max) | min + (fuzz_range | random / 100.0) %}
	{% set y_max = (bed_mesh_max[1] - fuzz_max + margin_size, y_max) | min + (fuzz_range | random / 100.0) %}
	{% else %}
	{% set x_min = [ bed_mesh_min[0], x_min - margin_size ] | max %}
	{% set y_min = [ bed_mesh_min[1], y_min - margin_size ] | max %}
	{% set x_max = [ bed_mesh_max[0], x_max + margin_size ] | min %}
	{% set y_max = [ bed_mesh_max[1], y_max + margin_size ] | min %}
	{% endif %}
	
	{ action_respond_info("Object bounds, clamped to the bed_mesh: {!r}, {!r}".format(
	(x_min, y_min),
	(x_max, y_max),
	)) }
	
	{% set points_x = (((x_max - x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((y_max - y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	{ action_respond_info( "Algorithm: {}".format(algorithm)) }
	
	{% set points_x = [points_x, min_points]|max  %}
	{% set points_y = [points_y, min_points]|max  %}
	{ action_respond_info( "Points: x: {}, y: {}".format(points_x, points_y) ) }
	
	{% if printer.configfile.settings.bed_mesh.relative_reference_index is defined %}
	{% set ref_index = (points_x * points_y / 2) | int %}
	{ action_respond_info( "Reference index: {}".format(ref_index) ) }
	{% else %}
	{% set ref_index = -1 %}
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	{% if led_enable == True %}
	{status_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={x_min},{y_min} mesh_max={x_max},{y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y} RELATIVE_REFERENCE_INDEX={ref_index}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SETUP_KAMP_MESHING]
gcode = 
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=display_parameters   VALUE={params.DISPLAY_PARAMETERS|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=led_enable   VALUE={params.LED_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=status_macro VALUE='"{params.STATUS_MACRO|default('status_meshing')|string}"'
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_enable VALUE={params.FUZZ_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_min    VALUE={params.FUZZ_MIN|default(0)|float}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_max    VALUE={params.FUZZ_MAX|default(4)|float}
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=probe_dock_enable VALUE={params.PROBE_DOCK_ENABLE|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=attach_macro VALUE='"{params.ATTACH_MACRO|default('Attach_Probe')|string}"'
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=detach_macro VALUE='"{params.DETACH_MACRO|default('Dock_Probe')|string}"'

[gcode_macro G29]
gcode = 
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro park_hotend]
gcode = 
	G1 X40
	M400
	G1 Y181
	M400

[gcode_macro LON]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro PRINTING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro LOFF]
gcode = 
	SET_LED LED=hotend RED=0 GREEN=0 BLUE=0

[gcode_macro HEATING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0.0314 BLUE=0 SYNC=0 TRANSMIT=1

[gcode_macro DONE]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0 BLUE=0.8157 SYNC=0 TRANSMIT=1

[gcode_macro PID_HOTEND]
gcode = 
	{% set EXTRUDER_TEMP = params.TEMPERATURE|default(245)|float %}
	PID_CALIBRATE HEATER=extruder TARGET={EXTRUDER_TEMP}

[gcode_macro PID_BED]
gcode = 
	{% set BED_TEMP = params.TEMPERATURE|default(110)|float %}
	PID_CALIBRATE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro SLOW]
gcode = 
	M220 S50
	SET_VELOCITY_LIMIT ACCEL=3000

[gcode_macro FAST]
gcode = 
	M220 S100
	SET_VELOCITY_LIMIT ACCEL=7500

[gcode_macro START_PRINT]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(190)|float %}
	{% set CHAMBER_TEMP = params.CHAMBER_TEMP|default(32)|float %}
	
	SETUP_KAMP_MESHING DISPLAY_PARAMETERS=1 PROBE_DOCK_ENABLE=1
	HEATING
	
	M117 Setting heater temps
	G90
	M140 S{BED_TEMP}
	M104 S0
	M400
	
	M117 Homing all axis
	G28
	
	{% if printer["temperature_sensor Chamber"].temperature < CHAMBER_TEMP %}
	M106 S255
	G0 X90 Y90 Z15
	M117 Waiting for Chamber to reach {CHAMBER_TEMP}
	TEMPERATURE_WAIT SENSOR="temperature_sensor Chamber" MINIMUM={CHAMBER_TEMP}
	M107
	M400
	{% endif %}
	
	M117 Waiting for bed, setting ext temp
	M190 S{BED_TEMP}
	M104 S{EXTRUDER_TEMP}
	M400
	
	M117 Z Tilt Adjust
	Z_TILT_ADJUST
	M400
	
	M117 Hot probe
	G29
	
	M117 Heating HotEnd
	Go_To_Purge_Location
	M400
	
	M117 Moving Z to top
	G0 Z1
	M400
	
	M117 Cleaning nozzle
	Purge
	M400
	
	M400
	M117 Print Started
	PRINTING

[gcode_macro END_PRINT]
gcode = 
	G91
	G1 Z5
	
	M400
	
	M83
	G1 E-10 F300
	
	M104 S0
	M140 S0
	M106 S0
	
	G90
	G1 X40 Y181 F10000
	
	M400
	
	M18 Y X E
	DONE

[gcode_macro BUZZ]
gcode = 
	{% set MOTOR = params.STEPPER|default(stepper_x)|string %}
	{% if MOTOR == 'x' %}
	{% set MOTOR = 'stepper_x' %}
	{% endif %}
	{% if MOTOR == 'x1' %}
	{% set MOTOR = 'stepper_x1' %}
	{% endif %}
	{% if MOTOR == 'y' %}
	{% set MOTOR = 'stepper_y' %}
	{% endif %}
	{% if MOTOR == 'y1' %}
	{% set MOTOR = 'stepper_y1' %}
	{% endif %}
	{% if MOTOR == 'z' %}
	{% set MOTOR = 'stepper_z' %}
	{% endif %}
	{% if MOTOR == 'z1' %}
	{% set MOTOR = 'stepper_z1' %}
	{% endif %}
	{% if MOTOR == 'z2' %}
	{% set MOTOR = 'stepper_z2' %}
	{% endif %}
	STEPPER_BUZZ stepper={MOTOR}

[gcode_macro PA]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[virtual_sdcard]
path = ~/gcode_files

[heater_fan hotend_fan]
pin = PA8
shutdown_speed = 0
fan_speed = 1
kick_start_time = 0.25
heater_temp = 50

[temperature_sensor Chamber]
sensor_pin = PF5
sensor_type = Generic 3950

[multi_pin cooling_fan_pins]
pins = PE5,PD12

[fan]
kick_start_time = 0.25
pin = multi_pin:cooling_fan_pins

[controller_fan case_fans]
kick_start_time = 1
fan_speed = 1
idle_timeout = 120
pin = PD13
heater = extruder
stepper = stepper_x

[controller_fan nevermore]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD14
heater = extruder
stepper = stepper_x

[controller_fan milkbox]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD15
heater = extruder
stepper = stepper_x

[printer]
kinematics = cartesian
max_velocity = 500
max_accel = 5000
max_z_velocity = 15
max_z_accel = 100
square_corner_velocity = 5

[exclude_object]

[gcode_arcs]
resolution = 0.1

[idle_timeout]
timeout = 1200

[mcu]
serial = /dev/ttyAMA0
restart_method = command

[extruder]
enable_pin = !PE0
step_pin = PE6
dir_pin = PA14
heater_pin = PA2
sensor_pin = PF4
microsteps = 16
rotation_distance = 22.71546
gear_ratio = 5:1
max_extrude_only_distance = 200
full_steps_per_rotation = 200
nozzle_diameter = 0.400
filament_diameter = 1.750
sensor_type = ATC Semitec 104NT-4-R025H42G
control = pid
pid_kp = 21.774
pid_ki = 1.837
pid_kd = 64.505
min_temp = -200
max_temp = 280
min_extrude_temp = 0

[tmc2208 extruder]
uart_pin = PD3
run_current = 0.25
sense_resistor = 0.110
hold_current = 0.1
driver_pwm_grad = 8
stealthchop_threshold = 5000

[neopixel front_strip]
pin = PB0
color_order = GRB
chain_count = 6
initial_red = 1
initial_green = 1
initial_blue = 0.7
=======================
Extruder max_extrude_ratio=0.266081
mcu 'mcu': Starting serial connect
webhooks client 4106137856: New connection
webhooks client 4106137856: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
Loaded MCU 'mcu' 119 commands (v0.11.0-240-g6d48adf9 / gcc: (15:8-2019-q3-1+b1) 8.3.1 20190703 (release) [gcc-8-branch revision 273027] binutils: (2.34-4+rpi1+14) 2.34)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_i2c1a=PB8,PB9 BUS_PINS_i2c2=PB10,PB11 BUS_PINS_i2c3=PA8,PC9 BUS_PINS_sdio=PC12,PD2,PC8,PC9,PC10,PC11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 CLOCK_FREQ=180000000 MCU=stm32f446xx PWM_MAX=255 RECEIVE_WINDOW=192 RESERVE_PINS_crystal=PH0,PH1 RESERVE_PINS_serial=PA10,PA9 SERIAL_BAUD=250000 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (35.0, 8.9)     | (10.0, 7.0)
  1   | (71.2, 8.9)     | (46.2, 7.0)
  2   | (107.5, 8.9)    | (82.5, 7.0)
  3   | (143.8, 8.9)    | (118.8, 7.0)
  4   | (180.0, 8.9)    | (155.0, 7.0)
  5   | (180.0, 48.4)   | (155.0, 46.5)
  6   | (143.8, 48.4)   | (118.8, 46.5)
  7   | (107.5, 48.4)   | (82.5, 46.5)
  8   | (71.2, 48.4)    | (46.2, 46.5)
  9   | (35.0, 48.4)    | (10.0, 46.5)
  10  | (35.0, 87.9)    | (10.0, 86.0)
  11  | (71.2, 87.9)    | (46.2, 86.0)
  12  | (107.5, 87.9)   | (82.5, 86.0)
  13  | (143.8, 87.9)   | (118.8, 86.0)
  14  | (180.0, 87.9)   | (155.0, 86.0)
  15  | (180.0, 127.4)  | (155.0, 125.5)
  16  | (143.8, 127.4)  | (118.8, 125.5)
  17  | (107.5, 127.4)  | (82.5, 125.5)
  18  | (71.2, 127.4)   | (46.2, 125.5)
  19  | (35.0, 127.4)   | (10.0, 125.5)
  20  | (35.0, 166.9)   | (10.0, 165.0)
  21  | (71.2, 166.9)   | (46.2, 165.0)
  22  | (107.5, 166.9)  | (82.5, 165.0)
  23  | (143.8, 166.9)  | (118.8, 165.0)
  24  | (180.0, 166.9)  | (155.0, 165.0)
bed_mesh: relative_reference_index 12 is (82.50, 86.00)
Starting heater checks for extruder
Stats 7201.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3494 bytes_read=6944 bytes_retransmit=9 bytes_invalid=0 send_seq=264 receive_seq=264 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179994927 heater_bed: target=0 temp=0.0 pwm=0.000  Chamber: temp=0.0 sysload=0.35 cputime=64.239 memavail=1673092 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 4106137856
webhooks: registering remote method 'reboot_machine' for connection id: 4106137856
webhooks: registering remote method 'pause_job_queue' for connection id: 4106137856
webhooks: registering remote method 'start_job_queue' for connection id: 4106137856
Stats 7202.7: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=3500 bytes_read=7029 bytes_retransmit=9 bytes_invalid=0 send_seq=265 receive_seq=265 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=179999103 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.35 cputime=64.303 memavail=1668620 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7203.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000013 bytes_write=3506 bytes_read=7209 bytes_retransmit=9 bytes_invalid=0 send_seq=266 receive_seq=266 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000075 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.35 cputime=64.361 memavail=1669660 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7204.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000013 bytes_write=3512 bytes_read=7360 bytes_retransmit=9 bytes_invalid=0 send_seq=267 receive_seq=267 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000069 heater_bed: target=0 temp=18.5 pwm=0.000  Chamber: temp=18.9 sysload=0.35 cputime=64.384 memavail=1669724 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7205.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000013 bytes_write=3518 bytes_read=7541 bytes_retransmit=9 bytes_invalid=0 send_seq=268 receive_seq=268 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000058 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.35 cputime=64.406 memavail=1671424 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7206.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000013 bytes_write=3524 bytes_read=7707 bytes_retransmit=9 bytes_invalid=0 send_seq=269 receive_seq=269 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000123 heater_bed: target=0 temp=18.5 pwm=0.000  Chamber: temp=18.8 sysload=0.40 cputime=64.429 memavail=1671516 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7207.7: gcodein=0  mcu: mcu_awake=0.005 mcu_task_avg=0.000011 mcu_task_stddev=0.000013 bytes_write=3530 bytes_read=7858 bytes_retransmit=9 bytes_invalid=0 send_seq=270 receive_seq=270 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000139 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.40 cputime=64.453 memavail=1671280 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7208.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3536 bytes_read=8053 bytes_retransmit=9 bytes_invalid=0 send_seq=271 receive_seq=271 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000152 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.40 cputime=64.476 memavail=1671280 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7209.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3542 bytes_read=8219 bytes_retransmit=9 bytes_invalid=0 send_seq=272 receive_seq=272 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000199 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.40 cputime=64.499 memavail=1671280 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7210.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3548 bytes_read=8370 bytes_retransmit=9 bytes_invalid=0 send_seq=273 receive_seq=273 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000191 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.40 cputime=64.521 memavail=1671280 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7211.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3554 bytes_read=8551 bytes_retransmit=9 bytes_invalid=0 send_seq=274 receive_seq=274 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000158 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.9 sysload=0.37 cputime=64.544 memavail=1671292 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7212.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3560 bytes_read=8717 bytes_retransmit=9 bytes_invalid=0 send_seq=275 receive_seq=275 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000147 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.37 cputime=64.567 memavail=1671292 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7213.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3566 bytes_read=8882 bytes_retransmit=9 bytes_invalid=0 send_seq=276 receive_seq=276 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000150 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.37 cputime=64.590 memavail=1671292 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7214.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3572 bytes_read=9063 bytes_retransmit=9 bytes_invalid=0 send_seq=277 receive_seq=277 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000138 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.37 cputime=64.613 memavail=1671292 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7215.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3578 bytes_read=9229 bytes_retransmit=9 bytes_invalid=0 send_seq=278 receive_seq=278 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000136 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.37 cputime=64.635 memavail=1671292 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7216.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3590 bytes_read=9396 bytes_retransmit=9 bytes_invalid=0 send_seq=280 receive_seq=280 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000136 heater_bed: target=0 temp=18.3 pwm=0.000  Chamber: temp=18.9 sysload=0.34 cputime=64.658 memavail=1672028 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7217.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000004 bytes_write=3596 bytes_read=9577 bytes_retransmit=9 bytes_invalid=0 send_seq=281 receive_seq=281 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000129 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.34 cputime=64.681 memavail=1672056 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7218.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3602 bytes_read=9757 bytes_retransmit=9 bytes_invalid=0 send_seq=282 receive_seq=282 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000135 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.34 cputime=64.704 memavail=1672056 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7219.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3608 bytes_read=9908 bytes_retransmit=9 bytes_invalid=0 send_seq=283 receive_seq=283 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000136 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.34 cputime=64.726 memavail=1672056 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7220.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3614 bytes_read=10089 bytes_retransmit=9 bytes_invalid=0 send_seq=284 receive_seq=284 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000135 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.34 cputime=64.749 memavail=1672056 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7221.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3620 bytes_read=10255 bytes_retransmit=9 bytes_invalid=0 send_seq=285 receive_seq=285 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000142 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.39 cputime=64.772 memavail=1672056 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7222.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3626 bytes_read=10406 bytes_retransmit=9 bytes_invalid=0 send_seq=286 receive_seq=286 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000137 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.39 cputime=64.794 memavail=1672056 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7223.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3632 bytes_read=10601 bytes_retransmit=9 bytes_invalid=0 send_seq=287 receive_seq=287 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000137 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.39 cputime=64.818 memavail=1672056 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7224.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3638 bytes_read=10767 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000134 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.39 cputime=64.840 memavail=1672060 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7225.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3644 bytes_read=10911 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000131 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.39 cputime=64.862 memavail=1672060 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7226.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3650 bytes_read=11082 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000128 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.36 cputime=64.885 memavail=1671556 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7227.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3656 bytes_read=11248 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000127 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.36 cputime=64.908 memavail=1671572 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7228.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3662 bytes_read=11413 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000126 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.36 cputime=64.930 memavail=1671572 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7229.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3668 bytes_read=11594 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000124 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.36 cputime=64.954 memavail=1671572 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7230.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3674 bytes_read=11760 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000124 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.36 cputime=64.976 memavail=1671572 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7231.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3680 bytes_read=11926 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000123 heater_bed: target=0 temp=18.5 pwm=0.000  Chamber: temp=18.9 sysload=0.33 cputime=64.999 memavail=1671580 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7232.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=3686 bytes_read=12092 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000123 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.33 cputime=65.021 memavail=1671580 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7233.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3692 bytes_read=12272 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000124 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.33 cputime=65.044 memavail=1671580 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7234.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3698 bytes_read=12438 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000123 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.33 cputime=65.066 memavail=1671580 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 7235.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3704 bytes_read=12604 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000126 heater_bed: target=0 temp=18.5 pwm=0.000  Chamber: temp=18.9 sysload=0.33 cputime=65.089 memavail=1671580 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7236.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3710 bytes_read=12770 bytes_retransmit=9 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000124 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.8 sysload=0.30 cputime=65.112 memavail=1671780 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7237.7: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000007 mcu_task_stddev=0.000005 bytes_write=3716 bytes_read=12936 bytes_retransmit=9 bytes_invalid=0 send_seq=301 receive_seq=301 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000123 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=18.9 sysload=0.30 cputime=65.135 memavail=1671848 print_time=0.001 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 7345.8: gcodein=0  mcu: mcu_awake=0.001 mcu_task_avg=0.000006 mcu_task_stddev=0.000004 bytes_write=4376 bytes_read=31139 bytes_retransmit=9 bytes_invalid=0 send_seq=411 receive_seq=411 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=180000119 heater_bed: target=0 temp=18.4 pwm=0.000  Chamber: temp=19.0 sysload=0.19 cputime=67.459 memavail=1671984 print_time=167.827 buffer_time=0.057 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Attempting MCU 'mcu' reset command
webhooks client 4106137856: Disconnected
Restarting printer
Start printer at Fri Jul  7 19:19:47 2023 (1688750387.6 7347.0)
===== Config file =====
[pause_resume]

[display_status]

[gcode_macro CANCEL_PRINT]
rename_existing = BASE_CANCEL_PRINT
gcode = 
	END_PRINT

[gcode_macro PAUSE]
rename_existing = BASE_PAUSE
variable_extrude = 1.0
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	G91
	G1 E-{E} F2100
	G1 Z{z_safe} F900
	G90
	G1 X{x_park} Y{y_park} F6000

[gcode_macro RESUME]
rename_existing = BASE_RESUME
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{E} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME
	wipe_nozzle

[probe]
pin = PG13
x_offset = -25.0
y_offset = -1.88
z_offset = 9.075

[heater_bed]
heater_pin = PA3
sensor_pin = PF3
sensor_type = Generic 3950
smooth_time = 3.0
max_power = 0.60
control = pid
pid_kp = 31.649
pid_ki = 1.901
pid_kd = 131.740
min_temp = -200
max_temp = 130

[bed_mesh]
speed = 200
horizontal_move_z = 10
mesh_min = 10, 7
mesh_max = 155, 165
probe_count = 5,5
fade_start = 0.5
fade_end = 2
split_delta_z = .025
move_check_distance = 5.0
mesh_pps = 2,2
algorithm = bicubic
bicubic_tension = 0.1
relative_reference_index = 12

[z_tilt]
z_positions = 
	-74.0, -18.0
	76.0,  217.0
	226.0, -18.0
points = 
	45, 25
	101, 160
	175, 25
speed = 200
horizontal_move_z = 20.0
retries = 4
retry_tolerance = 0.05

[stepper_z]
enable_pin = !PG2
step_pin = !PF9
dir_pin = !PF10
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200
endstop_pin = probe:z_virtual_endstop
position_max = 180
position_min = -5
homing_speed = 15.0
second_homing_speed = 5.0
homing_retract_dist = 10.0
homing_positive_dir = false

[tmc2208 stepper_z]
uart_pin = PF2
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z1]
enable_pin = !PF1
step_pin = !PC13
dir_pin = !PF0
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z1]
uart_pin = PE4
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_z2]
enable_pin = !PD4
step_pin = !PE2
dir_pin = PE3
rotation_distance = 40
gear_ratio = 5:1
microsteps = 16
full_steps_per_rotation = 200

[tmc2208 stepper_z2]
uart_pin = PE1
run_current = 0.650
hold_current = 0.650
stealthchop_threshold = 999999

[stepper_x]
enable_pin = !PA0
step_pin = PG4
dir_pin = !PC1
endstop_pin = tmc2209_stepper_x:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -8
position_endstop = 180
position_max = 180
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0
homing_positive_dir = true

[tmc2209 stepper_x]
diag_pin = PG11
uart_pin = PC7
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_x1]
enable_pin = !PF15
step_pin = PG0
dir_pin = PG1
endstop_pin = tmc2209_stepper_x1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_x1]
diag_pin = PG9
uart_pin = PD11
interpolate = false
run_current = 0.85
sense_resistor = 0.110
driver_sgthrs = 125
stealthchop_threshold = 999999

[stepper_y]
enable_pin = !PG5
step_pin = PF11
dir_pin = PG3
endstop_pin = tmc2209_stepper_y:virtual_endstop
microsteps = 16
rotation_distance = 40
position_min = -5
position_endstop = -2
position_max = 184
full_steps_per_rotation = 400
homing_speed = 75.0
homing_retract_dist = 0

[tmc2209 stepper_y]
diag_pin = PG10
uart_pin = PC6
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[stepper_y1]
enable_pin = !PF14
step_pin = PF13
dir_pin = !PF12
endstop_pin = tmc2209_stepper_y1:virtual_endstop
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 400

[tmc2209 stepper_y1]
diag_pin = PG6
uart_pin = PC4
interpolate = false
run_current = 0.85
sense_resistor = 0.110
stealthchop_threshold = 999999
driver_sgthrs = 125

[gcode_macro nozzle_clean]
gcode = 
	SAVE_GCODE_STATE NAME=clean_nozzle_state
	Wipe_Nozzle
	RESTORE_GCODE_STATE NAME=clean_nozzle_state MOVE=1

[gcode_macro Nozzle_Wiper_Variables]
variable_purge_x = -8
variable_purge_y = 110
variable_purge_x_entry = 0
variable_purge_y_entry = 110
variable_wipe_dx = 0
variable_wipe_dy = 16
variable_wipe_count = 4
variable_travel_speed = 300
variable_entry_speed = 100
variable_wipe_speed = 50
variable_purge_speed = 4
variable_purge_fan = 255
variable_wipe_fan = 128
gcode = 

[gcode_macro Go_To_Purge_Location]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set St = printer["gcode_macro Nozzle_Wiper_Variables"].travel_speed * 60 %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	
	{% if not (printer.toolhead.position.x == Px and printer.toolhead.position.y == Py) %}
	G1 X{Pxe} Y{Pye} F{St}
	G1 X{Px} Y{Py} F{Se}
	{% endif %}

[gcode_macro Wipe_Nozzle]
gcode = 
	{% set Px = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x|float %}
	{% set Py = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y|float %}
	{% set Pxe = printer["gcode_macro Nozzle_Wiper_Variables"].purge_x_entry|float %}
	{% set Pye = printer["gcode_macro Nozzle_Wiper_Variables"].purge_y_entry|float %}
	{% set Wdx = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dx|float %}
	{% set Wdy = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_dy|float %}
	{% set Wc = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_count|int %}
	{% set Se = printer["gcode_macro Nozzle_Wiper_Variables"].entry_speed * 60 %}
	{% set Sw = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].wipe_fan %}
	{% set old_Sf = params.OLD_FAN_SPEED|default(printer.fan.speed)|int %}
	
	{% if printer.fan.speed < Sf %}
	{% set wait_for_fan = True %}
	{% else %}
	{% set wait_for_fan = False %}
	{% endif %}
	
	
	Go_To_Purge_Location
	
	
	M106 S{Sf}
	
	
	{% if wait_for_fan %}
	G4 P800
	{% endif %}
	
	
	G1 X{Px + Wdx} Y{Py + Wdy} F12000
	{% for i in range(Wc) %}
	G1 X{Px} Y{Py} F{Sw}
	G1 X{Px + Wdx} Y{Py + Wdy} F{Sw}
	{% endfor %}
	
	
	G1 X{Pxe + Wdx} Y{Pye + Wdy} F{Se}
	
	
	M106 S{old_Sf}

[gcode_macro Purge]
gcode = 
	{% set TEMPERATURE = params.DEFAULT_TEMPERATURE|default(230)|float %}
	{% set EXACT_TEMP = params.EXACT_EXTRUDER_TEMP|default(0)|int %}
	{% set FEED_AMOUNT = params.DEFAULT_FEED_AMOUNT|default(50)|int %}
	{% set Sp = printer["gcode_macro Nozzle_Wiper_Variables"].purge_speed * 60 %}
	{% set Sf = printer["gcode_macro Nozzle_Wiper_Variables"].purge_fan %}
	{% set old_Sf = printer.fan.speed %}
	
	
	Go_To_Purge_Location
	
	
	{% if EXACT_TEMP|int == 1 and printer.extruder.temperature < TEMPERATURE %}
	M109 S{TEMPERATURE}
	{% endif %}
	
	
	M106 S{Sf}
	
	
	M83
	G1 E{FEED_AMOUNT|float - 3} F{Sp}
	G1 E5 F{Sp}
	G92 E0.0
	
	
	G4 P800
	
	
	Wipe_Nozzle OLD_FAN_SPEED={old_Sf}

[board_pins]
aliases = 
	
	EXP1_1=PE8, EXP1_2=PE7,
	EXP1_3=PE9, EXP1_4=PE10,
	EXP1_5=PE12, EXP1_6=PE13,
	EXP1_7=PE14, EXP1_8=PE15,
	EXP1_9=<GND>, EXP1_10=<5V>,
	
	
	EXP2_1=PA6, EXP2_2=PA5,
	EXP2_3=PB1, EXP2_4=PA4,
	EXP2_5=PB2, EXP2_6=PA7,
	EXP2_7=PC15, EXP2_8=<RST>,
	EXP2_9=<GND>, EXP2_10=<5V>

[gcode_macro _User_Variables]
variable_verbose = True
variable_debug = False
variable_travel_speed = 200
variable_move_accel = 1000
variable_dock_speed = 50
variable_release_speed = 75
variable_z_drop_speed = 20
variable_safe_z = 15
variable_enable_z_hop = True
variable_max_bed_y = 182
variable_max_bed_x = 182
variable_z_endstop_x = 0
variable_z_endstop_y = 0
variable_docklocation_x = -8
variable_docklocation_y = 181
variable_docklocation_z = -128
variable_enable_dock_servo = False
variable_servo_name = 'NAME'
variable_servo_deploy = 10
variable_servo_retract = 11
variable_servo_delay = 250
variable_dockmove_x = 0
variable_dockmove_y = -50
variable_dockmove_z = 0
variable_attachmove_x = -50
variable_attachmove_y = 0
variable_attachmove_z = 0
variable_umbilical = False
variable_umbilical_x = 40
variable_umbilical_y = 40
variable_park_toolhead = True
variable_parkposition_x = 40
variable_parkposition_y = 181
variable_parkposition_z = 10
variable_version = 1
variable_attachmove2_x = 0
variable_attachmove2_y = 0
variable_attachmove2_z = 0
variable_home_backoff_x = 10
variable_home_backoff_y = 10
variable_override_homing = 'X'
variable_dock_on_zhome = False
variable_bypass_probe_docking = False
gcode = 
	{% set Mx = printer['configfile'].config["stepper_x"]["position_max"]|float %}
	{% set My = printer['configfile'].config["stepper_y"]["position_max"]|float %}
	{% set Ox = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set Oy = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set Oz = printer['configfile'].config["probe"]["z_offset"]|float %}
	
	
	{% if z_endstop_x != 0 or z_endstop_y != 0 %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ z_endstop_x }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ z_endstop_y }
	
	
	{% else %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_x VALUE={ (Mx * 0.5) - Ox }
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=z_endstop_y VALUE={ (My * 0.5) - Oy }
	{% endif %}

[respond]

[gcode_macro _Probe_Variables]
variable_probe_attached = False
variable_probe_state = False
variable_probe_lock = False
variable_z_endstop_x = 0
variable_z_endstop_y = 0
gcode = 

[gcode_macro _klicky_check_variables_version]
gcode = 
	{% set version = printer["gcode_macro _User_Variables"].version|default(0) %}
	
	{% if version != 1 %}
	{ action_raise_error("Please update your klicky variables, there are some functionality changes") }
	{% endif %}

[gcode_macro _KlickyDebug]
gcode = 
	{% set message  = params.MSG %}
	{% set debug = printer["gcode_macro _User_Variables"].debug|default(False) %}
	
	{% if debug %}
	{ action_respond_info(message) }
	{% endif %}

[gcode_macro _exit_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move  = params.MOVE|default(0) %}
	{% set speed = printer["gcode_macro _User_Variables"].travel_speed %}
	
	
	M400
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	RESTORE_GCODE_STATE NAME={function} MOVE={move} MOVE_SPEED={speed}

[gcode_macro _entry_point]
gcode = 
	{% set function  = 'pre_' ~ params.FUNCTION %}
	{% set move_accel = printer["gcode_macro _User_Variables"].move_accel|default(1000) %}
	
	M400
	SAVE_GCODE_STATE NAME={function}
	
	SET_GCODE_OFFSET Z=0
	
	G90
	
	SET_VELOCITY_LIMIT ACCEL={move_accel}

[gcode_macro _Homing_Variables]
gcode = 
	{% set reset  = params.RESET|default(0) %}
	{% if reset %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }
	{% endif %}

[gcode_macro Attach_Probe_Lock]
description = Attaches Klicky Probe, can only be docked after unlocking
gcode = 
	Attach_Probe
	_Probe_Lock

[gcode_macro Dock_Probe_Unlock]
description = Docks Klicky Probe even if it was locked
gcode = 
	_Probe_Unlock
	Dock_Probe

[gcode_macro _Probe_Unlock]
description = Unlocks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to False"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ False }

[gcode_macro _Probe_Lock]
description = Locks Klicky Probe state
gcode = 
	_KlickyDebug msg="_Probe_Lock setting probe_lock variable to True"
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_lock VALUE={ True }

[gcode_macro _DeployKlickyDock]
description = Deploys Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_deploy = printer["gcode_macro _User_Variables"].servo_deploy|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_DeployKlickyDock Klicky servo configuration enabled"
	{% if servo_deploy == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo deploy angle specified") }
	{% endif %}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_deploy|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_DeployKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _DeployDock"] is defined %}
	_KlickyDebug msg="_DeployKlickyDock calling _DeployDock"
	_DeployDock
	{% endif %}

[gcode_macro _RetractKlickyDock]
description = Retracts Klicky servo-controlled dock
gcode = 
	{% set enable_dock_servo = printer["gcode_macro _User_Variables"].enable_dock_servo|default(False) %}
	{% set servo_delay = printer["gcode_macro _User_Variables"].servo_delay|default(1000) %}
	{% set servo_name = printer["gcode_macro _User_Variables"].servo_name %}
	{% set servo_retract = printer["gcode_macro _User_Variables"].servo_retract|default(360) %}
	
	
	M400
	{% if enable_dock_servo != False %}
	_KlickyDebug msg="_RetractKlickyDock Klicky servo configuration enabled"
	{% if servo_retract == 360 %}
	{ action_raise_error("Klicky: servo active on klicky-variables, but no servo retract angle specified") }
	{% endif %}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}"
	SET_SERVO SERVO={servo_name|string} ANGLE={servo_retract|int}
	M400
	G4 P{servo_delay|int}
	_KlickyDebug msg="_RetractKlickyDock SET_SERVO SERVO={servo_name|string} WIDTH=0"
	SET_SERVO SERVO={servo_name|string} WIDTH=0
	{% elif printer["gcode_macro _RetractDock"] is defined %}
	_KlickyDebug msg="_RetractKlickyDock calling _RetractDock"
	_RetractDock
	{% endif %}

[gcode_macro Attach_Probe]
description = Attaches Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set attachmove2_x = printer["gcode_macro _User_Variables"].attachmove2_x|default(0) %}
	{% set attachmove2_y = printer["gcode_macro _User_Variables"].attachmove2_y|default(0) %}
	{% set attachmove2_z = printer["gcode_macro _User_Variables"].attachmove2_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	_entry_point function=Attach_Probe
	
	{% if bypass_probe_docking == False %}
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	_KlickyDebug msg="Attach_Probe Axis homed"
	
	
	{% elif not probe_attached and not probe_lock %}
	_KlickyDebug msg="Attach_Probe going to attach probe"
	{% if verbose %}
	{ action_respond_info("Attaching Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% if not enable_z_hop %}
	_KlickyDebug msg="Attach_Probe z_hop disabled"
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero, duplicate?") }
	{% endif %}
	_KlickyDebug msg="Attach_Probe Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Attach_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	_entry_point function=Attach_Probe_intern
	
	
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove_y|int - attachmove2_y} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int - attachmove2_z|int} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}"
	G0 X{docklocation_x|int - attachmove2_x|int} Y{docklocation_y|int - attachmove2_y} F{dock_feedrate}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{z_drop_feedrate}
	{% endif %}
	_KlickyDebug msg="Attach_Probe moving from the dock to G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Attach_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	_CheckProbe action=attach
	
	_exit_point function=Attach_Probe_intern move={goback}
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe locked not attaching probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already attached!") }
	{% endif %}
	
	
	_KlickyDebug msg="Attach_Probe probe already attached, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Attach_Probe
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro Dock_Probe]
description = Docks Klicky Probe
gcode = 
	
	{% set goback  = params.BACK|default(0) %}
	
	{% set probe_attached = printer["gcode_macro _Probe_Variables"].probe_attached %}
	{% set probe_lock = printer["gcode_macro _Probe_Variables"].probe_lock %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	{% set dockmove_x = printer["gcode_macro _User_Variables"].dockmove_x|default(0) %}
	{% set dockmove_y = printer["gcode_macro _User_Variables"].dockmove_y|default(0) %}
	{% set dockmove_z = printer["gcode_macro _User_Variables"].dockmove_z|default(0) %}
	{% set docklocation_x = printer["gcode_macro _User_Variables"].docklocation_x %}
	{% set docklocation_y = printer["gcode_macro _User_Variables"].docklocation_y %}
	{% set docklocation_z = printer["gcode_macro _User_Variables"].docklocation_z %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set dock_feedrate = printer["gcode_macro _User_Variables"].dock_speed * 60 %}
	{% set release_feedrate = printer["gcode_macro _User_Variables"].release_speed * 60 %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	{% if bypass_probe_docking == False %}
	{% else %}
	_KlickyDebug msg="Attach_Probe probe docking bypassed, doing nothing"
	{% endif %}
	
	
	{% if bypass_probe_docking == False %}
	_entry_point function=Dock_Probe
	
	
	{% if probe_attached and not probe_lock %}
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% endif %}
	_KlickyDebug msg="Dock_Probe Axis homed"
	_KlickyDebug msg="Dock_Probe going to dock probe"
	{% if verbose %}
	{ action_respond_info("Docking Probe") }
	{% endif %}
	_KLICKY_STATUS_BUSY
	
	{% if printer.toolhead.position.z < safe_z %}
	_KlickyDebug msg="Dock_Probe toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Umbilical_Path
	
	
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}"
	G0 X{docklocation_x|int - attachmove_x|int} Y{docklocation_y|int - attachmove_y|int} F{travel_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving near the dock with G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}"
	G0 Z{docklocation_z|int - attachmove_z|int} F{dock_feedrate}
	{% endif %}
	
	
	_DeployKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving to the dock with G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}"
	G0 X{docklocation_x} Y{docklocation_y} F{dock_feedrate}
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Attach_Probe moving to the dock with G0 Z{docklocation_z} F{dock_feedrate}"
	G0 Z{docklocation_z} F{dock_feedrate}
	{% endif %}
	
	
	{% if docklocation_z != -128 %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}"
	G0 Z{docklocation_z|int + dockmove_z|int} F{release_feedrate}
	{% endif %}
	_KlickyDebug msg="Dock_Probe moving from the dock to G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int} Y{docklocation_y|int + dockmove_y|int} F{release_feedrate}
	
	
	_RetractKlickyDock
	
	
	_KlickyDebug msg="Dock_Probe moving away from the dock to G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}"
	G0 X{docklocation_x|int + dockmove_x|int - attachmove_x|int} Y{docklocation_y|int + dockmove_y|int - attachmove_y|int} F{release_feedrate}
	
	
	{% if ((printer.toolhead.position.z < safe_z) or (docklocation_z != -128 and docklocation_z < safe_z ))%}
	_KlickyDebug msg="Dock_Probe moving to a safe Z position: G0 Z{safe_z} F{z_drop_feedrate} from {printer.toolhead.position.z}"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_Park_Toolhead
	
	G4 P1000
	_CheckProbe action=dock
	_KLICKY_STATUS_READY
	
	{% elif probe_lock %}
	{% if verbose %}
	{ action_respond_info("Probe locked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe locked not docking probe"
	_CheckProbe action=query
	
	{% else %}
	{% if verbose %}
	{ action_respond_info("Probe already docked") }
	{% endif %}
	
	
	_KlickyDebug msg="Dock_Probe probe already docked, doing nothing"
	_CheckProbe action=query
	
	{% endif %}
	
	_exit_point function=Dock_Probe move={goback}
	{% else %}
	_KlickyDebug msg="Dock_Probe probe docking bypassed, doing nothing"
	{% endif %}

[gcode_macro PROBE_CALIBRATE]
rename_existing = _PROBE_CALIBRATE
description = Calibrate the probes z_offset with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	{% set bypass_probe_docking = printer["gcode_macro _User_Variables"].bypass_probe_docking|default(False) %}
	
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_calibrate Axis homed"
	_KlickyDebug msg="probe_calibrate Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_CALIBRATE with the probe above the BED, check klicky_variables bed size!") }
	{% endif %}
	
	{% if bypass_probe_docking == False %}
	_CheckProbe action=query
	G90
	Attach_Probe back=1
	_KLICKY_STATUS_CALIBRATING_Z
	
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	M118 moving the toolhead 20 mm from the bed
	_KlickyDebug msg="probe_calibrate Moving Z up by 20mm"
	TESTZ Z=20
	M118 remove manually the probe and continue calibration
	_KLICKY_STATUS_READY
	{% else %}
	_KLICKY_STATUS_CALIBRATING_Z
	_KlickyDebug msg="probe_calibrate calling klipper probe_calibrate"
	_PROBE_CALIBRATE {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	_KLICKY_STATUS_READY
	{% endif %}

[gcode_macro PROBE_ACCURACY]
rename_existing = _PROBE_ACCURACY
description = Probe Z-height accuracy at current XY position with klicky automount
gcode = 
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set max_x = printer["gcode_macro _User_Variables"].max_bed_x|float %}
	{% set max_y = printer["gcode_macro _User_Variables"].max_bed_y|float %}
	{% set probe_offset_x = printer['configfile'].config["probe"]["x_offset"]|float %}
	{% set probe_offset_y = printer['configfile'].config["probe"]["y_offset"]|float %}
	
	{% if not 'xyz' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X, Y and Z Axis First!") }
	{% endif %}
	_KlickyDebug msg="probe_accuracy Axis homed"
	_KlickyDebug msg="probe_accuracy Variables max_x={max_x},max_y={max_y},probe_offset_x={probe_offset_x},probe_offset_y={probe_offset_y}"
	
	_entry_point function=PROBE_ACCURACY
	
	
	{% if printer['gcode_move'].position.y > (max_y - probe_offset_y)
	or printer['gcode_move'].position.y < - probe_offset_y
	or printer['gcode_move'].position.x > (max_x - probe_offset_x)
	or printer['gcode_move'].position.x < - probe_offset_x %}
	{ action_raise_error("Must perform PROBE_ACCURACY with the probe above the BED, check klicky_variables bed size!") }
	{% endif%}
	
	_CheckProbe action=query
	Attach_Probe back=1
	
	_KlickyDebug msg="probe_accuracy calling klipper probe accuracy"
	_PROBE_ACCURACY {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	
	Dock_Probe back=1
	
	_exit_point function=PROBE_ACCURACY move=1

[force_move]
enable_force_move = True

[homing_override]
axes = xyz
gcode = 
	
	_User_Variables
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z %}
	{% set enable_z_hop = printer["gcode_macro _User_Variables"].enable_z_hop %}
	{% set kinematic_z = 0 %}
	{% set dock_on_zhome = printer["gcode_macro _User_Variables"].dock_on_zhome|default(True) %}
	{% set attachmove_x = printer["gcode_macro _User_Variables"].attachmove_x|default(0) %}
	{% set attachmove_y = printer["gcode_macro _User_Variables"].attachmove_y|default(0) %}
	{% set attachmove_z = printer["gcode_macro _User_Variables"].attachmove_z|default(0) %}
	{% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set home_backoff_x = printer["gcode_macro _User_Variables"].home_backoff_x|default(0) %}
	{% set home_backoff_y = printer["gcode_macro _User_Variables"].home_backoff_y|default(0) %}
	{% set override_homing = printer["gcode_macro _User_Variables"].override_homing|default('') %}
	
	
	_klicky_check_variables_version
	
	_CheckProbe action=query
	
	
	{% set home_x, home_y, home_z, leave_probe_attached = False, False, False, False %}
	
	{% if 'PROBE_LOCK' in params%}
	{% if verbose %}
	{ action_respond_info("PROBE_LOCK = True") }
	{% endif %}
	{% set leave_probe_attached = True %}
	{% endif %}
	
	
	{% if not 'X' in params
	and not 'Y' in params
	and not 'Z' in params %}
	
	{% set home_x, home_y, home_z = True, True, True %}
	_KlickyDebug msg="homing_override goint to home all axes"
	
	{% else %}
	{% if 'X' in params %}
	{% set home_x = True %}
	_KlickyDebug msg="homing_override goint to home X"
	
	{% endif %}
	
	{% if 'Y' in params %}
	{% set home_y = True %}
	_KlickyDebug msg="homing_override goint to home Y"
	{% endif %}
	
	{% if 'Z' in params %}
	{% set home_z = True %}
	_KlickyDebug msg="homing_override goint to home Z"
	{% endif %}
	
	{% if 'X' in params
	and 'Y' in params
	and 'Z' in params %}
	
	
	_Homing_Variables reset=1
	_KlickyDebug msg="homing_override goint to home all axes"
	{% endif %}
	
	{% endif %}
	
	_entry_point function=homing_override
	_KLICKY_STATUS_HOMING
	
	
	{% if 'z' not in printer.toolhead.homed_axes %}
	{% if not enable_z_hop %}
	_KlickyDebug msg="homing_override z_hop disabled"
	
	{% set kinematic_z = safe_z %}
	{% set safe_z = 0 %}
	{% endif %}
	{% endif %}
	
	
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes and 'z' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("No axis homed") }
	{% endif %}
	_KlickyDebug msg="homing_override no axis homed, setting position as X=Y=0 Z={kinematic_z}"
	SET_KINEMATIC_POSITION X=0 Y=0 Z={kinematic_z}
	M400
	_KlickyDebug msg="homing_override moving toolhead to {safe_z}mm from {printer.toolhead.position.z}mm"
	{% if verbose %}
	{ action_respond_info("moving to a safe Z distance") }
	{% endif %}
	G0 Z{safe_z} F{z_drop_feedrate}
	_KlickyDebug msg="homing_override clearing axis homed state"
	M84
	{% endif %}
	
	{% if home_z %}
	{% if 'x' not in printer.toolhead.homed_axes and 'y' not in printer.toolhead.homed_axes%}
	{% if verbose %}
	{ action_respond_info("X or Y not homed, forcing full G28") }
	{% endif %}
	{% set home_x, home_y, home_z = True, True, True %}
	{% endif %}
	{% endif %}
	
	
	{% if ((attachmove_y == 0 and override_homing == '' ) or (override_homing == 'Y'))%}
	
	{% if home_y %}
	{% if override_homing == 'Y' %}
	_KlickyDebug msg="homing_override Y homing first override, due to override_homing = Y"
	{% else %}
	_KlickyDebug msg="homing_override Y homing first override, due to attachmove_y = 0"
	{% endif %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y G28 Y0"
	G28 Y0
	
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop-home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	{% set home_y = False %}
	{% endif %}
	
	
	
	{% if home_x %}
	{% if verbose %}
	{ action_respond_info("Homing X") }
	{% endif %}
	{% if printer["gcode_macro _HOME_X"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_X external script to handle the X homing"
	_HOME_X
	{% else %}
	_KlickyDebug msg="homing_override Homing X, G28 X0"
	G28 X0
	
	{% if home_backoff_x != 0 %}
	{% if (printer.configfile.settings.stepper_x.position_endstop > (printer.configfile.settings.stepper_x.position_min|default(0) + printer.configfile.settings.stepper_x.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop - home_backoff_x|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off X endstop, G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}"
	G0 X{printer.configfile.settings.stepper_x.position_endstop + home_backoff_x|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	
	{% if home_y %}
	{% if verbose %}
	{ action_respond_info("Homing Y") }
	{% endif %}
	{% if printer["gcode_macro _HOME_Y"] is defined %}
	_KlickyDebug msg="homing_override calling _HOME_Y external script to handle the Y homing"
	_HOME_Y
	{% else %}
	_KlickyDebug msg="homing_override Homing Y, G28 Y0"
	G28 Y0
	{% if home_backoff_y != 0 %}
	{% if (printer.configfile.settings.stepper_y.position_endstop > (printer.configfile.settings.stepper_y.position_min|default(0) + printer.configfile.settings.stepper_y.position_max)/2) %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop - home_backoff_y|int} F{travel_feedrate}
	{% else %}
	_KlickyDebug msg="homing_override backing off Y endstop, G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}"
	G0 Y{printer.configfile.settings.stepper_y.position_endstop + home_backoff_y|int} F{travel_feedrate}
	{%endif %}
	{%endif %}
	{% endif %}
	{% endif %}
	
	{% if home_z %}
	{% if verbose %}
	{ action_respond_info("Homing Z") }
	{% endif %}
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe configured as a virtual Z endstop attaching probe"
	Attach_Probe
	
	{% if leave_probe_attached %}
	_Probe_Lock
	{% endif %}
	{% elif dock_on_zhome == True %}
	Dock_Probe
	{% endif %}
	
	_Home_Z
	
	
	{% if 'z_virtual_endstop' in printer['configfile'].config["stepper_z"]["endstop_pin"] %}
	_KlickyDebug msg="homing_override probe no longer required, docking probe"
	Dock_Probe
	{% elif dock_on_zhome == False %}
	Dock_Probe
	{% endif %}
	{% endif %}
	_CheckProbe action=query
	
	
	_Park_Toolhead
	
	_exit_point function=homing_override
	_KLICKY_STATUS_READY

[gcode_macro _Umbilical_Path]
gcode = 
	{% set umbilical = printer["gcode_macro _User_Variables"].umbilical %}
	{% set umbilical_x = printer["gcode_macro _User_Variables"].umbilical_x %}
	{% set umbilical_y = printer["gcode_macro _User_Variables"].umbilical_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	
	{% if umbilical %}
	
	_entry_point function=Umbilical_Path
	
	_KlickyDebug msg="_Umbilical_Path moving to G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}"
	G0 X{umbilical_x} Y{umbilical_y} Z{safe_z} F{travel_feedrate}
	
	_exit_point function=Umbilical_Path
	{% endif %}

[gcode_macro _Home_Z]
gcode = 
	{% set z_endstop_x = printer["gcode_macro _Probe_Variables"].z_endstop_x %}
	{% set z_endstop_y = printer["gcode_macro _Probe_Variables"].z_endstop_y %}
	{% set safe_z = printer["gcode_macro _User_Variables"].safe_z|float %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}    {% set z_drop_feedrate = printer["gcode_macro _User_Variables"].z_drop_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Home_Z
	
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	{ action_raise_error("Must Home X and Y Axis First!") }
	{% else %}
	_KlickyDebug msg="_Home_Z XY Axis homed"
	{% if not 'z' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Resetting Z position to zero") }
	{% endif %}
	_KlickyDebug msg="_Home_Z Z not homed, setting position as X=Y=Z=0"
	SET_KINEMATIC_POSITION Z=0
	{% endif %}
	
	
	
	_KlickyDebug msg="_Home_Z moving to Z endstop position G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}"
	G0 X{z_endstop_x} Y{z_endstop_y} F{travel_feedrate}
	_KlickyDebug msg="_Home_Z Homing Z G28 Z"
	G28 Z0
	_KlickyDebug msg="_Home_Z toolhead too low, raising it to {safe_z}mm from {printer.toolhead.position.z}mm"
	G0 Z{safe_z} F{z_drop_feedrate}
	{% endif %}
	
	_exit_point function=Home_Z

[gcode_macro _CheckProbe]
variable_probe_state = 0
gcode = 
	Query_Probe
	_SetProbeState action={ params.ACTION }

[gcode_macro _SetProbeState]
gcode = 
	{% set query_probe_triggered = printer.probe.last_query %}
	{% set action  = params.ACTION|default('') %}
	
	
	{% if query_probe_triggered %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ False }
	{% else %}
	
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_attached VALUE={ True }
	{% endif %}
	
	{% if action == 'query' %}
	SET_GCODE_VARIABLE MACRO=_Probe_Variables VARIABLE=probe_state VALUE={ query_probe_triggered }
	{% endif %}
	
	
	
	
	{% if not query_probe_triggered and action == 'dock' %}
	{ action_raise_error("Probe dock failed!") }
	{% endif %}
	
	
	{% if query_probe_triggered and action == 'attach' %}
	{ action_raise_error("Probe attach failed!") }
	{% endif %}

[gcode_macro _Park_Toolhead]
gcode = 
	{% set park_toolhead = printer["gcode_macro _User_Variables"].park_toolhead %}
	{% set parkposition_x = printer["gcode_macro _User_Variables"].parkposition_x %}
	{% set parkposition_y = printer["gcode_macro _User_Variables"].parkposition_y %}
	{% set parkposition_z = printer["gcode_macro _User_Variables"].parkposition_z %}
	{% set travel_feedrate = printer["gcode_macro _User_Variables"].travel_speed * 60 %}
	{% set verbose = printer["gcode_macro _User_Variables"].verbose %}
	
	_entry_point function=Park_Toolhead
	
	{% if park_toolhead and 'xyz' in printer.toolhead.homed_axes %}
	{% if verbose %}
	{ action_respond_info("Parking Toolhead") }
	{% endif %}
	{% if parkposition_z == -128 %}
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} F{travel_feedrate}
	
	{% else %}
	
	_KlickyDebug msg="_Park_Toolhead moving to G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}"
	G0 X{parkposition_x} Y{parkposition_y} Z{parkposition_z} F{travel_feedrate}
	
	{% endif %}
	
	{% endif %}
	_exit_point function=Park_Toolhead

[gcode_macro _klicky_status_ready]
gcode = 
	{% if printer['gcode_macro status_ready'] is defined %}
	_KlickyDebug msg="_klicky_status_ready activating the LED STATUS_READY"
	STATUS_READY
	{% endif %}

[gcode_macro _klicky_status_busy]
gcode = 
	{% if printer['gcode_macro status_busy'] is defined %}
	_KlickyDebug msg="_klicky_status_busy activating the LED STATUS_BUSY"
	STATUS_BUSY
	{% endif %}

[gcode_macro _klicky_status_leveling]
gcode = 
	{% if printer['gcode_macro status_leveling'] is defined %}
	_KlickyDebug msg="_klicky_status_leveling activating the LED STATUS_LEVELING"
	STATUS_LEVELING
	{% endif %}

[gcode_macro _klicky_status_homing]
gcode = 
	{% if printer['gcode_macro status_homing'] is defined %}
	_KlickyDebug msg="_klicky_status_homing activating the LED STATUS_HOMING"
	STATUS_HOMING
	{% endif %}

[gcode_macro _klicky_status_cleaning]
gcode = 
	{% if printer['gcode_macro status_cleaning'] is defined %}
	_KlickyDebug msg="_klicky_status_cleaning activating the LED STATUS_CLEANING"
	STATUS_CLEANING
	{% endif %}

[gcode_macro _klicky_status_meshing]
gcode = 
	{% if printer['gcode_macro status_meshing'] is defined %}
	_KlickyDebug msg="_klicky_status_meshing activating the LED STATUS_MESHING"
	STATUS_MESHING
	{% endif %}

[gcode_macro _klicky_status_calibrating_z]
gcode = 
	{% if printer['gcode_macro status_calibrating_z'] is defined %}
	_KlickyDebug msg="_klicky_status_calibrating_z activating the LED STATUS_CALIBRATING_Z"
	STATUS_CALIBRATING_Z
	{% endif %}

[gcode_macro Z_TILT_ADJUST]
rename_existing = _Z_TILT_ADJUST
description = 
gcode = 
	{% set V = printer["gcode_macro _User_Variables"].verbose %}
	{% if V %}
	{ action_respond_info("Z Tilt Adjust") }
	{% endif %}
	
	_CheckProbe action=query
	G90
	Attach_Probe
	_KLICKY_STATUS_LEVELING
	
	_Z_TILT_ADJUST {% for p in params
	%}{'%s=%s ' % (p, params[p])}{%
	endfor %}
	Dock_Probe
	G28 Z0

[gcode_macro BED_MESH_CALIBRATE]
rename_existing = _BED_MESH_CALIBRATE
variable_led_enable = False
variable_status_macro = 'status_meshing'
variable_fuzz_enable = False
variable_fuzz_min = 0
variable_fuzz_max = 4
variable_margin_enable = False
variable_margin_size = 5
variable_probe_dock_enable = True
variable_attach_macro = 'Attach_Probe'
variable_detach_macro = 'Dock_Probe'
variable_display_parameters = True
gcode = 
	
	{% if display_parameters == True %}
	{ action_respond_info("led_enable  : %d" % (led_enable))  }
	{ action_respond_info("status_macro: \'%s\'" % (status_macro))  }
	{ action_respond_info("fuzz_enable : %d" % (fuzz_enable))  }
	{ action_respond_info("fuzz_min    : %f" % (fuzz_min))  }
	{ action_respond_info("fuzz_max    : %f" % (fuzz_max))  }
	{ action_respond_info("probe_dock_enable: %d" % (probe_dock_enable))  }
	{ action_respond_info("attach_macro: \'%s\'" % (attach_macro))  }
	{ action_respond_info("detach_macro: \'%s\'" % (detach_macro))  }
	{% endif %}
	
	{% set all_points = printer.exclude_object.objects | map(attribute='polygon') | sum(start=[]) %}
	{% set bed_mesh_min = printer.configfile.settings.bed_mesh.mesh_min %}
	{% set bed_mesh_max = printer.configfile.settings.bed_mesh.mesh_max %}
	{% set probe_count = printer.configfile.settings.bed_mesh.probe_count %}
	{% set probe_count = probe_count if probe_count|length > 1 else probe_count * 2  %}
	{% set max_probe_point_distance_x = ( bed_mesh_max[0] - bed_mesh_min[0] ) / (probe_count[0] - 1)  %}
	{% set max_probe_point_distance_y = ( bed_mesh_max[1] - bed_mesh_min[1] ) / (probe_count[1] - 1)  %}
	{% set x_min = all_points | map(attribute=0) | min | default(bed_mesh_min[0]) %}
	{% set y_min = all_points | map(attribute=1) | min | default(bed_mesh_min[1]) %}
	{% set x_max = all_points | map(attribute=0) | max | default(bed_mesh_max[0]) %}
	{% set y_max = all_points | map(attribute=1) | max | default(bed_mesh_max[1]) %}
	
	{% if margin_enable == False %}
	{% set margin_size = 0 %}
	{% endif %}
	
	{ action_respond_info("{} object points, clamping to bed mesh [{!r} {!r}]".format(
	all_points | count,
	bed_mesh_min,
	bed_mesh_max,
	)) }
	
	{% if fuzz_enable == True %}
	{% set fuzz_range = range((fuzz_min * 100) | int, (fuzz_max * 100) | int + 1) %}
	{% set x_min = (bed_mesh_min[0] + fuzz_max - margin_size, x_min) | max - (fuzz_range | random / 100.0) %}
	{% set y_min = (bed_mesh_min[1] + fuzz_max - margin_size, y_min) | max - (fuzz_range | random / 100.0) %}
	{% set x_max = (bed_mesh_max[0] - fuzz_max + margin_size, x_max) | min + (fuzz_range | random / 100.0) %}
	{% set y_max = (bed_mesh_max[1] - fuzz_max + margin_size, y_max) | min + (fuzz_range | random / 100.0) %}
	{% else %}
	{% set x_min = [ bed_mesh_min[0], x_min - margin_size ] | max %}
	{% set y_min = [ bed_mesh_min[1], y_min - margin_size ] | max %}
	{% set x_max = [ bed_mesh_max[0], x_max + margin_size ] | min %}
	{% set y_max = [ bed_mesh_max[1], y_max + margin_size ] | min %}
	{% endif %}
	
	{ action_respond_info("Object bounds, clamped to the bed_mesh: {!r}, {!r}".format(
	(x_min, y_min),
	(x_max, y_max),
	)) }
	
	{% set points_x = (((x_max - x_min) / max_probe_point_distance_x) | round(method='ceil') | int) + 1 %}
	{% set points_y = (((y_max - y_min) / max_probe_point_distance_y) | round(method='ceil') | int) + 1 %}
	
	{% if (([points_x, points_y]|max) > 6) %}
	{% set algorithm = "bicubic" %}
	{% set min_points = 4 %}
	{% else %}
	{% set algorithm = "lagrange" %}
	{% set min_points = 3 %}
	{% endif %}
	{ action_respond_info( "Algorithm: {}".format(algorithm)) }
	
	{% set points_x = [points_x, min_points]|max  %}
	{% set points_y = [points_y, min_points]|max  %}
	{ action_respond_info( "Points: x: {}, y: {}".format(points_x, points_y) ) }
	
	{% if printer.configfile.settings.bed_mesh.relative_reference_index is defined %}
	{% set ref_index = (points_x * points_y / 2) | int %}
	{ action_respond_info( "Reference index: {}".format(ref_index) ) }
	{% else %}
	{% set ref_index = -1 %}
	{% endif %}
	
	{% if probe_dock_enable == True %}
	{attach_macro}
	{% endif %}
	
	{% if led_enable == True %}
	{status_macro}
	{% endif %}
	
	_BED_MESH_CALIBRATE mesh_min={x_min},{y_min} mesh_max={x_max},{y_max} ALGORITHM={algorithm} PROBE_COUNT={points_x},{points_y} RELATIVE_REFERENCE_INDEX={ref_index}
	
	{% if probe_dock_enable == True %}
	{detach_macro}
	{% endif %}

[gcode_macro SETUP_KAMP_MESHING]
gcode = 
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=display_parameters   VALUE={params.DISPLAY_PARAMETERS|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=led_enable   VALUE={params.LED_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=status_macro VALUE='"{params.STATUS_MACRO|default('status_meshing')|string}"'
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_enable VALUE={params.FUZZ_ENABLE|default(False)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_min    VALUE={params.FUZZ_MIN|default(0)|float}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=fuzz_max    VALUE={params.FUZZ_MAX|default(4)|float}
	
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=probe_dock_enable VALUE={params.PROBE_DOCK_ENABLE|default(True)|int}
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=attach_macro VALUE='"{params.ATTACH_MACRO|default('Attach_Probe')|string}"'
	SET_GCODE_VARIABLE MACRO=BED_MESH_CALIBRATE VARIABLE=detach_macro VALUE='"{params.DETACH_MACRO|default('Dock_Probe')|string}"'

[gcode_macro G29]
gcode = 
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE

[gcode_macro M600]
gcode = 
	PAUSE

[gcode_macro park_hotend]
gcode = 
	G1 X40
	M400
	G1 Y181
	M400

[gcode_macro LON]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro PRINTING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=1 BLUE=0.7

[gcode_macro LOFF]
gcode = 
	SET_LED LED=hotend RED=0 GREEN=0 BLUE=0

[gcode_macro HEATING]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0.0314 BLUE=0 SYNC=0 TRANSMIT=1

[gcode_macro DONE]
gcode = 
	SET_LED LED=hotend RED=1 GREEN=0 BLUE=0.8157 SYNC=0 TRANSMIT=1

[gcode_macro PID_HOTEND]
gcode = 
	{% set EXTRUDER_TEMP = params.TEMPERATURE|default(245)|float %}
	PID_CALIBRATE HEATER=extruder TARGET={EXTRUDER_TEMP}

[gcode_macro PID_BED]
gcode = 
	{% set BED_TEMP = params.TEMPERATURE|default(110)|float %}
	PID_CALIBRATE HEATER=heater_bed TARGET={BED_TEMP}

[gcode_macro SLOW]
gcode = 
	M220 S50
	SET_VELOCITY_LIMIT ACCEL=3000

[gcode_macro FAST]
gcode = 
	M220 S100
	SET_VELOCITY_LIMIT ACCEL=7500

[gcode_macro START_PRINT]
gcode = 
	{% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(190)|float %}
	{% set CHAMBER_TEMP = params.CHAMBER_TEMP|default(32)|float %}
	
	SETUP_KAMP_MESHING DISPLAY_PARAMETERS=1 PROBE_DOCK_ENABLE=1
	HEATING
	
	M117 Setting heater temps
	G90
	M140 S{BED_TEMP}
	M104 S0
	M400
	
	M117 Homing all axis
	G28
	
	{% if printer["temperature_sensor Chamber"].temperature < CHAMBER_TEMP %}
	M106 S255
	G0 X90 Y90 Z15
	M117 Waiting for Chamber to reach {CHAMBER_TEMP}
	TEMPERATURE_WAIT SENSOR="temperature_sensor Chamber" MINIMUM={CHAMBER_TEMP}
	M107
	M400
	{% endif %}
	
	M117 Waiting for bed, setting ext temp
	M190 S{BED_TEMP}
	M104 S{EXTRUDER_TEMP}
	M400
	
	M117 Z Tilt Adjust
	Z_TILT_ADJUST
	M400
	
	M117 Hot probe
	G29
	
	M117 Heating HotEnd
	Go_To_Purge_Location
	M400
	
	M117 Moving Z to top
	G0 Z1
	M400
	
	M117 Cleaning nozzle
	Purge
	M400
	
	M400
	M117 Print Started
	PRINTING

[gcode_macro END_PRINT]
gcode = 
	G91
	G1 Z5
	
	M400
	
	M83
	G1 E-10 F300
	
	M104 S0
	M140 S0
	M106 S0
	
	G90
	G1 X40 Y181 F10000
	
	M400
	
	M18 Y X E
	DONE

[gcode_macro BUZZ]
gcode = 
	{% set MOTOR = params.STEPPER|default(stepper_x)|string %}
	{% if MOTOR == 'x' %}
	{% set MOTOR = 'stepper_x' %}
	{% endif %}
	{% if MOTOR == 'x1' %}
	{% set MOTOR = 'stepper_x1' %}
	{% endif %}
	{% if MOTOR == 'y' %}
	{% set MOTOR = 'stepper_y' %}
	{% endif %}
	{% if MOTOR == 'y1' %}
	{% set MOTOR = 'stepper_y1' %}
	{% endif %}
	{% if MOTOR == 'z' %}
	{% set MOTOR = 'stepper_z' %}
	{% endif %}
	{% if MOTOR == 'z1' %}
	{% set MOTOR = 'stepper_z1' %}
	{% endif %}
	{% if MOTOR == 'z2' %}
	{% set MOTOR = 'stepper_z2' %}
	{% endif %}
	STEPPER_BUZZ stepper={MOTOR}

[gcode_macro PA]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[virtual_sdcard]
path = ~/gcode_files

[heater_fan hotend_fan]
pin = PA8
shutdown_speed = 0
fan_speed = 1
kick_start_time = 0.25
heater_temp = 50

[temperature_sensor Chamber]
sensor_pin = PF5
sensor_type = Generic 3950

[multi_pin cooling_fan_pins]
pins = PE5,PD12

[fan]
kick_start_time = 0.25
pin = multi_pin:cooling_fan_pins

[controller_fan case_fans]
kick_start_time = 1
fan_speed = 1
idle_timeout = 120
pin = PD13
heater = extruder
stepper = stepper_x

[controller_fan nevermore]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD14
heater = extruder
stepper = stepper_x

[controller_fan milkbox]
kick_start_time = 1
fan_speed = .5
idle_timeout = 120
pin = PD15
heater = extruder
stepper = stepper_x

[printer]
kinematics = cartesian
max_velocity = 500
max_accel = 5000
max_z_velocity = 15
max_z_accel = 100
square_corner_velocity = 5

[exclude_object]

[gcode_arcs]
resolution = 0.1

[idle_timeout]
timeout = 1200

[mcu]
serial = /dev/ttyAMA0
restart_method = command

[extruder]
enable_pin = !PE0
step_pin = PE6
dir_pin = PA14
heater_pin = PA2
sensor_pin = PF4
microsteps = 16
rotation_distance = 22.71546
gear_ratio = 5:1
max_extrude_only_distance = 200
full_steps_per_rotation = 200
nozzle_diameter = 0.400
filament_diameter = 1.750
sensor_type = ATC Semitec 104NT-4-R025H42G
control = pid
pid_kp = 21.774
pid_ki = 1.837
pid_kd = 64.505
min_temp = -200
max_temp = 280
min_extrude_temp = 0

[tmc2208 extruder]
uart_pin = PD3
run_current = 0.25
sense_resistor = 0.110
hold_current = 0.1
driver_pwm_grad = 8
stealthchop_threshold = 5000

[neopixel hotend]
pin = PG13
color_order = GRB
chain_count = 1
initial_red = 1
initial_green = 1
initial_blue = 0.7

[neopixel front_strip]
pin = PB0
color_order = GRB
chain_count = 6
initial_red = 1
initial_green = 1
initial_blue = 0.7
=======================
Config error
Traceback (most recent call last):
  File "/home/rudis1261/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/rudis1261/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/rudis1261/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
  File "/home/rudis1261/klipper/klippy/extras/neopixel.py", line 112, in load_config_prefix
    return PrinterNeoPixel(config)
  File "/home/rudis1261/klipper/klippy/extras/neopixel.py", line 21, in __init__
    pin_params = ppins.lookup_pin(config.get('pin'))
  File "/home/rudis1261/klipper/klippy/pins.py", line 106, in lookup_pin
    raise error("pin %s used multiple times in config" % (pin,))
pins.error: pin PG13 used multiple times in config
webhooks client 4105914976: New connection
webhooks client 4105914976: Client info {'program': 'Moonraker', 'version': 'v0.8.0-87-g8eddec8'}
